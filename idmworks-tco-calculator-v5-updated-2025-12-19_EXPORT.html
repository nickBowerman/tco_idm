<html lang="en"><head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IDMWorks - IGA Total Cost of Ownership Calculator</title>
    <style>
        :root {
            --idm-navy: #241F55;
            --idm-gray: #6C6A6F;
            --idm-cyan: #00C2EF;
            --idm-blue: #0661AB;
            --idm-purple: #A72DBE;
            --idm-magenta: #91257A;
            --idm-red: #EC313A;
            --idm-orange: #EF3D2F;
            --idm-yellow: #FFC91E;
            --primary-color: #241F55;
            --secondary-color: #A72DBE;
            --accent-color: #00C2EF;
            --text-color: #444444;
            --bg-color: #f9f9f9;
            --border-radius: 12px;
            --box-shadow: 0 4px 12px rgba(36, 31, 85, 0.15);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header */
        header {
            background: white;
            box-shadow: var(--box-shadow);
            margin-bottom: 30px;
            border-radius: var(--border-radius);
        }

        .header-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 20px 30px;
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .logo {
            max-width: 200px;
            height: auto;
        }

        h1 {
            color: var(--primary-color);
            font-size: 1.8rem;
            font-weight: 600;
        }

        /* Mode Toggle */
        .mode-toggle {
            display: flex;
            gap: 0.5rem;
            background: var(--bg-color);
            padding: 0.5rem;
            border-radius: 8px;
        }

        .mode-btn {
            padding: 0.75rem 1.5rem;
            border: none;
            background: transparent;
            color: var(--text-color);
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            border-radius: 6px;
            transition: all 0.2s ease;
        }

        .mode-btn.active {
            background: var(--primary-color);
            color: white;
        }

        .mode-btn:hover:not(.active) {
            background: white;
        }

        /* Card */
        .card {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 30px;
            margin-bottom: 30px;
        }

        /* Welcome Screen */
        #welcome-screen {
            text-align: center;
        }

        .welcome-header {
            font-size: 2.5rem;
            margin-bottom: 20px;
            color: var(--primary-color);
            font-weight: 700;
        }

        .welcome-subheader {
            font-size: 1.5rem;
            margin-bottom: 30px;
            color: var(--secondary-color);
            font-style: italic;
        }

        .info-section {
            text-align: left;
            margin-bottom: 30px;
            padding: 25px;
            background: #f5f5f5;
            border-radius: var(--border-radius);
            border-left: 4px solid var(--accent-color);
        }

        .info-section h3 {
            color: var(--primary-color);
            margin-bottom: 15px;
            font-size: 1.3rem;
        }

        .formula {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
            border-left: 3px solid var(--secondary-color);
        }

        .start-button {
            background: linear-gradient(135deg, var(--secondary-color), var(--accent-color));
            color: white;
            font-size: 1.2rem;
            padding: 15px 50px;
            border-radius: var(--border-radius);
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 20px;
        }

        .start-button:hover {
            transform: translateY(-3px);
            box-shadow: var(--box-shadow);
        }

        /* Progress Bar */
        .progress-container {
            width: 100%;
            height: 10px;
            background: #f0f0f0;
            border-radius: 5px;
            margin-bottom: 30px;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--secondary-color), var(--accent-color));
            width: 0;
            transition: width 0.3s ease;
        }

        /* Domain Selection */
        .domains-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .domain-card {
            background: white;
            border: 3px solid #ddd;
            border-radius: var(--border-radius);
            padding: 30px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            text-align: center;
        }

        .domain-card:hover {
            border-color: var(--accent-color);
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(167, 45, 190, 0.2);
        }

        .domain-card.selected {
            background: linear-gradient(135deg, rgba(167, 45, 190, 0.15), rgba(0, 194, 239, 0.15));
            border-color: var(--secondary-color);
            border-width: 3px;
        }

        .domain-card.selected::before {
            content: "‚úì";
            position: absolute;
            top: 15px;
            right: 15px;
            background: var(--secondary-color);
            color: white;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.2rem;
        }

        .domain-icon {
            font-size: 3rem;
            margin-bottom: 15px;
        }

        .domain-title {
            font-size: 1.4rem;
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 10px;
        }

        .domain-description {
            font-size: 0.95rem;
            color: var(--idm-gray);
            line-height: 1.5;
        }

        /* Vertical Selector */
        /* Use Case Selection */
        .use-cases-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .use-case-card {
            background: white;
            border: 2px solid #ddd;
            border-radius: var(--border-radius);
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .use-case-card:hover {
            border-color: var(--accent-color);
            transform: translateY(-2px);
            box-shadow: var(--box-shadow);
        }

        .use-case-card.selected {
            background: linear-gradient(135deg, rgba(167, 45, 190, 0.1), rgba(0, 194, 239, 0.1));
            border-color: var(--secondary-color);
            border-width: 3px;
        }

        .use-case-card.selected::before {
            content: "‚úì";
            position: absolute;
            top: 10px;
            right: 10px;
            background: var(--secondary-color);
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .use-case-title {
            font-weight: 600;
            color: var(--primary-color);
            font-size: 1.1rem;
        }

        .use-case-category {
            font-size: 0.85rem;
            color: var(--idm-gray);
            margin-top: 5px;
        }

        .selected-count {
            text-align: center;
            font-size: 1.1rem;
            color: var(--secondary-color);
            margin-bottom: 20px;
            font-weight: 500;
        }

        /* Domain sections for organizing use cases */
        .domain-section {
            margin-bottom: 40px;
            padding: 25px;
            background: #f5f5f5;
            border-radius: var(--border-radius);
            border-left: 4px solid var(--secondary-color);
        }

        .domain-section-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--secondary-color);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* Questions */
        .question-section {
            margin-bottom: 40px;
        }

        .section-title {
            font-size: 1.4rem;
            font-weight: 600;
            margin-bottom: 20px;
            color: var(--secondary-color);
            border-bottom: 2px solid var(--accent-color);
            padding-bottom: 10px;
        }

        .subsection-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--primary-color);
            margin: 30px 0 15px 0;
            padding-left: 15px;
            border-left: 3px solid var(--accent-color);
        }

        .input-group {
            margin-bottom: 25px;
        }

        .input-label {
            display: block;
            font-weight: 500;
            color: var(--primary-color);
            margin-bottom: 8px;
        }

        .input-field {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .input-field:focus {
            outline: none;
            border-color: var(--accent-color);
        }

        /* Hide number spinners */
        input[type="number"]::-webkit-inner-spin-button,
        input[type="number"]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        
        input[type="number"] {
            -moz-appearance: textfield;
        }

        /* Buttons */
        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--secondary-color), var(--accent-color));
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: var(--box-shadow);
        }

        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background: var(--idm-gray);
            color: white;
        }

        .btn-secondary:hover {
            background: var(--primary-color);
        }

        .btn-outline {
            background: transparent;
            border: 2px solid var(--primary-color);
            color: var(--primary-color);
        }

        .btn-outline:hover {
            background: var(--primary-color);
            color: white;
        }

        .btn-danger {
            background: var(--idm-blue);
            color: white;
        }

        .btn-danger:hover {
            background: #054a87;
        }

        .btn-group {
            display: flex;
            gap: 15px;
            justify-content: space-between;
            margin-top: 30px;
        }

        /* Processing Screen */
        #processing-screen {
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 400px;
        }

        .spinner {
            width: 60px;
            height: 60px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid var(--secondary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .processing-text {
            margin-top: 20px;
            font-size: 1.2rem;
            color: var(--primary-color);
        }

        /* Results */
        .results-summary {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 40px;
            border-radius: var(--border-radius);
            margin-bottom: 30px;
            text-align: center;
        }

        .results-title {
            font-size: 1.2rem;
            opacity: 0.9;
            margin-bottom: 10px;
        }

        .results-value {
            font-size: 3.5rem;
            font-weight: 700;
            margin-bottom: 30px;
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .result-item {
            background: rgba(255,255,255,0.15);
            padding: 20px;
            border-radius: 8px;
            backdrop-filter: blur(10px);
        }

        .result-label {
            font-size: 0.9rem;
            opacity: 0.9;
            margin-bottom: 5px;
        }

        .result-value {
            font-size: 1.8rem;
            font-weight: 600;
        }

        /* Config Panel Styles */
        .domain-config-section {
            background: var(--bg-color);
            border: 2px solid #ddd;
            border-radius: var(--border-radius);
            padding: 25px;
            margin-bottom: 25px;
        }

        .domain-config-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #ddd;
        }

        .domain-config-title {
            font-size: 1.4rem;
            font-weight: 600;
            color: var(--primary-color);
        }

        .use-case-section {
            background: white;
            border: 1px solid #ddd;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .use-case-section-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #ddd;
        }

        .use-case-section-info {
            flex: 1;
        }

        .use-case-section-title {
            font-size: 1.15rem;
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 5px;
        }

        .use-case-section-meta {
            font-size: 0.85rem;
            color: var(--idm-gray);
            margin-bottom: 10px;
        }

        .use-case-formula {
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            background: var(--bg-color);
            padding: 10px;
            border-radius: 6px;
            border: 1px solid #ddd;
        }

        .use-case-section-actions {
            display: flex;
            gap: 10px;
        }

        .nested-questions {
            margin-top: 15px;
        }

        .nested-question-item {
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }

        .nested-question-content {
            flex: 1;
            margin-right: 15px;
        }

        .nested-question-text {
            font-size: 1rem;
            color: var(--text-color);
            margin-bottom: 5px;
        }

        .nested-question-meta {
            font-size: 0.85rem;
            color: var(--idm-gray);
        }

        .nested-question-actions {
            display: flex;
            gap: 10px;
            flex-shrink: 0;
        }

        .add-question-prompt {
            text-align: center;
            padding: 30px;
            background: white;
            border: 2px dashed #ddd;
            border-radius: 8px;
            color: var(--idm-gray);
            margin-top: 15px;
        }

        /* Domain breakdown in results */
        .domain-breakdown {
            margin-bottom: 30px;
            padding: 25px;
            background: #f5f5f5;
            border-radius: var(--border-radius);
            border-left: 4px solid var(--secondary-color);
        }

        .domain-breakdown-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--secondary-color);
            margin-bottom: 15px;
        }

        .domain-breakdown-total {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 15px;
        }

        .list-item {
            background: var(--bg-color);
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .list-item-content {
            flex: 1;
        }

        .list-item-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 5px;
        }

        .list-item-meta {
            font-size: 0.85rem;
            color: var(--idm-gray);
        }

        .list-item-actions {
            display: flex;
            gap: 10px;
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal-content {
            background: white;
            border-radius: var(--border-radius);
            max-width: 800px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            padding: 30px;
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 25px;
        }

        /* Form Elements */
        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            font-weight: 500;
            color: var(--primary-color);
            margin-bottom: 8px;
        }

        input[type="text"],
        textarea,
        select {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        textarea {
            resize: vertical;
            min-height: 100px;
        }

        input:focus,
        textarea:focus,
        select:focus {
            outline: none;
            border-color: var(--accent-color);
        }

        small {
            display: block;
            margin-top: 5px;
            color: var(--idm-gray);
            font-size: 0.85rem;
        }

        /* Empty States */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--idm-gray);
        }

        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: 15px;
            opacity: 0.3;
        }

        .empty-state-text {
            font-size: 1.2rem;
            margin-bottom: 10px;
        }

        /* Utility */
        .hidden {
            display: none !important;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 20px;
            }

            .mode-toggle {
                width: 100%;
            }

            .mode-btn {
                flex: 1;
            }

            .use-cases-grid {
                grid-template-columns: 1fr;
            }

            .btn-group {
                flex-direction: column;
            }

            .results-value {
                font-size: 2.5rem;
            }
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/exceljs@4.3.0/dist/exceljs.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header>
            <div class="header-content">
                <div class="logo-section">
                    <img src="data:image/png;base64,UklGRpQcAABXRUJQVlA4WAoAAAAwAAAA0wEAlAAASUNDUMgBAAAAAAHIAAAAAAQwAABtbnRyUkdCIFhZWiAH4AABAAEAAAAAAABhY3NwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAA9tYAAQAAAADTLQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAlkZXNjAAAA8AAAACRyWFlaAAABFAAAABRnWFlaAAABKAAAABRiWFlaAAABPAAAABR3dHB0AAABUAAAABRyVFJDAAABZAAAAChnVFJDAAABZAAAAChiVFJDAAABZAAAAChjcHJ0AAABjAAAADxtbHVjAAAAAAAAAAEAAAAMZW5VUwAAAAgAAAAcAHMAUgBHAEJYWVogAAAAAAAAb6IAADj1AAADkFhZWiAAAAAAAABimQAAt4UAABjaWFlaIAAAAAAAACSgAAAPhAAAts9YWVogAAAAAAAA9tYAAQAAAADTLXBhcmEAAAAAAAQAAAACZmYAAPKnAAANWQAAE9AAAApbAAAAAAAAAABtbHVjAAAAAAAAAAEAAAAMZW5VUwAAACAAAAAcAEcAbwBvAGcAbABlACAASQBuAGMALgAgADIAMAAxADZBTFBIfBAAAAHwh///Iqf1/z1ndrPZjZOEGKQ0hZQQnKu45ECDW4trFathB60BpWhwKU5wd2q4hrZwoIK7haBx3d2Z1/OPnedrXjOn2be/iYgJgJf+f+n/l/5/6f+X/v//TwfW69gq6r+U5IiOu3MYouuX92Ks/1UU2faIisgYIrqPdYv5D5glIlYz2s4TKjbI12aVDQgpH8tZ1iZODgzlDbJ42KJjtcOsIuSA0NDQ0GCbCMleJlTboS+o+ZJC1GSIiPlrO4aLCikfqzcyxGGVDCgTQ1tFWANitKMD9PkmNuj43sBBA/q3qVvFr3SoMmndds35NXmWpYpcvWzB/DmzJn/cpXGkRUj/Tds5181sJ4uR48csTeUdF+0R88127TVTa+iLG7lkdWpq6opZyRZdof3nr0rVbq3HWnPqJTeSjCEiPlia7BDTf+N2vetXLpwzZUDb16yCPt20RXtjeX3+3eYs3aI9u7oOS9UB8w+efeBEZIW3fjmweFTzoL+/ysdLUPt6a54iFO9+ceePQ/O7+AlIKUZe5foXYsrtzUPuEwke0WuRdJ2y6ym3KBs1lcvN9DgGpzMka+sIGvZLPvIyhojoupxSRRYxswhFKk+vn1jWPVTIBhW1XdV1BX19G8n8OWFccuKU00+RP+/StoGRf3PSUgVNpln8OK2HxRjE3GQhM10owjaSEcj66nkzC+ldeqL3If3QztfmVBbqZAw9Cy6OspnF0/nkZG/JTPKQx4xQf4oGXnv/CwUMdSsvTnTx+VuzXcB/C0SWvyLaINwrwi8fhUD7exTO1+H3JXK6A3Uk5nEst/LEpRYy1K2F6L7ZxkSIzPVDWRMlX0E6uzLwSnOdDIUy5yqfvzP7H/8uiOr2SrIxD8oK6IuCqh3lSJf5In7mwT58UjJydpcIOerTe0gzDl7ntnp+kmkQ8VoDi0mkVzYiXdAceAN2o4FHfb0SxM3xkiHZffTJe0QFLFGpwji+qjlcmyQuy2yOzETQ9k3+SUVOt8KjMi3EjG/iLSZiZ+tI5giYwqiC0cDrPw8NZJPAS1FXhhniXCrriskWBUOzKOe7fIOQO6Msl88Rjn3RWn6D05FmjCEyRqHKCHTvqW0iLFkZZY6eL5B0rgzgkftl8ikuxnUpxFvBktGGYFqsrj5OYc2vUMoivr18eZ24/Is4vvbXkD7LRh70ZCqFKiMQD5QTs3iS5uR5W84Xc2B6T4sZ6lxHkv2YIPFUOqZS7usbJ4/+57gZu+4qWsV9wWvBJzUMudtZj7RFFVb2ECNYmi9PcDafawlXG6SzO0sare8gJ0NtplKoMoqtElPdR9MW/Erdd09ysOURJog+jvQfra3A+/ELJJ1zm5b3BZD8X2vx+Z8ae8NLo8UrRK5aveHQM6YDNxpSNFnSEXsJhckLSgi8WYOnJ+pMC+aZxHG2DngG71I4GNJMpZAxAoveFJIAnD4VFlN4sZZxtiVu6tlQO/CGrVGp8WWA9q807D7irRZyaWTzFewIiBx7jy+zqhG4M0ZHj8fioOdz6nEvni167rXnucyxKkKjw22kVaTZpUNOCpERuN0ogPBjlNJWMmxYJpJFs32Au04aksd9gNsa9cnXdS1QGoFkTxy39ferZz8D/WHrXTzFXxhysTmfvNJtwKt3qKLpHAElegomcjjclHO07CFNc1IKkurlTj4Qu6eEgxE3yxomJTsJHGQzSG54HukzUcDf5hY1EUpbYVLk548QEd3TBUDF/YyDHXcYUfCRhavCEdR/uioBP1NsZwDVUdWDW4Opzkjf7ACegamozdxIKudbyQAQ+10Ogaqq9aS1YRB/kprkZ9Bru5G+WwN0dnlMDfUWHJMKUZzc/xkHXqltBC4J5+p6V8C5utQIRuAvNaglTNfvTagpHIfjNeL2azEFSfXPt2TwjEnJIZAxjec9jKuwl5oVYEzwpHzqyVugt8cLaoa30OQZGgBVDvNk9DHkfC0en4lOQ6qr1J23iZCLqDvzA0I6SbmX+WpUPqDBVKRvdLGCdrmZRZSi8aKPmab5G2Lt/QjJgtGSrs7p1IWyXsI0NMS+gqfwWyGMKOwgc1TYidoqE2K5TxWOlrSSMwj1LMHmh2jFPqCeDwHNuP0eTEX6YUcr0BHfMML1bzDc15Aql5FUF4eB7pbXKXX9K97BaWNgXB4HWymi5IlLC1MCON68TfxeKATmUbg4SGtGEZHRn2nhkUStDpnUjfpasbsRkalIP2llBd7gEaoGKqaJP0F1tRjhOMKoHxIlfXVOU+hM6+XnDVwyqOMdDtzgK6Do1GXidCRlHaQQi5+KacBxOFHD8T2Sy6s+JbJaa00qIthJHy4V6aftLcBvH6l6qKppktxEegMwQFqsInmzgwz6wzdwICs6OyRCKvUuG9TuNs/BiiLWbyewGhW1AbVz378nBvKpa800ml8mWLuorQSOdXhY9qiEcybwKEiyx/1toDdwQjEiY2iW4I1I7q4gqq5fQPhXxUi++AyEDs3i8HT9+OnrgTbJe2l6lee3uiJmTCghJlLVbhEHWopKpdzvyB6fZhGZdr+xjNgb5RF3Fsn8djwMSZY+2AH6Y7eoTEWzBH6sEoVDbYLUnSt33FGQLF4UICb+qMqHiIVHRzQqb/FWKv2L53xjEVPevkOkEZYeKjGn/gNBH1I4ORAAgpYyYhtAm2fEk2oe7W5Tj4KI8jsZ0rlTgkCgNCwPaaMctScUoTY7XgsE6SxcFwOC332uCxEzd35Q2+GdRKTxXBAyLe4YobyuZV+N2s/7Vn8oKCGL2lceAGqeQLI/QNUjBL4rAcDIbGobkBFbkGZXEkGkZSRP5nsiutTRrNe815TTCpKPPrSZga2NBNEB0xQBiMqpL6tK3ojfcYOKU6xLnFo4WivsAXG2vrCoI9T9qgDw9lMiOx4gcC612QJg/06l3qPCNlKMXa4sQqpzglEsc7CIP37RPPvXAzfSRXPKgCnOfOwrCsK+zBWBWHDgbYcXYj1iUMks6P+M+F2rg0qsCxDmP4FSkyQImKAS+8sAwIBM4rk/QMUfkS4jgDHMGikLqLDPiSRTs4aIELsoEkyB+PhrX1EQ8NY5Iajc+9DX+wg6YdyrNwhXZY1VqJ01AoRJnUoInGqDCnuRHG8HgGZ/EKwtQLM/qeOgj6mI7GZnfY79biSZitkmcQ73A7Pgk8HCwBI78rYIxNx23kfkGePgB6alDvWw5xA3WoiD2uepLQ6o/5QoTgIACNxG4EqA93KpiSLQ83qyrMOxF2lVQXOoRWkNJTDCWVLiYhz4awNJFAD49z+aW6LowqdRXkeVCzznRX3g1mI/WQGgFWqzQ/4GxKylckJ8BiB5vLIHTC4ksv3sXyOpJOpjWnilhcwVuQ5pxhhi9sfGKeffDQGRHMr0YcPmn8zgYCuiDACA8sO2XX5YrANTLd5G0jWecw0EVSzWwjuVAaQ1RPFUMMBntJNgbwRuohaEarS5T2Dz8pupayH6OK+3kTlil5RQqoqImDfGuIJN9W3GuKoDgNTzFoXZA30NAYBXO87+/qqLqyjR22h/m+dIZUFwksgaDBD6gMh80wjodJfA8eUeEvnvSRqR56jFtS5QCxz6GCPwTncLUW5ODpKq24CTP/3004FT6QS6jzW2GAfQK4vCq/WMAoCwNtP/UDhco7yNPuk8W4NEfUy41/hAhzzicqAhiUepQ28x4q8k0JSWuYm/OhRQPSwcwWs1kANv9LNqRE57gaSqMvTMGSqiXUJCQmLtjgcJVPbHmMFvhkLhfodxAH4tdhRR6k5vY2oJT6okKpLAMwmw3EUsBEPsK1QifzWSWyK1oGchkfs9kndrAadlvqqBjFJvvO8DAEHfZCGpulH7eU8RCeApNblOYMk42QTS6z9yuKaZASzxBxQCz8neRfhm5HQvAlFwkLjfPfQXJFsYA8MyCSwmnFNlIjyLYG5qTywPjMnVQoVAlj40EKyLi5BkKpIPa4kDxygK8xJMAHLH+xQWJpkBpHcyqQtW76LFRZ6MvuLGEsqMbveJTAsA1H0kLuk6Rd/uBPR+gpN94cf1jysEuglEdv/HYqRVBekTYADE72MEnvcxAVi/LKbwWowZIPqOlxI2R+W5nSwuoUgL920tJlYAADTJEBd8nOlKi+N4X19mF+C2rncTqFD8TGFUSSdDoFc6haOsJoDYXW6qeFGAGcJuUb9J3kTMqCfIyU6HCJntEX6cSH+C2mpro2ChU497rYUjpkjXmTp80PAahSoTwBjSbLNkTNiKEiqjsRmg+RVG4MP3fHX4vFLJoa/mA0JdD16DtXLvtVnI65oriXDO8/CbQHA+CDasS46e7AHAe0wPWx2uAwZmUsgYxZiGqiLNfo4FY6DBRUa4tsWYQf64mGKn3pC4Qj7YvG9CPR89w3MI16fegK1s4j86j1xy+BHy5zYAEa6FHnLrXF3rbIZFZeh5mMA1Qk/BGFmP74f3KVQZgUxliApD2rW9FhhlHVVC4PPhviaAwBUUlnwXwWMb8IBhSdrIGL5Xf1SIouqlF3twnDz125837mUpqHe3zQBITNPDusqGwR49h61crzt13GgHum3Nd7sIpqoEMkRkSD+a8JrFMAg9SrGzDc0A0b9RmP2+D0f9XxkisswD7/pyxK3IR/K4tfQyXKkKRpSZp+dRVTButJ6xwB18UsfxOH0gh/W7yjQQVZXgd+2p75DAOKhVQqB7YbgZoHEuhXfjqPD5btRUc28Or2gFACnyi79KkO4E3oo6AQyB9wp0bIw0QQTjYzX47DP5lFQQW3ZKjqqBjOlTHnUH3aJgKiMwt7PFDL5DFQoPWbXkjnnI7Uq/cMuN3IfAW3Hu8Deo0b/41I9sJoAbfLeAX2pewvXiQ0EAiZsz3B7ImI6S21OCwDSh5yg886oZoMION4XDfTTCTqGxd6t7K7nb4iWDIjczrvRkMMNEvqk6IPEPrju1hIFPp52PGSIiYzzK/dWNfMA81h6ZFE6XzQBJf3LkttIInp9hyP2+ttLiYmNzKTemVJRA1HwtaVwe1644UzTkUt/QE/4dDztpFQdS1IAfChERGaOKt/cKA6HCIHK5QuW0MYX9s6eUerSyB4R+ct4p7sbAQCgtjkaY6smS1iGgk6fwWy1oe5NHmWLXqv7QkIDLPLdseiwDSjiUCWConDDsPENExjTYrwPjJDCX1PQChX+WNwOUTXUSWDg32AP8Gs17Icj9W+8AKC2KUiTz5B8Y3SACdPM86kGE7FU5brQD7YBzhlgGFHMsk/VAs4scF6ONAbBX++IhIjKVIaZPqGEB0eLA8UUupc6XzQCJlyh82Ef2AAhv9N0LEYUp1exQahyJBVOwJ8dn94oPs4NADtcyfwLq3qJyJzoIqVWeERAyPpNgrUH3KzuotHgw3lEt5Z6KqFz9urqfBOaDiBXFBKZ3MYWc9IxiJ2pqAQRW/PREkY6HMyoFwN++z4gUzUldLcD9zxT907/+4pO+LRP9QXzy+K80xzQA3rBPv9Ic31QCzrAhX2l/GCMApIqDp6V4TiurT275lebYN21gTuvrSc0qgLHtp6aQEbpAajguRXtmPyvx7sJF2gui9QEE9P12EZlkJTyjey86k+d0uVzO7KPTkxzwX8dyULnYcgHw0v8v/f/S/y/9/9L///c/VlA4ICIKAADwQwCdASrUAZUAPlEokEajoqGhIRVZ8HAKCWdu6dB1whkLEuSiOZwJr8Of1u1CD8Sf0ztP/Km/yD8Sbwhlf3L+YcqzwP4o6gY0/U9/D+4D39/0/2ZeYB+n/6y/2/sO+YT9qP2K94P+9foB7nPpm+QD+ff6/0qvYG9AD9Y/S8/cr4Jf69/yP3S9nX/0dYBwwf2d+IW8Z6b2zhO/1JXy3im0k2YB/WuSt5D/AD/E/6T+uvZs/dH2Cv1oFlhZVZaFsqstC2VWWhbKrLQtlVloWyqy0LZVZaFsqstC2VWWhbKrLQtlVloVza6CH9GXET3+9lsiYMwJ1RgUd7MsPTtBTwV5/UxdOeMPfZf6PR57cy8yyTir5DZlEXzvAo8Om+sOs3TIsekE2CwAggcnSBUupcmH9D0Xf1IK439g7jQzSeaR1Y0lxt7JOaEzHWIjbUhYGaCQyjngBRJM1ZRwO9uZ8KeOt6lsaLjXOFOAfc/ZxcrYWyZqYNov1xdWxpxLrSEqeOcNPDed6wcZYpjA2D764JxxfbghO5vW3lcR/bmtXuNsr6CgOg/E0IQFhcrvMPwkn9t6TnNtFpg2ab+uisLRYmWHAWiEJCUz2zMxe36Ze/s+wG1Qmqy38SnqWPEr02yfimKwJpXvR84T9iP9TPQKCORzQ77bOKPtMnJaJilvACSFITNJCkJmkhSEzSQpCZpIUhM0kKQmaSFITNJCkJmkhSEzSQpCZpIUgYAA/vtp0AAAAAAAAAH7p2e/Dxv39JTkMx9MUmCUGgH840d/gZmHZ2nZUrSSqov4FIHC9g9QtLpPaEb5lLGheSA23FtMuKYSbZuC+gtKQ1VFUV0oocobVciqYnc4NYtQCN789EyZ/BwChc8jxeyINr7OzSqjbCzJ7TFvGhOOVRVKxrEX349WQvv+VS8PbRmO9Ia8rwfyMXVeuRnf8fuBbuRZ2nCjin+/fvTbDydT8v7IO8W0GaJHZUJF6KkyN5Cx4duVQepyUNRD7q7d2GPfEL9VDozXk7O6g9CC//+0MoHRQiHCcbiDi/+/UQKxtv4JqPpJ/9Wg5F9U1aYx4VajE1fdYmlRwiRntZMzNPzS/eCudaj3UYUa0kMN6qqyZc/es15t834Jd9EGbnTq35F+i/x7QoZP/qQLI7oE8zRmuYQ3tdRp5XRH/+SBH3bBazemC1E8UzQ9bnfHMp0Ep8MbzLrXqSHRIlot/BaytmUOrBoNAoP4gogCoxL0JpiskpFHPVz7SIGngZdlQ+u2UP/TC7g0z1w6xwQ/iq7E6hGnpT5mu7s0eCoeh7mm7UTarKExYtZpdR6vqP03zBgxqm0SPhgsCmdvf1A+/z7wdaU8pd8XZswC3xizxQZRwLq2lZDo/pjY9ewtou5rU7+9CMUMJH5c8ylCI43nPj9O5/QMnZLwuzF+pmXquU08n0EyaODFwM/k8AVJtCOcPfo2iFtBKrWioJtCa+GzN4SDGGetUBf4PKEDxAhqjr7FeTKn+aTa9a27o38zOy/YqZSTeHvsLyJ61R7xNzkJgfcIX+rAMtCVtTFIBXKQW+WPjuDZwv//s40ullpC4mFWdQxXYJcR3oIN3W+pjEooUZvLT/oTyXaaMS61blW1vNKFhxFYk4ItkQsDlC7HHIkoQSEvw9+xkmiRcSCl8H++fO2Cvk45LmlmLzMhEeDmEpw4Mckizz+wifR/60anXA6CG4zmOzYhRRdsRH3KlP1XiH2ts3Szu4wmx64SeMY+zoSuAOSUF9hAKjS3pUpSQFHBZHPUOSrwdfszupDsb89ce2L6S+ENSoAuiHP/hxQuff9LXwnWn+4wFmNMQkXRwjkdKrA8GkfBAKUsnWItkOL3n6whWf9aDY2Sd69RRoXSoNSqFHxrg01l82pP41XaN3P3AyVGEekcqn2hTV736nftcHz60EYandmT1YodvRM3yDuwXitaXUu42B2gx4MlPod4Yu6rPOls1m5YJG5UyB+oN4e7KMpcYPhaBWk9sgpqVQTk9VJq6mHOa/jkmYMX6h+RkShDBdKffs5FwNGlO0r9IiQhIZl138phgXEGlR+gNwBlSXFu/CKVaejwC2qYMElc34i+IBag462yoVnYeUmkjhs28AP2sutz2duhkv/TwNHE21/T4MpXh44qgXRUn7wZkAHQq6p5JyixnaQl4J3cKlzvpIgwH/Lj8fAAV37PhBXgNcVAMznvRIAD45WGi7w2dxv4DG/e9MTrZrFkSLMp1ISDYvqZvRaIbcpXdXI//w90qEeypED72AcpdTV/SifcHK+h7TQOBqXH475VRMJhKx3ZTnDgsiTaEAdCRbO9qWtCysM+m5oPubJY6z1uogtf+YtZ3up4LPdMkqQYMhFNP+L3f1Rqc+mlJLu/mRel5KWMBZ6ObON713AWUzzvw5xz6/XMQv906NvQSbQAf0xFrypewQ+KN0lyLrC9D+Ic6g72s2pz/ZcB18srtwO4ohy1fhu/lh8OPw+63gJq5xM6pZU5DyyYcEt0XkEmBWKslZ3W0ptu/JlWGhDGrwj7nqG8PbbX/u7ty8orlWAS9cNT11nFEByZnuc4iB/RZSXm14uqwqJlYL8HqnGPHv3ploCIoZ7Ux4CfT2mavrdPcP76EYHYgNHoH4UYYBe8tZ56WAKNP6CD7Uwnvde/JIRdHwNXNleH3Oi5el1SOxhXicQvXs2rD45PozUEevt3zWS3/58I3ZBEK/XfU8mZdEt7V4jb0cB5XA+yZx4YiDrzex5eTf6C1A38/RKZOK4riRvkoMOcrM86ujwGlBsWiqGJfxUVuAyXLBVbRzd0GAysfvUz76RCqfh71ifXfcn1mBXUAY80qSVEDsFsj/XXfYxHRJsdgZDcMVr0XyML2M96SJTCuTEbBIawADK+/ou9wMg8rV1K2LcsONoGEFcXIrWsA2SDMKFHdC5/vnWO6he1/jSBBOJHk4N5Q83NZ3gklUcIvaB2aQUlXPSRQgSZRCA3cMjDWzc/VEasY6fmPybC4GfKoS950kw4PdLhS5iC5DjEsZl4nJSFsjUppqKTRZG6Q4CEZjSB4Q7VgBzf2C1aRnGbHTliaGLU/UlhsAnOmggDkglKo0E/VbBMwOD0fmjSZKXR0H0SBo1FPRWvzE3OI2uSx6VGvCsI4jJX0fWbtBUHoJVKvVK3+idUi4LPQI1/seT2xCkL1003ho0/NCz72hP9ICHtFBzCSxdQvCR++6xARDBw6JidF2cPB8tV/RC+VPKqvctav+nIydSaHSlA1Y9NwUsNJHtrQSAKxy7Z6bgwZrJiFml0DrQiia/5jpjYgzwgh3L2Qq1v469qbmFL/XexFQutFacgapH2BOW6KCTpfjlaa81oFVP/qntlhyNOE5eiwuK9B/RD71kgqRLax6OO+Wq/Ej9QaPbTN17Q376lCmz1ug+2PW1vIcsL0yoKRT4cGjk091dDBAAAAAAAAAAAAAAAAA==" alt="IDMWorks" class="logo" id="logo-img">
                    <h1>IGA Total Cost of Ownership Calculator</h1>
                </div>
                <div class="mode-toggle">
                    <button class="mode-btn" onclick="switchMode('calculate')">Calculate TCO</button>
                    <button class="mode-btn active" onclick="switchMode('configure')">Configure</button>
                </div>
            </div>
        </header>

        <!-- Calculate Panel -->
        <div id="calculatePanel" class="">
            <!-- Welcome Screen -->
            <div id="welcome-screen" class="card">
                <h2 class="welcome-header">Welcome to the TCO Calculator</h2>
                <p class="welcome-subheader">Discover Your True Identity &amp; Access Management Costs</p>

                <div class="info-section">
                    <h3>What This Calculator Does</h3>
                    <p>This tool helps you quantify the <strong>total cost of ownership</strong> across multiple identity and access management domains: IGA, CIAM, PAM, and Access Management. Many organizations focus solely on software licensing costs, but the real expense lies in the <strong>people, processes, and time</strong> required to manage identities, access, and compliance.</p>
                    
                    <p style="margin-top: 15px;">By answering questions about your processes, you'll get a comprehensive view of:</p>
                    <ul style="margin-left: 20px; margin-top: 10px;">
                        <li>Monthly operational costs by domain</li>
                        <li>Annual TCO including license fees</li>
                        <li>3-year and 5-year investment projections</li>
                    </ul>
                </div>

                <div class="info-section">
                    <h3>How It Works</h3>
                    <p><strong>Step 1:</strong> Select the identity management domains relevant to your organization</p>
                    <p><strong>Step 2:</strong> Choose specific use cases within each domain</p>
                    <p><strong>Step 3:</strong> Answer questions about volumes, staff involvement, and time spent</p>
                    <p><strong>Step 4:</strong> Review your total cost of ownership breakdown</p>
                    
                    <div class="formula">
                        <div class="formula-label">Standard Cost Formula:</div>
                        Monthly Cost = Volume √ó Staff Count √ó Hourly Rate √ó Hours per Transaction
                    </div>
                </div>

                <button class="start-button" onclick="startCalculator()">Start Assessment ‚Üí</button>
            </div>

            <!-- Calculator Steps -->
            <div id="calculator-container" class="hidden">
                <div class="progress-container">
                    <div class="progress-bar" id="progress-bar" style="width: 0%;"></div>
                </div>

                <!-- Step 1: Select Domains -->
                <div id="step-1" class="card hidden">
                    <h2 class="section-title">Step 1: Select Your Domains</h2>
                    <p style="margin-bottom: 25px; color: var(--idm-gray);">
                        Choose the identity and access management domains you want to assess. You can select multiple domains.
                    </p>
                    <div class="selected-count" id="selected-domains-count">0 domains selected</div>
                    <div class="domains-grid" id="domains-grid">
                        <!-- Domains populated here -->
                    </div>
                    
                    <div class="btn-group">
                        <button class="btn btn-secondary" onclick="backToWelcome()">‚Üê Back</button>
                        <button class="btn btn-primary" id="next-btn-step1" onclick="goToStep2()" disabled="">Next: Select Use Cases ‚Üí</button>
                    </div>
                </div>

                <!-- Step 2: Use Case Selection -->
                <div id="step-2" class="card hidden">
                    <h2 class="section-title">Step 2: Select Use Cases</h2>
                    <p style="margin-bottom: 25px; color: var(--idm-gray);">
                        Choose the specific processes you want to cost out within each selected domain.
                    </p>
                    <div class="selected-count" id="selected-usecases-count">0 use cases selected</div>
                    <div id="use-cases-by-domain">
                        <!-- Use cases grouped by domain populated here -->
                    </div>
                    <div class="btn-group">
                        <button class="btn btn-secondary" onclick="backToStep1()">‚Üê Back</button>
                        <button class="btn btn-primary" id="next-btn-step2" onclick="goToStep3()" disabled="">Next: Answer Questions ‚Üí</button>
                    </div>
                </div>

                <!-- Step 3: Questions -->
                <div id="step-3" class="card hidden">
                    <h2 class="section-title">Step 3: Answer Questions</h2>
                    <p style="margin-bottom: 25px; color: var(--idm-gray);">
                        Provide information about each selected use case. Enter your best estimates.
                    </p>
                    <div id="questions-container">
                        <!-- Questions populated here -->
                    </div>
                    <div class="btn-group">
                        <button class="btn btn-secondary" onclick="backToStep2()">‚Üê Back</button>
                        <button class="btn btn-primary" id="calculate-btn" onclick="calculateTCO()">Calculate TCO ‚Üí</button>
                    </div>
                </div>
            </div>

            <!-- Processing Screen -->
            <div id="processing-screen" class="card" style="display: none;">
                <div class="spinner"></div>
                <p class="processing-text">Calculating your Total Cost of Ownership...</p>
            </div>

            <!-- Results Screen -->
            <div id="results-screen" class="hidden">
                <div class="results-summary">
                    <div class="results-title">Monthly Total Cost of Ownership</div>
                    <div class="results-value" id="monthly-total">$0</div>
                    <div class="results-grid">
                        <div class="result-item">
                            <div class="result-label">Annual TCO</div>
                            <div class="result-value" id="annual-total">$0</div>
                            <div class="result-subtext" id="license-cost-subtext" style="display: none; font-size: 0.85rem; color: rgba(255,255,255,0.8); margin-top: 5px;">(incl. <span id="license-cost-inline">$0</span> IGA license costs)</div>
                        </div>
                        <div class="result-item">
                            <div class="result-label">3-Year TCO</div>
                            <div class="result-value" id="three-year-total">$0</div>
                        </div>
                        <div class="result-item">
                            <div class="result-label">5-Year TCO</div>
                            <div class="result-value" id="five-year-total">$0</div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h2 class="section-title">Cost Breakdown by Domain</h2>
                    <div id="breakdown-container">
                        <!-- Breakdown populated here -->
                    </div>
                </div>

                <div class="btn-group">
                    <button class="btn btn-primary" onclick="exportResults()">Export Report</button>
                    <button class="btn btn-secondary" onclick="editResponses()">‚Üê Edit Responses</button>
                    <button class="btn btn-outline" onclick="startOver()">Start Over</button>
                </div>
            </div>
        </div>

        <!-- Configure Panel -->
        <div id="configurePanel" class="hidden">
            <div class="card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h2 class="section-title" style="margin: 0; border: none; padding: 0;">Manage Domains &amp; Use Cases</h2>
                    <button class="btn btn-primary" onclick="showAddDomainForm()">+ Add Domain</button>
                </div>
                <p style="margin-bottom: 25px; color: var(--idm-gray);">
                    Configure domains, add use cases, assign questions, and define cost formulas.
                </p>
                <div id="domain-management"><div class="domain-config-section">
                    <div class="domain-config-header">
                        <div class="domain-config-title">üîê IGA</div>
                        <div style="display: flex; gap: 10px;">
                            <button class="btn btn-outline" onclick="editDomain(1)">Edit Domain</button>
                            <button class="btn btn-danger" onclick="deleteDomain(1)">Delete Domain</button>
                        </div>
                    </div>
                    
                            <div class="use-case-section">
                                <div class="use-case-section-header">
                                    <div class="use-case-section-info">
                                        <div class="use-case-section-title">Onboarding an employee</div>
                                        <div class="use-case-section-meta">Category: Joiner/Mover/Leaver</div>
                                        <div class="use-case-formula">Formula: newHires * hours * staffRate</div>
                                    </div>
                                    <div class="use-case-section-actions">
                                        <button class="btn btn-outline" onclick="editUseCase(1)">Edit</button>
                                        <button class="btn btn-danger" onclick="deleteUseCase(1)">Delete</button>
                                    </div>
                                </div>
                                <div class="nested-questions">
                                        <div class="nested-question-item">
                                            <div class="nested-question-content">
                                                <div class="nested-question-text">How many internal new hires are onboarded per month?</div>
                                                <div class="nested-question-meta">Variable: <strong>newHires</strong> | Type: number | Default: 1</div>
                                            </div>
                                            <div class="nested-question-actions">
                                                <button class="btn btn-outline" onclick="editQuestionMapping(1, 1)">Edit</button>
                                                <button class="btn btn-danger" onclick="deleteMapping(1, 1)">Remove</button>
                                            </div>
                                        </div>
                                    
                                        <div class="nested-question-item">
                                            <div class="nested-question-content">
                                                <div class="nested-question-text">How many hours (on average) are spent manually provisioning these people?</div>
                                                <div class="nested-question-meta">Variable: <strong>hours</strong> | Type: number | Default: 1</div>
                                            </div>
                                            <div class="nested-question-actions">
                                                <button class="btn btn-outline" onclick="editQuestionMapping(1, 2)">Edit</button>
                                                <button class="btn btn-danger" onclick="deleteMapping(1, 2)">Remove</button>
                                            </div>
                                        </div>
                                    
                                        <div class="nested-question-item">
                                            <div class="nested-question-content">
                                                <div class="nested-question-text">What is the average hourly labor rate for the team members that perform this work?</div>
                                                <div class="nested-question-meta">Variable: <strong>staffRate</strong> | Type: number | Default: 60</div>
                                            </div>
                                            <div class="nested-question-actions">
                                                <button class="btn btn-outline" onclick="editQuestionMapping(1, 3)">Edit</button>
                                                <button class="btn btn-danger" onclick="deleteMapping(1, 3)">Remove</button>
                                            </div>
                                        </div>
                                    <button class="btn btn-outline" onclick="showAddQuestionToUseCase(1)" style="margin-top: 10px;">+ Add Another Question</button></div>
                            </div>
                        
                            <div class="use-case-section">
                                <div class="use-case-section-header">
                                    <div class="use-case-section-info">
                                        <div class="use-case-section-title">Offboarding an employee</div>
                                        <div class="use-case-section-meta">Category: Joiner/Mover/Leaver</div>
                                        <div class="use-case-formula">Formula: totalTerms * hours * staffRate</div>
                                    </div>
                                    <div class="use-case-section-actions">
                                        <button class="btn btn-outline" onclick="editUseCase(2)">Edit</button>
                                        <button class="btn btn-danger" onclick="deleteUseCase(2)">Delete</button>
                                    </div>
                                </div>
                                <div class="nested-questions">
                                        <div class="nested-question-item">
                                            <div class="nested-question-content">
                                                <div class="nested-question-text">How many employees are offboarded per month?</div>
                                                <div class="nested-question-meta">Variable: <strong>totalTerms</strong> | Type: number | Default: 1</div>
                                            </div>
                                            <div class="nested-question-actions">
                                                <button class="btn btn-outline" onclick="editQuestionMapping(2, 5)">Edit</button>
                                                <button class="btn btn-danger" onclick="deleteMapping(2, 5)">Remove</button>
                                            </div>
                                        </div>
                                    
                                        <div class="nested-question-item">
                                            <div class="nested-question-content">
                                                <div class="nested-question-text">How many hours (on average) are spent offboarding these people?</div>
                                                <div class="nested-question-meta">Variable: <strong>hours</strong> | Type: number | Default: 1</div>
                                            </div>
                                            <div class="nested-question-actions">
                                                <button class="btn btn-outline" onclick="editQuestionMapping(2, 7)">Edit</button>
                                                <button class="btn btn-danger" onclick="deleteMapping(2, 7)">Remove</button>
                                            </div>
                                        </div>
                                    
                                        <div class="nested-question-item">
                                            <div class="nested-question-content">
                                                <div class="nested-question-text">What is the average hourly labor rate for the team members that perform this work?</div>
                                                <div class="nested-question-meta">Variable: <strong>staffRate</strong> | Type: number | Default: 60</div>
                                            </div>
                                            <div class="nested-question-actions">
                                                <button class="btn btn-outline" onclick="editQuestionMapping(2, 3)">Edit</button>
                                                <button class="btn btn-danger" onclick="deleteMapping(2, 3)">Remove</button>
                                            </div>
                                        </div>
                                    <button class="btn btn-outline" onclick="showAddQuestionToUseCase(2)" style="margin-top: 10px;">+ Add Another Question</button></div>
                            </div>
                        
                            <div class="use-case-section">
                                <div class="use-case-section-header">
                                    <div class="use-case-section-info">
                                        <div class="use-case-section-title">Onboarding third-party workers (e.g., external, contingent, contractors, vendors</div>
                                        <div class="use-case-section-meta">Category: Joiner/Mover/Leaver</div>
                                        <div class="use-case-formula">Formula: newHires * hours * staffRate</div>
                                    </div>
                                    <div class="use-case-section-actions">
                                        <button class="btn btn-outline" onclick="editUseCase(3)">Edit</button>
                                        <button class="btn btn-danger" onclick="deleteUseCase(3)">Delete</button>
                                    </div>
                                </div>
                                <div class="nested-questions">
                                        <div class="nested-question-item">
                                            <div class="nested-question-content">
                                                <div class="nested-question-text">How many third-party workers (e.g., external, contingent, contractors, vendors) are onboarded per month?</div>
                                                <div class="nested-question-meta">Variable: <strong>newHires</strong> | Type: number | Default: 1</div>
                                            </div>
                                            <div class="nested-question-actions">
                                                <button class="btn btn-outline" onclick="editQuestionMapping(3, 4)">Edit</button>
                                                <button class="btn btn-danger" onclick="deleteMapping(3, 4)">Remove</button>
                                            </div>
                                        </div>
                                    
                                        <div class="nested-question-item">
                                            <div class="nested-question-content">
                                                <div class="nested-question-text">How many hours (on average) are spent manually provisioning these people?</div>
                                                <div class="nested-question-meta">Variable: <strong>hours</strong> | Type: number | Default: 1</div>
                                            </div>
                                            <div class="nested-question-actions">
                                                <button class="btn btn-outline" onclick="editQuestionMapping(3, 2)">Edit</button>
                                                <button class="btn btn-danger" onclick="deleteMapping(3, 2)">Remove</button>
                                            </div>
                                        </div>
                                    
                                        <div class="nested-question-item">
                                            <div class="nested-question-content">
                                                <div class="nested-question-text">What is the average hourly labor rate for the team members that perform this work?</div>
                                                <div class="nested-question-meta">Variable: <strong>staffRate</strong> | Type: number | Default: 60</div>
                                            </div>
                                            <div class="nested-question-actions">
                                                <button class="btn btn-outline" onclick="editQuestionMapping(3, 3)">Edit</button>
                                                <button class="btn btn-danger" onclick="deleteMapping(3, 3)">Remove</button>
                                            </div>
                                        </div>
                                    <button class="btn btn-outline" onclick="showAddQuestionToUseCase(3)" style="margin-top: 10px;">+ Add Another Question</button></div>
                            </div>
                        
                            <div class="use-case-section">
                                <div class="use-case-section-header">
                                    <div class="use-case-section-info">
                                        <div class="use-case-section-title">Offboarding third-party workers (e.g., external, contingent, contractors, vendors</div>
                                        <div class="use-case-section-meta">Category: Joiner/Mover/Leaver</div>
                                        <div class="use-case-formula">Formula: totalTerms * hours * staffRate</div>
                                    </div>
                                    <div class="use-case-section-actions">
                                        <button class="btn btn-outline" onclick="editUseCase(4)">Edit</button>
                                        <button class="btn btn-danger" onclick="deleteUseCase(4)">Delete</button>
                                    </div>
                                </div>
                                <div class="nested-questions">
                                        <div class="nested-question-item">
                                            <div class="nested-question-content">
                                                <div class="nested-question-text">How many third-party workers (e.g., external, contingent, contractors, vendors) are offboarded per month?</div>
                                                <div class="nested-question-meta">Variable: <strong>totalTerms</strong> | Type: number | Default: 1</div>
                                            </div>
                                            <div class="nested-question-actions">
                                                <button class="btn btn-outline" onclick="editQuestionMapping(4, 6)">Edit</button>
                                                <button class="btn btn-danger" onclick="deleteMapping(4, 6)">Remove</button>
                                            </div>
                                        </div>
                                    
                                        <div class="nested-question-item">
                                            <div class="nested-question-content">
                                                <div class="nested-question-text">How many hours (on average) are spent offboarding these people?</div>
                                                <div class="nested-question-meta">Variable: <strong>hours</strong> | Type: number | Default: 1</div>
                                            </div>
                                            <div class="nested-question-actions">
                                                <button class="btn btn-outline" onclick="editQuestionMapping(4, 7)">Edit</button>
                                                <button class="btn btn-danger" onclick="deleteMapping(4, 7)">Remove</button>
                                            </div>
                                        </div>
                                    
                                        <div class="nested-question-item">
                                            <div class="nested-question-content">
                                                <div class="nested-question-text">What is the average hourly labor rate for the team members that perform this work?</div>
                                                <div class="nested-question-meta">Variable: <strong>staffRate</strong> | Type: number | Default: 60</div>
                                            </div>
                                            <div class="nested-question-actions">
                                                <button class="btn btn-outline" onclick="editQuestionMapping(4, 3)">Edit</button>
                                                <button class="btn btn-danger" onclick="deleteMapping(4, 3)">Remove</button>
                                            </div>
                                        </div>
                                    <button class="btn btn-outline" onclick="showAddQuestionToUseCase(4)" style="margin-top: 10px;">+ Add Another Question</button></div>
                            </div>
                        
                            <div class="use-case-section">
                                <div class="use-case-section-header">
                                    <div class="use-case-section-info">
                                        <div class="use-case-section-title">Full onboarding</div>
                                        <div class="use-case-section-meta">Category: Joiner/Mover/Leaver</div>
                                        <div class="use-case-formula">Formula: newHires * staffCount * hours * staffRate</div>
                                    </div>
                                    <div class="use-case-section-actions">
                                        <button class="btn btn-outline" onclick="editUseCase(5)">Edit</button>
                                        <button class="btn btn-danger" onclick="deleteUseCase(5)">Delete</button>
                                    </div>
                                </div>
                                <div class="nested-questions">
                                        <div class="nested-question-item">
                                            <div class="nested-question-content">
                                                <div class="nested-question-text">How many total workers (employees + third party individuals) are onboarded per month? </div>
                                                <div class="nested-question-meta">Variable: <strong>newHires</strong> | Type: number | Default: 1</div>
                                            </div>
                                            <div class="nested-question-actions">
                                                <button class="btn btn-outline" onclick="editQuestionMapping(5, 11)">Edit</button>
                                                <button class="btn btn-danger" onclick="deleteMapping(5, 11)">Remove</button>
                                            </div>
                                        </div>
                                    
                                        <div class="nested-question-item">
                                            <div class="nested-question-content">
                                                <div class="nested-question-text">How many non-security/non-IT workers are involved to onboard a new hire?</div>
                                                <div class="nested-question-meta">Variable: <strong>staffCount</strong> | Type: number | Default: 1</div>
                                            </div>
                                            <div class="nested-question-actions">
                                                <button class="btn btn-outline" onclick="editQuestionMapping(5, 13)">Edit</button>
                                                <button class="btn btn-danger" onclick="deleteMapping(5, 13)">Remove</button>
                                            </div>
                                        </div>
                                    
                                        <div class="nested-question-item">
                                            <div class="nested-question-content">
                                                <div class="nested-question-text">How many hours do these non-security/non-IT workers spend on this work?</div>
                                                <div class="nested-question-meta">Variable: <strong>hours</strong> | Type: number | Default: 1</div>
                                            </div>
                                            <div class="nested-question-actions">
                                                <button class="btn btn-outline" onclick="editQuestionMapping(5, 15)">Edit</button>
                                                <button class="btn btn-danger" onclick="deleteMapping(5, 15)">Remove</button>
                                            </div>
                                        </div>
                                    
                                        <div class="nested-question-item">
                                            <div class="nested-question-content">
                                                <div class="nested-question-text">What is the average hourly labor rate for the team members that perform this work?</div>
                                                <div class="nested-question-meta">Variable: <strong>staffRate</strong> | Type: number | Default: 60</div>
                                            </div>
                                            <div class="nested-question-actions">
                                                <button class="btn btn-outline" onclick="editQuestionMapping(5, 3)">Edit</button>
                                                <button class="btn btn-danger" onclick="deleteMapping(5, 3)">Remove</button>
                                            </div>
                                        </div>
                                    <button class="btn btn-outline" onclick="showAddQuestionToUseCase(5)" style="margin-top: 10px;">+ Add Another Question</button></div>
                            </div>
                        
                            <div class="use-case-section">
                                <div class="use-case-section-header">
                                    <div class="use-case-section-info">
                                        <div class="use-case-section-title">Full offboarding</div>
                                        <div class="use-case-section-meta">Category: Joiner/Mover/Leaver</div>
                                        <div class="use-case-formula">Formula: totalTerms * staffCount * hours * staffRate</div>
                                    </div>
                                    <div class="use-case-section-actions">
                                        <button class="btn btn-outline" onclick="editUseCase(6)">Edit</button>
                                        <button class="btn btn-danger" onclick="deleteUseCase(6)">Delete</button>
                                    </div>
                                </div>
                                <div class="nested-questions">
                                        <div class="nested-question-item">
                                            <div class="nested-question-content">
                                                <div class="nested-question-text">How many total workers (employees + third party individuals) are offboarded per month?</div>
                                                <div class="nested-question-meta">Variable: <strong>totalTerms</strong> | Type: number | Default: 1</div>
                                            </div>
                                            <div class="nested-question-actions">
                                                <button class="btn btn-outline" onclick="editQuestionMapping(6, 12)">Edit</button>
                                                <button class="btn btn-danger" onclick="deleteMapping(6, 12)">Remove</button>
                                            </div>
                                        </div>
                                    
                                        <div class="nested-question-item">
                                            <div class="nested-question-content">
                                                <div class="nested-question-text">How many non-security/non-IT workers are involved in offboarding a worker?</div>
                                                <div class="nested-question-meta">Variable: <strong>staffCount</strong> | Type: number | Default: 1</div>
                                            </div>
                                            <div class="nested-question-actions">
                                                <button class="btn btn-outline" onclick="editQuestionMapping(6, 14)">Edit</button>
                                                <button class="btn btn-danger" onclick="deleteMapping(6, 14)">Remove</button>
                                            </div>
                                        </div>
                                    
                                        <div class="nested-question-item">
                                            <div class="nested-question-content">
                                                <div class="nested-question-text">How many hours do these non-security/non-IT workers spend on this work?</div>
                                                <div class="nested-question-meta">Variable: <strong>hours</strong> | Type: number | Default: 1</div>
                                            </div>
                                            <div class="nested-question-actions">
                                                <button class="btn btn-outline" onclick="editQuestionMapping(6, 15)">Edit</button>
                                                <button class="btn btn-danger" onclick="deleteMapping(6, 15)">Remove</button>
                                            </div>
                                        </div>
                                    
                                        <div class="nested-question-item">
                                            <div class="nested-question-content">
                                                <div class="nested-question-text">What is the average hourly labor rate for the team members that perform this work?</div>
                                                <div class="nested-question-meta">Variable: <strong>staffRate</strong> | Type: number | Default: 60</div>
                                            </div>
                                            <div class="nested-question-actions">
                                                <button class="btn btn-outline" onclick="editQuestionMapping(6, 3)">Edit</button>
                                                <button class="btn btn-danger" onclick="deleteMapping(6, 3)">Remove</button>
                                            </div>
                                        </div>
                                    <button class="btn btn-outline" onclick="showAddQuestionToUseCase(6)" style="margin-top: 10px;">+ Add Another Question</button></div>
                            </div>
                        
                            <div class="use-case-section">
                                <div class="use-case-section-header">
                                    <div class="use-case-section-info">
                                        <div class="use-case-section-title">Users waiting for access to do their job</div>
                                        <div class="use-case-section-meta">Category: Access Requests</div>
                                        <div class="use-case-formula">Formula: hoursWaiting * totalUsers * staffRate</div>
                                    </div>
                                    <div class="use-case-section-actions">
                                        <button class="btn btn-outline" onclick="editUseCase(7)">Edit</button>
                                        <button class="btn btn-danger" onclick="deleteUseCase(7)">Delete</button>
                                    </div>
                                </div>
                                <div class="nested-questions">
                                        <div class="nested-question-item">
                                            <div class="nested-question-content">
                                                <div class="nested-question-text">What is the average amount of time a new user cannot perform their job responsibilities because of insufficient user account access? </div>
                                                <div class="nested-question-meta">Variable: <strong>hoursWaiting</strong> | Type: number | Default: 1</div>
                                            </div>
                                            <div class="nested-question-actions">
                                                <button class="btn btn-outline" onclick="editQuestionMapping(7, 16)">Edit</button>
                                                <button class="btn btn-danger" onclick="deleteMapping(7, 16)">Remove</button>
                                            </div>
                                        </div>
                                    
                                        <div class="nested-question-item">
                                            <div class="nested-question-content">
                                                <div class="nested-question-text">How many new users per month are unable to perform their job responsibilities because of insufficient user account access?</div>
                                                <div class="nested-question-meta">Variable: <strong>totalUsers</strong> | Type: number | Default: 1</div>
                                            </div>
                                            <div class="nested-question-actions">
                                                <button class="btn btn-outline" onclick="editQuestionMapping(7, 17)">Edit</button>
                                                <button class="btn btn-danger" onclick="deleteMapping(7, 17)">Remove</button>
                                            </div>
                                        </div>
                                    
                                        <div class="nested-question-item">
                                            <div class="nested-question-content">
                                                <div class="nested-question-text">What is the average hourly labor rate for each worker? </div>
                                                <div class="nested-question-meta">Variable: <strong>staffRate</strong> | Type: number | Default: 60</div>
                                            </div>
                                            <div class="nested-question-actions">
                                                <button class="btn btn-outline" onclick="editQuestionMapping(7, 18)">Edit</button>
                                                <button class="btn btn-danger" onclick="deleteMapping(7, 18)">Remove</button>
                                            </div>
                                        </div>
                                    <button class="btn btn-outline" onclick="showAddQuestionToUseCase(7)" style="margin-top: 10px;">+ Add Another Question</button></div>
                            </div>
                        
                            <div class="use-case-section">
                                <div class="use-case-section-header">
                                    <div class="use-case-section-info">
                                        <div class="use-case-section-title">Managing a job transfer</div>
                                        <div class="use-case-section-meta">Category: Joiner/Mover/Leaver</div>
                                        <div class="use-case-formula">Formula: numUsers * hours * staffRate</div>
                                    </div>
                                    <div class="use-case-section-actions">
                                        <button class="btn btn-outline" onclick="editUseCase(8)">Edit</button>
                                        <button class="btn btn-danger" onclick="deleteUseCase(8)">Delete</button>
                                    </div>
                                </div>
                                <div class="nested-questions">
                                        <div class="nested-question-item">
                                            <div class="nested-question-content">
                                                <div class="nested-question-text">What is the average number of job transfers that occur in a given month?</div>
                                                <div class="nested-question-meta">Variable: <strong>numUsers</strong> | Type: number | Default: 1</div>
                                            </div>
                                            <div class="nested-question-actions">
                                                <button class="btn btn-outline" onclick="editQuestionMapping(8, 19)">Edit</button>
                                                <button class="btn btn-danger" onclick="deleteMapping(8, 19)">Remove</button>
                                            </div>
                                        </div>
                                    
                                        <div class="nested-question-item">
                                            <div class="nested-question-content">
                                                <div class="nested-question-text">How many hours (on average) are spent processing a job transfer? (e.g., updating records, removing access, adding access, obtaining approvals, tracking and managing sunset dates)</div>
                                                <div class="nested-question-meta">Variable: <strong>hours</strong> | Type: number | Default: 1</div>
                                            </div>
                                            <div class="nested-question-actions">
                                                <button class="btn btn-outline" onclick="editQuestionMapping(8, 20)">Edit</button>
                                                <button class="btn btn-danger" onclick="deleteMapping(8, 20)">Remove</button>
                                            </div>
                                        </div>
                                    
                                        <div class="nested-question-item">
                                            <div class="nested-question-content">
                                                <div class="nested-question-text">What is the average hourly labor rate for the team members that perform this work?</div>
                                                <div class="nested-question-meta">Variable: <strong>staffRate</strong> | Type: number | Default: 60</div>
                                            </div>
                                            <div class="nested-question-actions">
                                                <button class="btn btn-outline" onclick="editQuestionMapping(8, 3)">Edit</button>
                                                <button class="btn btn-danger" onclick="deleteMapping(8, 3)">Remove</button>
                                            </div>
                                        </div>
                                    <button class="btn btn-outline" onclick="showAddQuestionToUseCase(8)" style="margin-top: 10px;">+ Add Another Question</button></div>
                            </div>
                        
                            <div class="use-case-section">
                                <div class="use-case-section-header">
                                    <div class="use-case-section-info">
                                        <div class="use-case-section-title">Converting employees to contractors or contractors to employees</div>
                                        <div class="use-case-section-meta">Category: Joiner/Mover/Leaver</div>
                                        <div class="use-case-formula">Formula: numUsers * hours * staffRate</div>
                                    </div>
                                    <div class="use-case-section-actions">
                                        <button class="btn btn-outline" onclick="editUseCase(9)">Edit</button>
                                        <button class="btn btn-danger" onclick="deleteUseCase(9)">Delete</button>
                                    </div>
                                </div>
                                <div class="nested-questions">
                                        <div class="nested-question-item">
                                            <div class="nested-question-content">
                                                <div class="nested-question-text">What is the average number of worker conversions (e.g., FTE to contractor, contractor to FTE) that occur in a given month?</div>
                                                <div class="nested-question-meta">Variable: <strong>numUsers</strong> | Type: number | Default: 1</div>
                                            </div>
                                            <div class="nested-question-actions">
                                                <button class="btn btn-outline" onclick="editQuestionMapping(9, 22)">Edit</button>
                                                <button class="btn btn-danger" onclick="deleteMapping(9, 22)">Remove</button>
                                            </div>
                                        </div>
                                    
                                        <div class="nested-question-item">
                                            <div class="nested-question-content">
                                                <div class="nested-question-text">How many hours (on average) are spent processing these requests?</div>
                                                <div class="nested-question-meta">Variable: <strong>hours</strong> | Type: number | Default: 1</div>
                                            </div>
                                            <div class="nested-question-actions">
                                                <button class="btn btn-outline" onclick="editQuestionMapping(9, 21)">Edit</button>
                                                <button class="btn btn-danger" onclick="deleteMapping(9, 21)">Remove</button>
                                            </div>
                                        </div>
                                    
                                        <div class="nested-question-item">
                                            <div class="nested-question-content">
                                                <div class="nested-question-text">What is the average hourly labor rate for the team members that perform this work?</div>
                                                <div class="nested-question-meta">Variable: <strong>staffRate</strong> | Type: number | Default: 60</div>
                                            </div>
                                            <div class="nested-question-actions">
                                                <button class="btn btn-outline" onclick="editQuestionMapping(9, 3)">Edit</button>
                                                <button class="btn btn-danger" onclick="deleteMapping(9, 3)">Remove</button>
                                            </div>
                                        </div>
                                    <button class="btn btn-outline" onclick="showAddQuestionToUseCase(9)" style="margin-top: 10px;">+ Add Another Question</button></div>
                            </div>
                        
                            <div class="use-case-section">
                                <div class="use-case-section-header">
                                    <div class="use-case-section-info">
                                        <div class="use-case-section-title">Rehires</div>
                                        <div class="use-case-section-meta">Category: Joiner/Mover/Leaver</div>
                                        <div class="use-case-formula">Formula: numUsers * hours * staffRate</div>
                                    </div>
                                    <div class="use-case-section-actions">
                                        <button class="btn btn-outline" onclick="editUseCase(10)">Edit</button>
                                        <button class="btn btn-danger" onclick="deleteUseCase(10)">Delete</button>
                                    </div>
                                </div>
                                <div class="nested-questions">
                                        <div class="nested-question-item">
                                            <div class="nested-question-content">
                                                <div class="nested-question-text">What is the average number of rehires that occur in a given month?</div>
                                                <div class="nested-question-meta">Variable: <strong>numUsers</strong> | Type: number | Default: 1</div>
                                            </div>
                                            <div class="nested-question-actions">
                                                <button class="btn btn-outline" onclick="editQuestionMapping(10, 23)">Edit</button>
                                                <button class="btn btn-danger" onclick="deleteMapping(10, 23)">Remove</button>
                                            </div>
                                        </div>
                                    
                                        <div class="nested-question-item">
                                            <div class="nested-question-content">
                                                <div class="nested-question-text">How many hours (on average) are spent processing these requests?</div>
                                                <div class="nested-question-meta">Variable: <strong>hours</strong> | Type: number | Default: 1</div>
                                            </div>
                                            <div class="nested-question-actions">
                                                <button class="btn btn-outline" onclick="editQuestionMapping(10, 21)">Edit</button>
                                                <button class="btn btn-danger" onclick="deleteMapping(10, 21)">Remove</button>
                                            </div>
                                        </div>
                                    
                                        <div class="nested-question-item">
                                            <div class="nested-question-content">
                                                <div class="nested-question-text">What is the average hourly labor rate for the team members that perform this work?</div>
                                                <div class="nested-question-meta">Variable: <strong>staffRate</strong> | Type: number | Default: 60</div>
                                            </div>
                                            <div class="nested-question-actions">
                                                <button class="btn btn-outline" onclick="editQuestionMapping(10, 3)">Edit</button>
                                                <button class="btn btn-danger" onclick="deleteMapping(10, 3)">Remove</button>
                                            </div>
                                        </div>
                                    <button class="btn btn-outline" onclick="showAddQuestionToUseCase(10)" style="margin-top: 10px;">+ Add Another Question</button></div>
                            </div>
                        
                            <div class="use-case-section">
                                <div class="use-case-section-header">
                                    <div class="use-case-section-info">
                                        <div class="use-case-section-title">Rescinded offers</div>
                                        <div class="use-case-section-meta">Category: Joiner/Mover/Leaver</div>
                                        <div class="use-case-formula">Formula: numUsers * hours * staffRate</div>
                                    </div>
                                    <div class="use-case-section-actions">
                                        <button class="btn btn-outline" onclick="editUseCase(11)">Edit</button>
                                        <button class="btn btn-danger" onclick="deleteUseCase(11)">Delete</button>
                                    </div>
                                </div>
                                <div class="nested-questions">
                                        <div class="nested-question-item">
                                            <div class="nested-question-content">
                                                <div class="nested-question-text">What is the average number of rescinded offers that occur in a given month?</div>
                                                <div class="nested-question-meta">Variable: <strong>numUsers</strong> | Type: number | Default: 1</div>
                                            </div>
                                            <div class="nested-question-actions">
                                                <button class="btn btn-outline" onclick="editQuestionMapping(11, 24)">Edit</button>
                                                <button class="btn btn-danger" onclick="deleteMapping(11, 24)">Remove</button>
                                            </div>
                                        </div>
                                    
                                        <div class="nested-question-item">
                                            <div class="nested-question-content">
                                                <div class="nested-question-text">How many hours (on average) are spent processing these requests?</div>
                                                <div class="nested-question-meta">Variable: <strong>hours</strong> | Type: number | Default: 1</div>
                                            </div>
                                            <div class="nested-question-actions">
                                                <button class="btn btn-outline" onclick="editQuestionMapping(11, 21)">Edit</button>
                                                <button class="btn btn-danger" onclick="deleteMapping(11, 21)">Remove</button>
                                            </div>
                                        </div>
                                    
                                        <div class="nested-question-item">
                                            <div class="nested-question-content">
                                                <div class="nested-question-text">What is the average hourly labor rate for the team members that perform this work?</div>
                                                <div class="nested-question-meta">Variable: <strong>staffRate</strong> | Type: number | Default: 60</div>
                                            </div>
                                            <div class="nested-question-actions">
                                                <button class="btn btn-outline" onclick="editQuestionMapping(11, 3)">Edit</button>
                                                <button class="btn btn-danger" onclick="deleteMapping(11, 3)">Remove</button>
                                            </div>
                                        </div>
                                    <button class="btn btn-outline" onclick="showAddQuestionToUseCase(11)" style="margin-top: 10px;">+ Add Another Question</button></div>
                            </div>
                        <button class="btn btn-outline" onclick="showAddUseCaseForm(1)" style="margin-top: 10px;">+ Add Another Use Case</button>
                </div><div class="domain-config-section">
                    <div class="domain-config-header">
                        <div class="domain-config-title">üë§ CIAM</div>
                        <div style="display: flex; gap: 10px;">
                            <button class="btn btn-outline" onclick="editDomain(2)">Edit Domain</button>
                            <button class="btn btn-danger" onclick="deleteDomain(2)">Delete Domain</button>
                        </div>
                    </div>
                    
                        <div class="add-question-prompt">
                            <p>No use cases in this domain yet.</p>
                            <button class="btn btn-outline" onclick="showAddUseCaseForm(2)">+ Add Use Case</button>
                        </div>
                    
                </div><div class="domain-config-section">
                    <div class="domain-config-header">
                        <div class="domain-config-title">üîë PAM</div>
                        <div style="display: flex; gap: 10px;">
                            <button class="btn btn-outline" onclick="editDomain(3)">Edit Domain</button>
                            <button class="btn btn-danger" onclick="deleteDomain(3)">Delete Domain</button>
                        </div>
                    </div>
                    
                            <div class="use-case-section">
                                <div class="use-case-section-header">
                                    <div class="use-case-section-info">
                                        <div class="use-case-section-title">Onboarding privileged accounts into PAM tool</div>
                                        <div class="use-case-section-meta">Category: PAM Onboarding</div>
                                        <div class="use-case-formula">Formula: numAccounts * hours * staffRate</div>
                                    </div>
                                    <div class="use-case-section-actions">
                                        <button class="btn btn-outline" onclick="editUseCase(12)">Edit</button>
                                        <button class="btn btn-danger" onclick="deleteUseCase(12)">Delete</button>
                                    </div>
                                </div>
                                <div class="nested-questions">
                                        <div class="nested-question-item">
                                            <div class="nested-question-content">
                                                <div class="nested-question-text">Hour many privileged accounts (on average) are onboarded into your PAM tool in a given month?</div>
                                                <div class="nested-question-meta">Variable: <strong>numAccounts</strong> | Type: number | Default: 1</div>
                                            </div>
                                            <div class="nested-question-actions">
                                                <button class="btn btn-outline" onclick="editQuestionMapping(12, 25)">Edit</button>
                                                <button class="btn btn-danger" onclick="deleteMapping(12, 25)">Remove</button>
                                            </div>
                                        </div>
                                    
                                        <div class="nested-question-item">
                                            <div class="nested-question-content">
                                                <div class="nested-question-text">How many hours (on average) are spent processing these requests?</div>
                                                <div class="nested-question-meta">Variable: <strong>hours</strong> | Type: number | Default: 1</div>
                                            </div>
                                            <div class="nested-question-actions">
                                                <button class="btn btn-outline" onclick="editQuestionMapping(12, 21)">Edit</button>
                                                <button class="btn btn-danger" onclick="deleteMapping(12, 21)">Remove</button>
                                            </div>
                                        </div>
                                    
                                        <div class="nested-question-item">
                                            <div class="nested-question-content">
                                                <div class="nested-question-text">What is the average hourly labor rate for the team members that perform this work?</div>
                                                <div class="nested-question-meta">Variable: <strong>staffRate</strong> | Type: number | Default: 60</div>
                                            </div>
                                            <div class="nested-question-actions">
                                                <button class="btn btn-outline" onclick="editQuestionMapping(12, 3)">Edit</button>
                                                <button class="btn btn-danger" onclick="deleteMapping(12, 3)">Remove</button>
                                            </div>
                                        </div>
                                    <button class="btn btn-outline" onclick="showAddQuestionToUseCase(12)" style="margin-top: 10px;">+ Add Another Question</button></div>
                            </div>
                        
                            <div class="use-case-section">
                                <div class="use-case-section-header">
                                    <div class="use-case-section-info">
                                        <div class="use-case-section-title">Requests for new privileged accounts</div>
                                        <div class="use-case-section-meta">Category: PAM Access Requests</div>
                                        <div class="use-case-formula">Formula: numRequests * hours * staffRate</div>
                                    </div>
                                    <div class="use-case-section-actions">
                                        <button class="btn btn-outline" onclick="editUseCase(13)">Edit</button>
                                        <button class="btn btn-danger" onclick="deleteUseCase(13)">Delete</button>
                                    </div>
                                </div>
                                <div class="nested-questions">
                                        <div class="nested-question-item">
                                            <div class="nested-question-content">
                                                <div class="nested-question-text">What is the average number of new privileged account requests completed in a given month?</div>
                                                <div class="nested-question-meta">Variable: <strong>numRequests</strong> | Type: number | Default: 1</div>
                                            </div>
                                            <div class="nested-question-actions">
                                                <button class="btn btn-outline" onclick="editQuestionMapping(13, 26)">Edit</button>
                                                <button class="btn btn-danger" onclick="deleteMapping(13, 26)">Remove</button>
                                            </div>
                                        </div>
                                    
                                        <div class="nested-question-item">
                                            <div class="nested-question-content">
                                                <div class="nested-question-text">How many hours (on average) are spent processing these requests?</div>
                                                <div class="nested-question-meta">Variable: <strong>hours</strong> | Type: number | Default: 1</div>
                                            </div>
                                            <div class="nested-question-actions">
                                                <button class="btn btn-outline" onclick="editQuestionMapping(13, 21)">Edit</button>
                                                <button class="btn btn-danger" onclick="deleteMapping(13, 21)">Remove</button>
                                            </div>
                                        </div>
                                    
                                        <div class="nested-question-item">
                                            <div class="nested-question-content">
                                                <div class="nested-question-text">What is the average hourly labor rate for the team members that perform this work?</div>
                                                <div class="nested-question-meta">Variable: <strong>staffRate</strong> | Type: number | Default: 60</div>
                                            </div>
                                            <div class="nested-question-actions">
                                                <button class="btn btn-outline" onclick="editQuestionMapping(13, 3)">Edit</button>
                                                <button class="btn btn-danger" onclick="deleteMapping(13, 3)">Remove</button>
                                            </div>
                                        </div>
                                    <button class="btn btn-outline" onclick="showAddQuestionToUseCase(13)" style="margin-top: 10px;">+ Add Another Question</button></div>
                            </div>
                        
                            <div class="use-case-section">
                                <div class="use-case-section-header">
                                    <div class="use-case-section-info">
                                        <div class="use-case-section-title">Support for privileged accounts (e.g., syncing errors, credential rotation failures, user training)</div>
                                        <div class="use-case-section-meta">Category: PAM - Operational</div>
                                        <div class="use-case-formula">Formula: numRequests * hours * staffRate</div>
                                    </div>
                                    <div class="use-case-section-actions">
                                        <button class="btn btn-outline" onclick="editUseCase(14)">Edit</button>
                                        <button class="btn btn-danger" onclick="deleteUseCase(14)">Delete</button>
                                    </div>
                                </div>
                                <div class="nested-questions">
                                        <div class="nested-question-item">
                                            <div class="nested-question-content">
                                                <div class="nested-question-text">How many requests for privileged account support are received in a given month? (e.g., syncing errors, credential rotation failures, user training)</div>
                                                <div class="nested-question-meta">Variable: <strong>numRequests</strong> | Type: number | Default: 1</div>
                                            </div>
                                            <div class="nested-question-actions">
                                                <button class="btn btn-outline" onclick="editQuestionMapping(14, 27)">Edit</button>
                                                <button class="btn btn-danger" onclick="deleteMapping(14, 27)">Remove</button>
                                            </div>
                                        </div>
                                    
                                        <div class="nested-question-item">
                                            <div class="nested-question-content">
                                                <div class="nested-question-text">How many hours (on average) are spent processing these requests?</div>
                                                <div class="nested-question-meta">Variable: <strong>hours</strong> | Type: number | Default: 1</div>
                                            </div>
                                            <div class="nested-question-actions">
                                                <button class="btn btn-outline" onclick="editQuestionMapping(14, 21)">Edit</button>
                                                <button class="btn btn-danger" onclick="deleteMapping(14, 21)">Remove</button>
                                            </div>
                                        </div>
                                    
                                        <div class="nested-question-item">
                                            <div class="nested-question-content">
                                                <div class="nested-question-text">What is the average hourly labor rate for the team members that perform this work?</div>
                                                <div class="nested-question-meta">Variable: <strong>staffRate</strong> | Type: number | Default: 60</div>
                                            </div>
                                            <div class="nested-question-actions">
                                                <button class="btn btn-outline" onclick="editQuestionMapping(14, 3)">Edit</button>
                                                <button class="btn btn-danger" onclick="deleteMapping(14, 3)">Remove</button>
                                            </div>
                                        </div>
                                    <button class="btn btn-outline" onclick="showAddQuestionToUseCase(14)" style="margin-top: 10px;">+ Add Another Question</button></div>
                            </div>
                        
                            <div class="use-case-section">
                                <div class="use-case-section-header">
                                    <div class="use-case-section-info">
                                        <div class="use-case-section-title">Privileged access audit requests</div>
                                        <div class="use-case-section-meta">Category: PAM - Operational</div>
                                        <div class="use-case-formula">Formula: numRequests * hours * staffRate</div>
                                    </div>
                                    <div class="use-case-section-actions">
                                        <button class="btn btn-outline" onclick="editUseCase(15)">Edit</button>
                                        <button class="btn btn-danger" onclick="deleteUseCase(15)">Delete</button>
                                    </div>
                                </div>
                                <div class="nested-questions">
                                        <div class="nested-question-item">
                                            <div class="nested-question-content">
                                                <div class="nested-question-text">What is the average number of audit/compliance requests for privileged access controls in a given month? </div>
                                                <div class="nested-question-meta">Variable: <strong>numRequests</strong> | Type: number | Default: 1</div>
                                            </div>
                                            <div class="nested-question-actions">
                                                <button class="btn btn-outline" onclick="editQuestionMapping(15, 28)">Edit</button>
                                                <button class="btn btn-danger" onclick="deleteMapping(15, 28)">Remove</button>
                                            </div>
                                        </div>
                                    
                                        <div class="nested-question-item">
                                            <div class="nested-question-content">
                                                <div class="nested-question-text">How many hours (on average) are spent processing these requests?</div>
                                                <div class="nested-question-meta">Variable: <strong>hours</strong> | Type: number | Default: 1</div>
                                            </div>
                                            <div class="nested-question-actions">
                                                <button class="btn btn-outline" onclick="editQuestionMapping(15, 21)">Edit</button>
                                                <button class="btn btn-danger" onclick="deleteMapping(15, 21)">Remove</button>
                                            </div>
                                        </div>
                                    
                                        <div class="nested-question-item">
                                            <div class="nested-question-content">
                                                <div class="nested-question-text">What is the average hourly labor rate for the team members that perform this work?</div>
                                                <div class="nested-question-meta">Variable: <strong>staffRate</strong> | Type: number | Default: 60</div>
                                            </div>
                                            <div class="nested-question-actions">
                                                <button class="btn btn-outline" onclick="editQuestionMapping(15, 3)">Edit</button>
                                                <button class="btn btn-danger" onclick="deleteMapping(15, 3)">Remove</button>
                                            </div>
                                        </div>
                                    <button class="btn btn-outline" onclick="showAddQuestionToUseCase(15)" style="margin-top: 10px;">+ Add Another Question</button></div>
                            </div>
                        <button class="btn btn-outline" onclick="showAddUseCaseForm(3)" style="margin-top: 10px;">+ Add Another Use Case</button>
                </div><div class="domain-config-section">
                    <div class="domain-config-header">
                        <div class="domain-config-title">üö™ Access Management</div>
                        <div style="display: flex; gap: 10px;">
                            <button class="btn btn-outline" onclick="editDomain(4)">Edit Domain</button>
                            <button class="btn btn-danger" onclick="deleteDomain(4)">Delete Domain</button>
                        </div>
                    </div>
                    
                            <div class="use-case-section">
                                <div class="use-case-section-header">
                                    <div class="use-case-section-info">
                                        <div class="use-case-section-title">Password resets</div>
                                        <div class="use-case-section-meta">Category: Credential Management</div>
                                        <div class="use-case-formula">Formula: numResets * (minutes/60) * staffRate</div>
                                    </div>
                                    <div class="use-case-section-actions">
                                        <button class="btn btn-outline" onclick="editUseCase(16)">Edit</button>
                                        <button class="btn btn-danger" onclick="deleteUseCase(16)">Delete</button>
                                    </div>
                                </div>
                                <div class="nested-questions">
                                        <div class="nested-question-item">
                                            <div class="nested-question-content">
                                                <div class="nested-question-text">How many password resets are performed in a given month?</div>
                                                <div class="nested-question-meta">Variable: <strong>numResets</strong> | Type: number | Default: 1</div>
                                            </div>
                                            <div class="nested-question-actions">
                                                <button class="btn btn-outline" onclick="editQuestionMapping(16, 29)">Edit</button>
                                                <button class="btn btn-danger" onclick="deleteMapping(16, 29)">Remove</button>
                                            </div>
                                        </div>
                                    
                                        <div class="nested-question-item">
                                            <div class="nested-question-content">
                                                <div class="nested-question-text">How many minutes (on average) are spent processing these requests?</div>
                                                <div class="nested-question-meta">Variable: <strong>minutes</strong> | Type: number | Default: 1</div>
                                            </div>
                                            <div class="nested-question-actions">
                                                <button class="btn btn-outline" onclick="editQuestionMapping(16, 30)">Edit</button>
                                                <button class="btn btn-danger" onclick="deleteMapping(16, 30)">Remove</button>
                                            </div>
                                        </div>
                                    
                                        <div class="nested-question-item">
                                            <div class="nested-question-content">
                                                <div class="nested-question-text">What is the average hourly labor rate for the team members that perform this work?</div>
                                                <div class="nested-question-meta">Variable: <strong>staffRate</strong> | Type: number | Default: 60</div>
                                            </div>
                                            <div class="nested-question-actions">
                                                <button class="btn btn-outline" onclick="editQuestionMapping(16, 3)">Edit</button>
                                                <button class="btn btn-danger" onclick="deleteMapping(16, 3)">Remove</button>
                                            </div>
                                        </div>
                                    <button class="btn btn-outline" onclick="showAddQuestionToUseCase(16)" style="margin-top: 10px;">+ Add Another Question</button></div>
                            </div>
                        
                            <div class="use-case-section">
                                <div class="use-case-section-header">
                                    <div class="use-case-section-info">
                                        <div class="use-case-section-title">SSO application onboarding</div>
                                        <div class="use-case-section-meta">Category: Implementation</div>
                                        <div class="use-case-formula">Formula: numApps * hours * staffRate</div>
                                    </div>
                                    <div class="use-case-section-actions">
                                        <button class="btn btn-outline" onclick="editUseCase(17)">Edit</button>
                                        <button class="btn btn-danger" onclick="deleteUseCase(17)">Delete</button>
                                    </div>
                                </div>
                                <div class="nested-questions">
                                        <div class="nested-question-item">
                                            <div class="nested-question-content">
                                                <div class="nested-question-text">What is the average number of applications onboarded into the enterprise SSO solution per month?</div>
                                                <div class="nested-question-meta">Variable: <strong>numApps</strong> | Type: number | Default: 1</div>
                                            </div>
                                            <div class="nested-question-actions">
                                                <button class="btn btn-outline" onclick="editQuestionMapping(17, 31)">Edit</button>
                                                <button class="btn btn-danger" onclick="deleteMapping(17, 31)">Remove</button>
                                            </div>
                                        </div>
                                    
                                        <div class="nested-question-item">
                                            <div class="nested-question-content">
                                                <div class="nested-question-text">How many hours (on average) are spent on this work?</div>
                                                <div class="nested-question-meta">Variable: <strong>hours</strong> | Type: number | Default: 1</div>
                                            </div>
                                            <div class="nested-question-actions">
                                                <button class="btn btn-outline" onclick="editQuestionMapping(17, 32)">Edit</button>
                                                <button class="btn btn-danger" onclick="deleteMapping(17, 32)">Remove</button>
                                            </div>
                                        </div>
                                    
                                        <div class="nested-question-item">
                                            <div class="nested-question-content">
                                                <div class="nested-question-text">What is the average hourly labor rate for the team members that perform this work?</div>
                                                <div class="nested-question-meta">Variable: <strong>staffRate</strong> | Type: number | Default: 60</div>
                                            </div>
                                            <div class="nested-question-actions">
                                                <button class="btn btn-outline" onclick="editQuestionMapping(17, 3)">Edit</button>
                                                <button class="btn btn-danger" onclick="deleteMapping(17, 3)">Remove</button>
                                            </div>
                                        </div>
                                    <button class="btn btn-outline" onclick="showAddQuestionToUseCase(17)" style="margin-top: 10px;">+ Add Another Question</button></div>
                            </div>
                        
                            <div class="use-case-section">
                                <div class="use-case-section-header">
                                    <div class="use-case-section-info">
                                        <div class="use-case-section-title">User support for SSO failure</div>
                                        <div class="use-case-section-meta">Category: Operational</div>
                                        <div class="use-case-formula">Formula: numFailures * (minutes/60) * staffRate</div>
                                    </div>
                                    <div class="use-case-section-actions">
                                        <button class="btn btn-outline" onclick="editUseCase(18)">Edit</button>
                                        <button class="btn btn-danger" onclick="deleteUseCase(18)">Delete</button>
                                    </div>
                                </div>
                                <div class="nested-questions">
                                        <div class="nested-question-item">
                                            <div class="nested-question-content">
                                                <div class="nested-question-text">What is the average number of SSO failure tickets investigated in a given month?</div>
                                                <div class="nested-question-meta">Variable: <strong>numFailures</strong> | Type: number | Default: 1</div>
                                            </div>
                                            <div class="nested-question-actions">
                                                <button class="btn btn-outline" onclick="editQuestionMapping(18, 33)">Edit</button>
                                                <button class="btn btn-danger" onclick="deleteMapping(18, 33)">Remove</button>
                                            </div>
                                        </div>
                                    
                                        <div class="nested-question-item">
                                            <div class="nested-question-content">
                                                <div class="nested-question-text">How many minutes (on average) are spent processing these requests?</div>
                                                <div class="nested-question-meta">Variable: <strong>minutes</strong> | Type: number | Default: 1</div>
                                            </div>
                                            <div class="nested-question-actions">
                                                <button class="btn btn-outline" onclick="editQuestionMapping(18, 30)">Edit</button>
                                                <button class="btn btn-danger" onclick="deleteMapping(18, 30)">Remove</button>
                                            </div>
                                        </div>
                                    
                                        <div class="nested-question-item">
                                            <div class="nested-question-content">
                                                <div class="nested-question-text">What is the average hourly labor rate for the team members that perform this work?</div>
                                                <div class="nested-question-meta">Variable: <strong>staffRate</strong> | Type: number | Default: 60</div>
                                            </div>
                                            <div class="nested-question-actions">
                                                <button class="btn btn-outline" onclick="editQuestionMapping(18, 3)">Edit</button>
                                                <button class="btn btn-danger" onclick="deleteMapping(18, 3)">Remove</button>
                                            </div>
                                        </div>
                                    <button class="btn btn-outline" onclick="showAddQuestionToUseCase(18)" style="margin-top: 10px;">+ Add Another Question</button></div>
                            </div>
                        
                            <div class="use-case-section">
                                <div class="use-case-section-header">
                                    <div class="use-case-section-info">
                                        <div class="use-case-section-title">Users unable to login</div>
                                        <div class="use-case-section-meta">Category: Operational</div>
                                        <div class="use-case-formula">Formula: numLockouts * (minutes/60) * staffRate</div>
                                    </div>
                                    <div class="use-case-section-actions">
                                        <button class="btn btn-outline" onclick="editUseCase(19)">Edit</button>
                                        <button class="btn btn-danger" onclick="deleteUseCase(19)">Delete</button>
                                    </div>
                                </div>
                                <div class="nested-questions">
                                        <div class="nested-question-item">
                                            <div class="nested-question-content">
                                                <div class="nested-question-text">What is the average number of SSO failure tickets investigated in a given month?</div>
                                                <div class="nested-question-meta">Variable: <strong>numLockouts</strong> | Type: number | Default: 1</div>
                                            </div>
                                            <div class="nested-question-actions">
                                                <button class="btn btn-outline" onclick="editQuestionMapping(19, 33)">Edit</button>
                                                <button class="btn btn-danger" onclick="deleteMapping(19, 33)">Remove</button>
                                            </div>
                                        </div>
                                    
                                        <div class="nested-question-item">
                                            <div class="nested-question-content">
                                                <div class="nested-question-text">What is the average time to completion (in minutes) for each of these requests?</div>
                                                <div class="nested-question-meta">Variable: <strong>minutes</strong> | Type: number | Default: 1</div>
                                            </div>
                                            <div class="nested-question-actions">
                                                <button class="btn btn-outline" onclick="editQuestionMapping(19, 34)">Edit</button>
                                                <button class="btn btn-danger" onclick="deleteMapping(19, 34)">Remove</button>
                                            </div>
                                        </div>
                                    
                                        <div class="nested-question-item">
                                            <div class="nested-question-content">
                                                <div class="nested-question-text">What is the average hourly labor rate for a user impacted by this delay?</div>
                                                <div class="nested-question-meta">Variable: <strong>staffRate</strong> | Type: number | Default: 60</div>
                                            </div>
                                            <div class="nested-question-actions">
                                                <button class="btn btn-outline" onclick="editQuestionMapping(19, 35)">Edit</button>
                                                <button class="btn btn-danger" onclick="deleteMapping(19, 35)">Remove</button>
                                            </div>
                                        </div>
                                    <button class="btn btn-outline" onclick="showAddQuestionToUseCase(19)" style="margin-top: 10px;">+ Add Another Question</button></div>
                            </div>
                        
                            <div class="use-case-section">
                                <div class="use-case-section-header">
                                    <div class="use-case-section-info">
                                        <div class="use-case-section-title">MFA support</div>
                                        <div class="use-case-section-meta">Category: Operational</div>
                                        <div class="use-case-formula">Formula: numTickets * (minutes/60) * staffRate</div>
                                    </div>
                                    <div class="use-case-section-actions">
                                        <button class="btn btn-outline" onclick="editUseCase(20)">Edit</button>
                                        <button class="btn btn-danger" onclick="deleteUseCase(20)">Delete</button>
                                    </div>
                                </div>
                                <div class="nested-questions">
                                        <div class="nested-question-item">
                                            <div class="nested-question-content">
                                                <div class="nested-question-text">What is the average number of MFA support tickets submitted each month?</div>
                                                <div class="nested-question-meta">Variable: <strong>numTickets</strong> | Type: number | Default: 1</div>
                                            </div>
                                            <div class="nested-question-actions">
                                                <button class="btn btn-outline" onclick="editQuestionMapping(20, 36)">Edit</button>
                                                <button class="btn btn-danger" onclick="deleteMapping(20, 36)">Remove</button>
                                            </div>
                                        </div>
                                    
                                        <div class="nested-question-item">
                                            <div class="nested-question-content">
                                                <div class="nested-question-text">What is the average time to completion (in minutes) for each of these requests?</div>
                                                <div class="nested-question-meta">Variable: <strong>minutes</strong> | Type: number | Default: 1</div>
                                            </div>
                                            <div class="nested-question-actions">
                                                <button class="btn btn-outline" onclick="editQuestionMapping(20, 34)">Edit</button>
                                                <button class="btn btn-danger" onclick="deleteMapping(20, 34)">Remove</button>
                                            </div>
                                        </div>
                                    
                                        <div class="nested-question-item">
                                            <div class="nested-question-content">
                                                <div class="nested-question-text">What is the average hourly labor rate for the team members that perform this work?</div>
                                                <div class="nested-question-meta">Variable: <strong>staffRate</strong> | Type: number | Default: 60</div>
                                            </div>
                                            <div class="nested-question-actions">
                                                <button class="btn btn-outline" onclick="editQuestionMapping(20, 3)">Edit</button>
                                                <button class="btn btn-danger" onclick="deleteMapping(20, 3)">Remove</button>
                                            </div>
                                        </div>
                                    <button class="btn btn-outline" onclick="showAddQuestionToUseCase(20)" style="margin-top: 10px;">+ Add Another Question</button></div>
                            </div>
                        
                            <div class="use-case-section">
                                <div class="use-case-section-header">
                                    <div class="use-case-section-info">
                                        <div class="use-case-section-title">Extended (non-security/non-IT) app onboarding costs</div>
                                        <div class="use-case-section-meta">Category: Implementation</div>
                                        <div class="use-case-formula">Formula: numUsers * hours * staffRate</div>
                                    </div>
                                    <div class="use-case-section-actions">
                                        <button class="btn btn-outline" onclick="editUseCase(21)">Edit</button>
                                        <button class="btn btn-danger" onclick="deleteUseCase(21)">Delete</button>
                                    </div>
                                </div>
                                <div class="nested-questions">
                                        <div class="nested-question-item">
                                            <div class="nested-question-content">
                                                <div class="nested-question-text">In a given month, how many business line users (e.g., SMEs, application owners) are involved in onboarding applications into the enterprise SSO solution?</div>
                                                <div class="nested-question-meta">Variable: <strong>numUsers</strong> | Type: number | Default: 1</div>
                                            </div>
                                            <div class="nested-question-actions">
                                                <button class="btn btn-outline" onclick="editQuestionMapping(21, 37)">Edit</button>
                                                <button class="btn btn-danger" onclick="deleteMapping(21, 37)">Remove</button>
                                            </div>
                                        </div>
                                    
                                        <div class="nested-question-item">
                                            <div class="nested-question-content">
                                                <div class="nested-question-text">How many hours (on average) are spent on this work?</div>
                                                <div class="nested-question-meta">Variable: <strong>hours</strong> | Type: number | Default: 1</div>
                                            </div>
                                            <div class="nested-question-actions">
                                                <button class="btn btn-outline" onclick="editQuestionMapping(21, 32)">Edit</button>
                                                <button class="btn btn-danger" onclick="deleteMapping(21, 32)">Remove</button>
                                            </div>
                                        </div>
                                    
                                        <div class="nested-question-item">
                                            <div class="nested-question-content">
                                                <div class="nested-question-text">What is the average hourly labor rate for the team members that perform this work?</div>
                                                <div class="nested-question-meta">Variable: <strong>staffRate</strong> | Type: number | Default: 60</div>
                                            </div>
                                            <div class="nested-question-actions">
                                                <button class="btn btn-outline" onclick="editQuestionMapping(21, 3)">Edit</button>
                                                <button class="btn btn-danger" onclick="deleteMapping(21, 3)">Remove</button>
                                            </div>
                                        </div>
                                    <button class="btn btn-outline" onclick="showAddQuestionToUseCase(21)" style="margin-top: 10px;">+ Add Another Question</button></div>
                            </div>
                        
                            <div class="use-case-section">
                                <div class="use-case-section-header">
                                    <div class="use-case-section-info">
                                        <div class="use-case-section-title">Access management change management</div>
                                        <div class="use-case-section-meta">Category: Change Management</div>
                                        <div class="use-case-formula">Formula: changeRequests * hours * staffRate</div>
                                    </div>
                                    <div class="use-case-section-actions">
                                        <button class="btn btn-outline" onclick="editUseCase(22)">Edit</button>
                                        <button class="btn btn-danger" onclick="deleteUseCase(22)">Delete</button>
                                    </div>
                                </div>
                                <div class="nested-questions">
                                        <div class="nested-question-item">
                                            <div class="nested-question-content">
                                                <div class="nested-question-text">In a given month, how many change requests (on average) are submitted for the technologies supporting authentication?</div>
                                                <div class="nested-question-meta">Variable: <strong>changeRequests</strong> | Type: number | Default: 1</div>
                                            </div>
                                            <div class="nested-question-actions">
                                                <button class="btn btn-outline" onclick="editQuestionMapping(22, 38)">Edit</button>
                                                <button class="btn btn-danger" onclick="deleteMapping(22, 38)">Remove</button>
                                            </div>
                                        </div>
                                    
                                        <div class="nested-question-item">
                                            <div class="nested-question-content">
                                                <div class="nested-question-text">On average, how much time (in hours) is spent creating and managing each change request?</div>
                                                <div class="nested-question-meta">Variable: <strong>hours</strong> | Type: number | Default: 1</div>
                                            </div>
                                            <div class="nested-question-actions">
                                                <button class="btn btn-outline" onclick="editQuestionMapping(22, 39)">Edit</button>
                                                <button class="btn btn-danger" onclick="deleteMapping(22, 39)">Remove</button>
                                            </div>
                                        </div>
                                    
                                        <div class="nested-question-item">
                                            <div class="nested-question-content">
                                                <div class="nested-question-text">What is the average hourly labor rate for the team members that perform this work?</div>
                                                <div class="nested-question-meta">Variable: <strong>staffRate</strong> | Type: number | Default: 60</div>
                                            </div>
                                            <div class="nested-question-actions">
                                                <button class="btn btn-outline" onclick="editQuestionMapping(22, 3)">Edit</button>
                                                <button class="btn btn-danger" onclick="deleteMapping(22, 3)">Remove</button>
                                            </div>
                                        </div>
                                    <button class="btn btn-outline" onclick="showAddQuestionToUseCase(22)" style="margin-top: 10px;">+ Add Another Question</button></div>
                            </div>
                        <button class="btn btn-outline" onclick="showAddUseCaseForm(4)" style="margin-top: 10px;">+ Add Another Use Case</button>
                </div></div>
            </div>

            <div class="card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h2 class="section-title" style="margin: 0; border: none; padding: 0;">Questions Library</h2>
                    <button class="btn btn-primary" onclick="showAddQuestionForm()">+ Add Question</button>
                </div>
                <p style="margin-bottom: 25px; color: var(--idm-gray);">
                    Create reusable questions that can be assigned to any use case across all domains.
                </p>
                <div id="question-library"><div class="list-item">
                    <div class="list-item-content">
                        <div class="list-item-title">How many internal new hires are onboarded per month?</div>
                        <div class="list-item-meta">Type: number | Default: 1 | Used in 1 use case</div>
                    </div>
                    <div class="list-item-actions">
                        <button class="btn btn-outline" onclick="editQuestion(1)">Edit</button>
                        <button class="btn btn-danger" onclick="deleteQuestion(1)">Delete</button>
                    </div>
                </div><div class="list-item">
                    <div class="list-item-content">
                        <div class="list-item-title">How many hours (on average) are spent manually provisioning these people?</div>
                        <div class="list-item-meta">Type: number | Default: 1 | Used in 2 use cases</div>
                    </div>
                    <div class="list-item-actions">
                        <button class="btn btn-outline" onclick="editQuestion(2)">Edit</button>
                        <button class="btn btn-danger" onclick="deleteQuestion(2)">Delete</button>
                    </div>
                </div><div class="list-item">
                    <div class="list-item-content">
                        <div class="list-item-title">What is the average hourly labor rate for the team members that perform this work?</div>
                        <div class="list-item-meta">Type: number | Default: 60 | Used in 20 use cases</div>
                    </div>
                    <div class="list-item-actions">
                        <button class="btn btn-outline" onclick="editQuestion(3)">Edit</button>
                        <button class="btn btn-danger" onclick="deleteQuestion(3)">Delete</button>
                    </div>
                </div><div class="list-item">
                    <div class="list-item-content">
                        <div class="list-item-title">How many third-party workers (e.g., external, contingent, contractors, vendors) are onboarded per month?</div>
                        <div class="list-item-meta">Type: number | Default: 1 | Used in 1 use case</div>
                    </div>
                    <div class="list-item-actions">
                        <button class="btn btn-outline" onclick="editQuestion(4)">Edit</button>
                        <button class="btn btn-danger" onclick="deleteQuestion(4)">Delete</button>
                    </div>
                </div><div class="list-item">
                    <div class="list-item-content">
                        <div class="list-item-title">How many employees are offboarded per month?</div>
                        <div class="list-item-meta">Type: number | Default: 1 | Used in 1 use case</div>
                    </div>
                    <div class="list-item-actions">
                        <button class="btn btn-outline" onclick="editQuestion(5)">Edit</button>
                        <button class="btn btn-danger" onclick="deleteQuestion(5)">Delete</button>
                    </div>
                </div><div class="list-item">
                    <div class="list-item-content">
                        <div class="list-item-title">How many third-party workers (e.g., external, contingent, contractors, vendors) are offboarded per month?</div>
                        <div class="list-item-meta">Type: number | Default: 1 | Used in 1 use case</div>
                    </div>
                    <div class="list-item-actions">
                        <button class="btn btn-outline" onclick="editQuestion(6)">Edit</button>
                        <button class="btn btn-danger" onclick="deleteQuestion(6)">Delete</button>
                    </div>
                </div><div class="list-item">
                    <div class="list-item-content">
                        <div class="list-item-title">How many hours (on average) are spent offboarding these people?</div>
                        <div class="list-item-meta">Type: number | Default: 1 | Used in 2 use cases</div>
                    </div>
                    <div class="list-item-actions">
                        <button class="btn btn-outline" onclick="editQuestion(7)">Edit</button>
                        <button class="btn btn-danger" onclick="deleteQuestion(7)">Delete</button>
                    </div>
                </div><div class="list-item">
                    <div class="list-item-content">
                        <div class="list-item-title">How many provisioning workflows failures occur in a month?</div>
                        <div class="list-item-meta">Type: number | Default: 1 | Used in 0 use cases</div>
                    </div>
                    <div class="list-item-actions">
                        <button class="btn btn-outline" onclick="editQuestion(10)">Edit</button>
                        <button class="btn btn-danger" onclick="deleteQuestion(10)">Delete</button>
                    </div>
                </div><div class="list-item">
                    <div class="list-item-content">
                        <div class="list-item-title">How many total workers (employees + third party individuals) are onboarded per month? </div>
                        <div class="list-item-meta">Type: number | Default: 1 | Used in 1 use case</div>
                    </div>
                    <div class="list-item-actions">
                        <button class="btn btn-outline" onclick="editQuestion(11)">Edit</button>
                        <button class="btn btn-danger" onclick="deleteQuestion(11)">Delete</button>
                    </div>
                </div><div class="list-item">
                    <div class="list-item-content">
                        <div class="list-item-title">How many total workers (employees + third party individuals) are offboarded per month?</div>
                        <div class="list-item-meta">Type: number | Default: 1 | Used in 1 use case</div>
                    </div>
                    <div class="list-item-actions">
                        <button class="btn btn-outline" onclick="editQuestion(12)">Edit</button>
                        <button class="btn btn-danger" onclick="deleteQuestion(12)">Delete</button>
                    </div>
                </div><div class="list-item">
                    <div class="list-item-content">
                        <div class="list-item-title">How many non-security/non-IT workers are involved to onboard a new hire?</div>
                        <div class="list-item-meta">Type: number | Default: 1 | Used in 1 use case</div>
                    </div>
                    <div class="list-item-actions">
                        <button class="btn btn-outline" onclick="editQuestion(13)">Edit</button>
                        <button class="btn btn-danger" onclick="deleteQuestion(13)">Delete</button>
                    </div>
                </div><div class="list-item">
                    <div class="list-item-content">
                        <div class="list-item-title">How many non-security/non-IT workers are involved in offboarding a worker?</div>
                        <div class="list-item-meta">Type: number | Default: 1 | Used in 1 use case</div>
                    </div>
                    <div class="list-item-actions">
                        <button class="btn btn-outline" onclick="editQuestion(14)">Edit</button>
                        <button class="btn btn-danger" onclick="deleteQuestion(14)">Delete</button>
                    </div>
                </div><div class="list-item">
                    <div class="list-item-content">
                        <div class="list-item-title">How many hours do these non-security/non-IT workers spend on this work?</div>
                        <div class="list-item-meta">Type: number | Default: 1 | Used in 2 use cases</div>
                    </div>
                    <div class="list-item-actions">
                        <button class="btn btn-outline" onclick="editQuestion(15)">Edit</button>
                        <button class="btn btn-danger" onclick="deleteQuestion(15)">Delete</button>
                    </div>
                </div><div class="list-item">
                    <div class="list-item-content">
                        <div class="list-item-title">What is the average amount of time a new user cannot perform their job responsibilities because of insufficient user account access? </div>
                        <div class="list-item-meta">Type: number | Default: 1 | Used in 1 use case</div>
                    </div>
                    <div class="list-item-actions">
                        <button class="btn btn-outline" onclick="editQuestion(16)">Edit</button>
                        <button class="btn btn-danger" onclick="deleteQuestion(16)">Delete</button>
                    </div>
                </div><div class="list-item">
                    <div class="list-item-content">
                        <div class="list-item-title">How many new users per month are unable to perform their job responsibilities because of insufficient user account access?</div>
                        <div class="list-item-meta">Type: number | Default: 1 | Used in 1 use case</div>
                    </div>
                    <div class="list-item-actions">
                        <button class="btn btn-outline" onclick="editQuestion(17)">Edit</button>
                        <button class="btn btn-danger" onclick="deleteQuestion(17)">Delete</button>
                    </div>
                </div><div class="list-item">
                    <div class="list-item-content">
                        <div class="list-item-title">What is the average hourly labor rate for each worker? </div>
                        <div class="list-item-meta">Type: number | Default: 60 | Used in 1 use case</div>
                    </div>
                    <div class="list-item-actions">
                        <button class="btn btn-outline" onclick="editQuestion(18)">Edit</button>
                        <button class="btn btn-danger" onclick="deleteQuestion(18)">Delete</button>
                    </div>
                </div><div class="list-item">
                    <div class="list-item-content">
                        <div class="list-item-title">What is the average number of job transfers that occur in a given month?</div>
                        <div class="list-item-meta">Type: number | Default: 1 | Used in 1 use case</div>
                    </div>
                    <div class="list-item-actions">
                        <button class="btn btn-outline" onclick="editQuestion(19)">Edit</button>
                        <button class="btn btn-danger" onclick="deleteQuestion(19)">Delete</button>
                    </div>
                </div><div class="list-item">
                    <div class="list-item-content">
                        <div class="list-item-title">How many hours (on average) are spent processing a job transfer? (e.g., updating records, removing access, adding access, obtaining approvals, tracking and managing sunset dates)</div>
                        <div class="list-item-meta">Type: number | Default: 1 | Used in 1 use case</div>
                    </div>
                    <div class="list-item-actions">
                        <button class="btn btn-outline" onclick="editQuestion(20)">Edit</button>
                        <button class="btn btn-danger" onclick="deleteQuestion(20)">Delete</button>
                    </div>
                </div><div class="list-item">
                    <div class="list-item-content">
                        <div class="list-item-title">How many hours (on average) are spent processing these requests?</div>
                        <div class="list-item-meta">Type: number | Default: 1 | Used in 7 use cases</div>
                    </div>
                    <div class="list-item-actions">
                        <button class="btn btn-outline" onclick="editQuestion(21)">Edit</button>
                        <button class="btn btn-danger" onclick="deleteQuestion(21)">Delete</button>
                    </div>
                </div><div class="list-item">
                    <div class="list-item-content">
                        <div class="list-item-title">What is the average number of worker conversions (e.g., FTE to contractor, contractor to FTE) that occur in a given month?</div>
                        <div class="list-item-meta">Type: number | Default: 1 | Used in 1 use case</div>
                    </div>
                    <div class="list-item-actions">
                        <button class="btn btn-outline" onclick="editQuestion(22)">Edit</button>
                        <button class="btn btn-danger" onclick="deleteQuestion(22)">Delete</button>
                    </div>
                </div><div class="list-item">
                    <div class="list-item-content">
                        <div class="list-item-title">What is the average number of rehires that occur in a given month?</div>
                        <div class="list-item-meta">Type: number | Default: 1 | Used in 1 use case</div>
                    </div>
                    <div class="list-item-actions">
                        <button class="btn btn-outline" onclick="editQuestion(23)">Edit</button>
                        <button class="btn btn-danger" onclick="deleteQuestion(23)">Delete</button>
                    </div>
                </div><div class="list-item">
                    <div class="list-item-content">
                        <div class="list-item-title">What is the average number of rescinded offers that occur in a given month?</div>
                        <div class="list-item-meta">Type: number | Default: 1 | Used in 1 use case</div>
                    </div>
                    <div class="list-item-actions">
                        <button class="btn btn-outline" onclick="editQuestion(24)">Edit</button>
                        <button class="btn btn-danger" onclick="deleteQuestion(24)">Delete</button>
                    </div>
                </div><div class="list-item">
                    <div class="list-item-content">
                        <div class="list-item-title">Hour many privileged accounts (on average) are onboarded into your PAM tool in a given month?</div>
                        <div class="list-item-meta">Type: number | Default: 1 | Used in 1 use case</div>
                    </div>
                    <div class="list-item-actions">
                        <button class="btn btn-outline" onclick="editQuestion(25)">Edit</button>
                        <button class="btn btn-danger" onclick="deleteQuestion(25)">Delete</button>
                    </div>
                </div><div class="list-item">
                    <div class="list-item-content">
                        <div class="list-item-title">What is the average number of new privileged account requests completed in a given month?</div>
                        <div class="list-item-meta">Type: number | Default: 1 | Used in 1 use case</div>
                    </div>
                    <div class="list-item-actions">
                        <button class="btn btn-outline" onclick="editQuestion(26)">Edit</button>
                        <button class="btn btn-danger" onclick="deleteQuestion(26)">Delete</button>
                    </div>
                </div><div class="list-item">
                    <div class="list-item-content">
                        <div class="list-item-title">How many requests for privileged account support are received in a given month? (e.g., syncing errors, credential rotation failures, user training)</div>
                        <div class="list-item-meta">Type: number | Default: 1 | Used in 1 use case</div>
                    </div>
                    <div class="list-item-actions">
                        <button class="btn btn-outline" onclick="editQuestion(27)">Edit</button>
                        <button class="btn btn-danger" onclick="deleteQuestion(27)">Delete</button>
                    </div>
                </div><div class="list-item">
                    <div class="list-item-content">
                        <div class="list-item-title">What is the average number of audit/compliance requests for privileged access controls in a given month? </div>
                        <div class="list-item-meta">Type: number | Default: 1 | Used in 1 use case</div>
                    </div>
                    <div class="list-item-actions">
                        <button class="btn btn-outline" onclick="editQuestion(28)">Edit</button>
                        <button class="btn btn-danger" onclick="deleteQuestion(28)">Delete</button>
                    </div>
                </div><div class="list-item">
                    <div class="list-item-content">
                        <div class="list-item-title">How many password resets are performed in a given month?</div>
                        <div class="list-item-meta">Type: number | Default: 1 | Used in 1 use case</div>
                    </div>
                    <div class="list-item-actions">
                        <button class="btn btn-outline" onclick="editQuestion(29)">Edit</button>
                        <button class="btn btn-danger" onclick="deleteQuestion(29)">Delete</button>
                    </div>
                </div><div class="list-item">
                    <div class="list-item-content">
                        <div class="list-item-title">How many minutes (on average) are spent processing these requests?</div>
                        <div class="list-item-meta">Type: number | Default: 1 | Used in 2 use cases</div>
                    </div>
                    <div class="list-item-actions">
                        <button class="btn btn-outline" onclick="editQuestion(30)">Edit</button>
                        <button class="btn btn-danger" onclick="deleteQuestion(30)">Delete</button>
                    </div>
                </div><div class="list-item">
                    <div class="list-item-content">
                        <div class="list-item-title">What is the average number of applications onboarded into the enterprise SSO solution per month?</div>
                        <div class="list-item-meta">Type: number | Default: 1 | Used in 1 use case</div>
                    </div>
                    <div class="list-item-actions">
                        <button class="btn btn-outline" onclick="editQuestion(31)">Edit</button>
                        <button class="btn btn-danger" onclick="deleteQuestion(31)">Delete</button>
                    </div>
                </div><div class="list-item">
                    <div class="list-item-content">
                        <div class="list-item-title">How many hours (on average) are spent on this work?</div>
                        <div class="list-item-meta">Type: number | Default: 1 | Used in 2 use cases</div>
                    </div>
                    <div class="list-item-actions">
                        <button class="btn btn-outline" onclick="editQuestion(32)">Edit</button>
                        <button class="btn btn-danger" onclick="deleteQuestion(32)">Delete</button>
                    </div>
                </div><div class="list-item">
                    <div class="list-item-content">
                        <div class="list-item-title">What is the average number of SSO failure tickets investigated in a given month?</div>
                        <div class="list-item-meta">Type: number | Default: 1 | Used in 2 use cases</div>
                    </div>
                    <div class="list-item-actions">
                        <button class="btn btn-outline" onclick="editQuestion(33)">Edit</button>
                        <button class="btn btn-danger" onclick="deleteQuestion(33)">Delete</button>
                    </div>
                </div><div class="list-item">
                    <div class="list-item-content">
                        <div class="list-item-title">What is the average time to completion (in minutes) for each of these requests?</div>
                        <div class="list-item-meta">Type: number | Default: 1 | Used in 2 use cases</div>
                    </div>
                    <div class="list-item-actions">
                        <button class="btn btn-outline" onclick="editQuestion(34)">Edit</button>
                        <button class="btn btn-danger" onclick="deleteQuestion(34)">Delete</button>
                    </div>
                </div><div class="list-item">
                    <div class="list-item-content">
                        <div class="list-item-title">What is the average hourly labor rate for a user impacted by this delay?</div>
                        <div class="list-item-meta">Type: number | Default: 60 | Used in 1 use case</div>
                    </div>
                    <div class="list-item-actions">
                        <button class="btn btn-outline" onclick="editQuestion(35)">Edit</button>
                        <button class="btn btn-danger" onclick="deleteQuestion(35)">Delete</button>
                    </div>
                </div><div class="list-item">
                    <div class="list-item-content">
                        <div class="list-item-title">What is the average number of MFA support tickets submitted each month?</div>
                        <div class="list-item-meta">Type: number | Default: 1 | Used in 1 use case</div>
                    </div>
                    <div class="list-item-actions">
                        <button class="btn btn-outline" onclick="editQuestion(36)">Edit</button>
                        <button class="btn btn-danger" onclick="deleteQuestion(36)">Delete</button>
                    </div>
                </div><div class="list-item">
                    <div class="list-item-content">
                        <div class="list-item-title">In a given month, how many business line users (e.g., SMEs, application owners) are involved in onboarding applications into the enterprise SSO solution?</div>
                        <div class="list-item-meta">Type: number | Default: 1 | Used in 1 use case</div>
                    </div>
                    <div class="list-item-actions">
                        <button class="btn btn-outline" onclick="editQuestion(37)">Edit</button>
                        <button class="btn btn-danger" onclick="deleteQuestion(37)">Delete</button>
                    </div>
                </div><div class="list-item">
                    <div class="list-item-content">
                        <div class="list-item-title">In a given month, how many change requests (on average) are submitted for the technologies supporting authentication?</div>
                        <div class="list-item-meta">Type: number | Default: 1 | Used in 1 use case</div>
                    </div>
                    <div class="list-item-actions">
                        <button class="btn btn-outline" onclick="editQuestion(38)">Edit</button>
                        <button class="btn btn-danger" onclick="deleteQuestion(38)">Delete</button>
                    </div>
                </div><div class="list-item">
                    <div class="list-item-content">
                        <div class="list-item-title">On average, how much time (in hours) is spent creating and managing each change request?</div>
                        <div class="list-item-meta">Type: number | Default: 1 | Used in 1 use case</div>
                    </div>
                    <div class="list-item-actions">
                        <button class="btn btn-outline" onclick="editQuestion(39)">Edit</button>
                        <button class="btn btn-danger" onclick="deleteQuestion(39)">Delete</button>
                    </div>
                </div></div>
            </div>

            <div class="card">
                <h2 class="section-title">Save Your Configuration</h2>
                <p style="margin-bottom: 20px; color: var(--idm-gray);">
                    Export an updated HTML file with all your configuration changes baked in. Replace your current file with the downloaded version.
                </p>
                <div class="btn-group">
                    <button class="btn btn-primary" onclick="exportUpdatedHTML()" style="background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));">
                        üíæ Export Updated HTML File
                    </button>
                </div>
            </div>

            <div class="card">
                <h2 class="section-title">üìä Export Excel Workbook</h2>
                <p style="margin-bottom: 20px; color: var(--idm-gray);">
                    Generate a professional Excel workbook with your configuration. Perfect for sharing with stakeholders or conducting assessments offline.
                </p>
                <div class="btn-group">
                    <button class="btn btn-primary" onclick="exportExcelWorkbook()" style="background: linear-gradient(135deg, var(--idm-blue), var(--idm-purple));">
                        üì• Export Excel Workbook
                    </button>
                </div>
            </div>

            <div class="card">
                <h2 class="section-title">Import / Export Configuration (JSON)</h2>
                <p style="margin-bottom: 20px; color: var(--idm-gray); font-size: 0.9rem;">
                    For sharing just the configuration data with others or backing up.
                </p>
                <div class="btn-group">
                    <button class="btn btn-outline" onclick="exportConfiguration()">Export Configuration (JSON)</button>
                    <button class="btn btn-outline" onclick="document.getElementById('import-file').click()">Import Configuration</button>
                    <input type="file" id="import-file" accept=".json" style="display: none;" onchange="importConfiguration(event)">
                </div>
            </div>
        </div>
    </div>

    <!-- Modal -->
    <div class="modal-overlay" id="modal-overlay" onclick="closeModal(event)">
        <div class="modal-content" onclick="event.stopPropagation()">
            <div id="modal-body"></div>
        </div>
    </div>

    <script>
        // Configuration Data
        // EMBEDDED CONFIGURATION DATA
        // All domains, use cases, questions, and mappings are stored here
        // To update: use the Configure panel, then export a new HTML file
        let config = {
          "domains": [
                    {
                              "id": 1,
                              "name": "IGA",
                              "icon": "üîê",
                              "description": "Identity Governance & Administration"
                    },
                    {
                              "id": 2,
                              "name": "CIAM",
                              "icon": "üë§",
                              "description": "Customer Identity & Access Management"
                    },
                    {
                              "id": 3,
                              "name": "PAM",
                              "icon": "üîë",
                              "description": "Privileged Access Management"
                    },
                    {
                              "id": 4,
                              "name": "Access Management",
                              "icon": "üö™",
                              "description": "General Access Control"
                    }
          ],
          "useCases": [
                    {
                              "id": 1,
                              "domainId": 1,
                              "name": "Onboarding an employee",
                              "category": "Joiner/Mover/Leaver",
                              "formula": "newHires * hours * staffRate"
                    },
                    {
                              "id": 2,
                              "domainId": 1,
                              "name": "Offboarding an employee",
                              "category": "Joiner/Mover/Leaver",
                              "formula": "totalTerms * hours * staffRate"
                    },
                    {
                              "id": 3,
                              "domainId": 1,
                              "name": "Onboarding third-party workers (e.g., external, contingent, contractors, vendors",
                              "category": "Joiner/Mover/Leaver",
                              "formula": "newHires * hours * staffRate"
                    },
                    {
                              "id": 4,
                              "domainId": 1,
                              "name": "Offboarding third-party workers (e.g., external, contingent, contractors, vendors",
                              "category": "Joiner/Mover/Leaver",
                              "formula": "totalTerms * hours * staffRate"
                    },
                    {
                              "id": 5,
                              "domainId": 1,
                              "name": "Full onboarding",
                              "category": "Joiner/Mover/Leaver",
                              "formula": "newHires * staffCount * hours * staffRate"
                    },
                    {
                              "id": 6,
                              "domainId": 1,
                              "name": "Full offboarding",
                              "category": "Joiner/Mover/Leaver",
                              "formula": "totalTerms * staffCount * hours * staffRate"
                    },
                    {
                              "id": 7,
                              "domainId": 1,
                              "name": "Users waiting for access to do their job",
                              "category": "Access Requests",
                              "formula": "hoursWaiting * totalUsers * staffRate"
                    },
                    {
                              "id": 8,
                              "domainId": 1,
                              "name": "Managing a job transfer",
                              "category": "Joiner/Mover/Leaver",
                              "formula": "numUsers * hours * staffRate"
                    },
                    {
                              "id": 9,
                              "domainId": 1,
                              "name": "Converting employees to contractors or contractors to employees",
                              "category": "Joiner/Mover/Leaver",
                              "formula": "numUsers * hours * staffRate"
                    },
                    {
                              "id": 10,
                              "domainId": 1,
                              "name": "Rehires",
                              "category": "Joiner/Mover/Leaver",
                              "formula": "numUsers * hours * staffRate"
                    },
                    {
                              "id": 11,
                              "domainId": 1,
                              "name": "Rescinded offers",
                              "category": "Joiner/Mover/Leaver",
                              "formula": "numUsers * hours * staffRate"
                    },
                    {
                              "id": 12,
                              "domainId": 3,
                              "name": "Onboarding privileged accounts into PAM tool",
                              "category": "PAM Onboarding",
                              "formula": "numAccounts * hours * staffRate"
                    },
                    {
                              "id": 13,
                              "domainId": 3,
                              "name": "Requests for new privileged accounts",
                              "category": "PAM Access Requests",
                              "formula": "numRequests * hours * staffRate"
                    },
                    {
                              "id": 14,
                              "domainId": 3,
                              "name": "Support for privileged accounts (e.g., syncing errors, credential rotation failures, user training)",
                              "category": "PAM - Operational",
                              "formula": "numRequests * hours * staffRate"
                    },
                    {
                              "id": 15,
                              "domainId": 3,
                              "name": "Privileged access audit requests",
                              "category": "PAM - Operational",
                              "formula": "numRequests * hours * staffRate"
                    },
                    {
                              "id": 16,
                              "domainId": 4,
                              "name": "Password resets",
                              "category": "Credential Management",
                              "formula": "numResets * (minutes/60) * staffRate"
                    },
                    {
                              "id": 17,
                              "domainId": 4,
                              "name": "SSO application onboarding",
                              "category": "Implementation",
                              "formula": "numApps * hours * staffRate"
                    },
                    {
                              "id": 18,
                              "domainId": 4,
                              "name": "User support for SSO failure",
                              "category": "Operational",
                              "formula": "numFailures * (minutes/60) * staffRate"
                    },
                    {
                              "id": 19,
                              "domainId": 4,
                              "name": "Users unable to login",
                              "category": "Operational",
                              "formula": "numLockouts * (minutes/60) * staffRate"
                    },
                    {
                              "id": 20,
                              "domainId": 4,
                              "name": "MFA support",
                              "category": "Operational",
                              "formula": "numTickets * (minutes/60) * staffRate"
                    },
                    {
                              "id": 21,
                              "domainId": 4,
                              "name": "Extended (non-security/non-IT) app onboarding costs",
                              "category": "Implementation",
                              "formula": "numUsers * hours * staffRate"
                    },
                    {
                              "id": 22,
                              "domainId": 4,
                              "name": "Access management change management",
                              "category": "Change Management",
                              "formula": "changeRequests * hours * staffRate"
                    }
          ],
          "questions": [
                    {
                              "id": 1,
                              "text": "How many internal new hires are onboarded per month?",
                              "inputType": "number",
                              "defaultValue": 1
                    },
                    {
                              "id": 2,
                              "text": "How many hours (on average) are spent manually provisioning these people?",
                              "inputType": "number",
                              "defaultValue": 1
                    },
                    {
                              "id": 3,
                              "text": "What is the average hourly labor rate for the team members that perform this work?",
                              "inputType": "number",
                              "defaultValue": 60
                    },
                    {
                              "id": 4,
                              "text": "How many third-party workers (e.g., external, contingent, contractors, vendors) are onboarded per month?",
                              "inputType": "number",
                              "defaultValue": 1
                    },
                    {
                              "id": 5,
                              "text": "How many employees are offboarded per month?",
                              "inputType": "number",
                              "defaultValue": 1
                    },
                    {
                              "id": 6,
                              "text": "How many third-party workers (e.g., external, contingent, contractors, vendors) are offboarded per month?",
                              "inputType": "number",
                              "defaultValue": 1
                    },
                    {
                              "id": 7,
                              "text": "How many hours (on average) are spent offboarding these people?",
                              "inputType": "number",
                              "defaultValue": 1
                    },
                    {
                              "id": 10,
                              "text": "How many provisioning workflows failures occur in a month?",
                              "inputType": "number",
                              "defaultValue": 1
                    },
                    {
                              "id": 11,
                              "text": "How many total workers (employees + third party individuals) are onboarded per month? ",
                              "inputType": "number",
                              "defaultValue": 1
                    },
                    {
                              "id": 12,
                              "text": "How many total workers (employees + third party individuals) are offboarded per month?",
                              "inputType": "number",
                              "defaultValue": 1
                    },
                    {
                              "id": 13,
                              "text": "How many non-security/non-IT workers are involved to onboard a new hire?",
                              "inputType": "number",
                              "defaultValue": 1
                    },
                    {
                              "id": 14,
                              "text": "How many non-security/non-IT workers are involved in offboarding a worker?",
                              "inputType": "number",
                              "defaultValue": 1
                    },
                    {
                              "id": 15,
                              "text": "How many hours do these non-security/non-IT workers spend on this work?",
                              "inputType": "number",
                              "defaultValue": 1
                    },
                    {
                              "id": 16,
                              "text": "What is the average amount of time a new user cannot perform their job responsibilities because of insufficient user account access? ",
                              "inputType": "number",
                              "defaultValue": 1
                    },
                    {
                              "id": 17,
                              "text": "How many new users per month are unable to perform their job responsibilities because of insufficient user account access?",
                              "inputType": "number",
                              "defaultValue": 1
                    },
                    {
                              "id": 18,
                              "text": "What is the average hourly labor rate for each worker? ",
                              "inputType": "number",
                              "defaultValue": 60
                    },
                    {
                              "id": 19,
                              "text": "What is the average number of job transfers that occur in a given month?",
                              "inputType": "number",
                              "defaultValue": 1
                    },
                    {
                              "id": 20,
                              "text": "How many hours (on average) are spent processing a job transfer? (e.g., updating records, removing access, adding access, obtaining approvals, tracking and managing sunset dates)",
                              "inputType": "number",
                              "defaultValue": 1
                    },
                    {
                              "id": 21,
                              "text": "How many hours (on average) are spent processing these requests?",
                              "inputType": "number",
                              "defaultValue": 1
                    },
                    {
                              "id": 22,
                              "text": "What is the average number of worker conversions (e.g., FTE to contractor, contractor to FTE) that occur in a given month?",
                              "inputType": "number",
                              "defaultValue": 1
                    },
                    {
                              "id": 23,
                              "text": "What is the average number of rehires that occur in a given month?",
                              "inputType": "number",
                              "defaultValue": 1
                    },
                    {
                              "id": 24,
                              "text": "What is the average number of rescinded offers that occur in a given month?",
                              "inputType": "number",
                              "defaultValue": 1
                    },
                    {
                              "id": 25,
                              "text": "Hour many privileged accounts (on average) are onboarded into your PAM tool in a given month?",
                              "inputType": "number",
                              "defaultValue": 1
                    },
                    {
                              "id": 26,
                              "text": "What is the average number of new privileged account requests completed in a given month?",
                              "inputType": "number",
                              "defaultValue": 1
                    },
                    {
                              "id": 27,
                              "text": "How many requests for privileged account support are received in a given month? (e.g., syncing errors, credential rotation failures, user training)",
                              "inputType": "number",
                              "defaultValue": 1
                    },
                    {
                              "id": 28,
                              "text": "What is the average number of audit/compliance requests for privileged access controls in a given month? ",
                              "inputType": "number",
                              "defaultValue": 1
                    },
                    {
                              "id": 29,
                              "text": "How many password resets are performed in a given month?",
                              "inputType": "number",
                              "defaultValue": 1
                    },
                    {
                              "id": 30,
                              "text": "How many minutes (on average) are spent processing these requests?",
                              "inputType": "number",
                              "defaultValue": 1
                    },
                    {
                              "id": 31,
                              "text": "What is the average number of applications onboarded into the enterprise SSO solution per month?",
                              "inputType": "number",
                              "defaultValue": 1
                    },
                    {
                              "id": 32,
                              "text": "How many hours (on average) are spent on this work?",
                              "inputType": "number",
                              "defaultValue": 1
                    },
                    {
                              "id": 33,
                              "text": "What is the average number of SSO failure tickets investigated in a given month?",
                              "inputType": "number",
                              "defaultValue": 1
                    },
                    {
                              "id": 34,
                              "text": "What is the average time to completion (in minutes) for each of these requests?",
                              "inputType": "number",
                              "defaultValue": 1
                    },
                    {
                              "id": 35,
                              "text": "What is the average hourly labor rate for a user impacted by this delay?",
                              "inputType": "number",
                              "defaultValue": 60
                    },
                    {
                              "id": 36,
                              "text": "What is the average number of MFA support tickets submitted each month?",
                              "inputType": "number",
                              "defaultValue": 1
                    },
                    {
                              "id": 37,
                              "text": "In a given month, how many business line users (e.g., SMEs, application owners) are involved in onboarding applications into the enterprise SSO solution?",
                              "inputType": "number",
                              "defaultValue": 1
                    },
                    {
                              "id": 38,
                              "text": "In a given month, how many change requests (on average) are submitted for the technologies supporting authentication?",
                              "inputType": "number",
                              "defaultValue": 1
                    },
                    {
                              "id": 39,
                              "text": "On average, how much time (in hours) is spent creating and managing each change request?",
                              "inputType": "number",
                              "defaultValue": 1
                    }
          ],
          "mappings": [
                    {
                              "useCaseId": 1,
                              "questionId": 1,
                              "variableName": "newHires"
                    },
                    {
                              "useCaseId": 1,
                              "questionId": 2,
                              "variableName": "hours"
                    },
                    {
                              "useCaseId": 1,
                              "questionId": 3,
                              "variableName": "staffRate"
                    },
                    {
                              "useCaseId": 2,
                              "questionId": 5,
                              "variableName": "totalTerms"
                    },
                    {
                              "useCaseId": 2,
                              "questionId": 7,
                              "variableName": "hours"
                    },
                    {
                              "useCaseId": 2,
                              "questionId": 3,
                              "variableName": "staffRate"
                    },
                    {
                              "useCaseId": 3,
                              "questionId": 4,
                              "variableName": "newHires"
                    },
                    {
                              "useCaseId": 3,
                              "questionId": 2,
                              "variableName": "hours"
                    },
                    {
                              "useCaseId": 3,
                              "questionId": 3,
                              "variableName": "staffRate"
                    },
                    {
                              "useCaseId": 4,
                              "questionId": 6,
                              "variableName": "totalTerms"
                    },
                    {
                              "useCaseId": 4,
                              "questionId": 7,
                              "variableName": "hours"
                    },
                    {
                              "useCaseId": 4,
                              "questionId": 3,
                              "variableName": "staffRate"
                    },
                    {
                              "useCaseId": 5,
                              "questionId": 11,
                              "variableName": "newHires"
                    },
                    {
                              "useCaseId": 5,
                              "questionId": 13,
                              "variableName": "staffCount"
                    },
                    {
                              "useCaseId": 5,
                              "questionId": 15,
                              "variableName": "hours"
                    },
                    {
                              "useCaseId": 5,
                              "questionId": 3,
                              "variableName": "staffRate"
                    },
                    {
                              "useCaseId": 6,
                              "questionId": 12,
                              "variableName": "totalTerms"
                    },
                    {
                              "useCaseId": 6,
                              "questionId": 14,
                              "variableName": "staffCount"
                    },
                    {
                              "useCaseId": 6,
                              "questionId": 15,
                              "variableName": "hours"
                    },
                    {
                              "useCaseId": 6,
                              "questionId": 3,
                              "variableName": "staffRate"
                    },
                    {
                              "useCaseId": 7,
                              "questionId": 16,
                              "variableName": "hoursWaiting"
                    },
                    {
                              "useCaseId": 7,
                              "questionId": 17,
                              "variableName": "totalUsers"
                    },
                    {
                              "useCaseId": 7,
                              "questionId": 18,
                              "variableName": "staffRate"
                    },
                    {
                              "useCaseId": 8,
                              "questionId": 19,
                              "variableName": "numUsers"
                    },
                    {
                              "useCaseId": 8,
                              "questionId": 20,
                              "variableName": "hours"
                    },
                    {
                              "useCaseId": 8,
                              "questionId": 3,
                              "variableName": "staffRate"
                    },
                    {
                              "useCaseId": 9,
                              "questionId": 22,
                              "variableName": "numUsers"
                    },
                    {
                              "useCaseId": 9,
                              "questionId": 21,
                              "variableName": "hours"
                    },
                    {
                              "useCaseId": 9,
                              "questionId": 3,
                              "variableName": "staffRate"
                    },
                    {
                              "useCaseId": 10,
                              "questionId": 23,
                              "variableName": "numUsers"
                    },
                    {
                              "useCaseId": 10,
                              "questionId": 21,
                              "variableName": "hours"
                    },
                    {
                              "useCaseId": 10,
                              "questionId": 3,
                              "variableName": "staffRate"
                    },
                    {
                              "useCaseId": 11,
                              "questionId": 24,
                              "variableName": "numUsers"
                    },
                    {
                              "useCaseId": 11,
                              "questionId": 21,
                              "variableName": "hours"
                    },
                    {
                              "useCaseId": 11,
                              "questionId": 3,
                              "variableName": "staffRate"
                    },
                    {
                              "useCaseId": 12,
                              "questionId": 25,
                              "variableName": "numAccounts"
                    },
                    {
                              "useCaseId": 12,
                              "questionId": 21,
                              "variableName": "hours"
                    },
                    {
                              "useCaseId": 12,
                              "questionId": 3,
                              "variableName": "staffRate"
                    },
                    {
                              "useCaseId": 13,
                              "questionId": 26,
                              "variableName": "numRequests"
                    },
                    {
                              "useCaseId": 13,
                              "questionId": 21,
                              "variableName": "hours"
                    },
                    {
                              "useCaseId": 13,
                              "questionId": 3,
                              "variableName": "staffRate"
                    },
                    {
                              "useCaseId": 14,
                              "questionId": 27,
                              "variableName": "numRequests"
                    },
                    {
                              "useCaseId": 14,
                              "questionId": 21,
                              "variableName": "hours"
                    },
                    {
                              "useCaseId": 14,
                              "questionId": 3,
                              "variableName": "staffRate"
                    },
                    {
                              "useCaseId": 15,
                              "questionId": 28,
                              "variableName": "numRequests"
                    },
                    {
                              "useCaseId": 15,
                              "questionId": 21,
                              "variableName": "hours"
                    },
                    {
                              "useCaseId": 15,
                              "questionId": 3,
                              "variableName": "staffRate"
                    },
                    {
                              "useCaseId": 16,
                              "questionId": 29,
                              "variableName": "numResets"
                    },
                    {
                              "useCaseId": 16,
                              "questionId": 30,
                              "variableName": "minutes"
                    },
                    {
                              "useCaseId": 16,
                              "questionId": 3,
                              "variableName": "staffRate"
                    },
                    {
                              "useCaseId": 17,
                              "questionId": 31,
                              "variableName": "numApps"
                    },
                    {
                              "useCaseId": 17,
                              "questionId": 32,
                              "variableName": "hours"
                    },
                    {
                              "useCaseId": 17,
                              "questionId": 3,
                              "variableName": "staffRate"
                    },
                    {
                              "useCaseId": 18,
                              "questionId": 33,
                              "variableName": "numFailures"
                    },
                    {
                              "useCaseId": 18,
                              "questionId": 30,
                              "variableName": "minutes"
                    },
                    {
                              "useCaseId": 18,
                              "questionId": 3,
                              "variableName": "staffRate"
                    },
                    {
                              "useCaseId": 19,
                              "questionId": 33,
                              "variableName": "numLockouts"
                    },
                    {
                              "useCaseId": 19,
                              "questionId": 34,
                              "variableName": "minutes"
                    },
                    {
                              "useCaseId": 19,
                              "questionId": 35,
                              "variableName": "staffRate"
                    },
                    {
                              "useCaseId": 20,
                              "questionId": 36,
                              "variableName": "numTickets"
                    },
                    {
                              "useCaseId": 20,
                              "questionId": 34,
                              "variableName": "minutes"
                    },
                    {
                              "useCaseId": 20,
                              "questionId": 3,
                              "variableName": "staffRate"
                    },
                    {
                              "useCaseId": 21,
                              "questionId": 37,
                              "variableName": "numUsers"
                    },
                    {
                              "useCaseId": 21,
                              "questionId": 32,
                              "variableName": "hours"
                    },
                    {
                              "useCaseId": 21,
                              "questionId": 3,
                              "variableName": "staffRate"
                    },
                    {
                              "useCaseId": 22,
                              "questionId": 38,
                              "variableName": "changeRequests"
                    },
                    {
                              "useCaseId": 22,
                              "questionId": 39,
                              "variableName": "hours"
                    },
                    {
                              "useCaseId": 22,
                              "questionId": 3,
                              "variableName": "staffRate"
                    }
          ]
};

        // User Data
        let selectedDomains = new Set();
        let selectedUseCases = new Set();
        let userResponses = {};
        let annualLicenseCost = 0;

        // Initialize
        function init() {
            // Config is now embedded - no need to load from storage
            // Just render the config panel
        }

        // Mode Switching
        function switchMode(mode) {
            document.querySelectorAll('.mode-btn').forEach(btn => btn.classList.remove('active'));
            
            if (mode === 'calculate') {
                document.querySelector('.mode-btn:first-child').classList.add('active');
                document.getElementById('calculatePanel').classList.remove('hidden');
                document.getElementById('configurePanel').classList.add('hidden');
            } else {
                document.querySelector('.mode-btn:last-child').classList.add('active');
                document.getElementById('calculatePanel').classList.add('hidden');
                document.getElementById('configurePanel').classList.remove('hidden');
                renderConfigPanel();
            }
        }

        // Reset calculator to initial state
        function resetCalculatorState() {
            // Reset all screens to initial state
            document.getElementById('calculator-container').classList.add('hidden');
            document.getElementById('welcome-screen').classList.remove('hidden');
            document.getElementById('step-1').classList.add('hidden');
            document.getElementById('step-2').classList.add('hidden');
            document.getElementById('step-3').classList.add('hidden');
            document.getElementById('processing-screen').style.display = 'none';
            document.getElementById('results-screen').classList.add('hidden');
            
            // Reset progress bar
            updateProgressBar(0);
            
            // Clear user data
            selectedDomains.clear();
            selectedUseCases.clear();
            userResponses = {};
            annualLicenseCost = 0;
        }

        // Calculate Flow
        // Calculate Flow - Step 1: Select Domains
        function startCalculator() {
            document.getElementById('welcome-screen').classList.add('hidden');
            document.getElementById('calculator-container').classList.remove('hidden');
            document.getElementById('step-1').classList.remove('hidden');
            renderDomains();
            
            updateProgressBar(25);
        }

        function backToWelcome() {
            document.getElementById('calculator-container').classList.add('hidden');
            document.getElementById('welcome-screen').classList.remove('hidden');
            selectedDomains.clear();
            selectedUseCases.clear();
            updateProgressBar(0);
        }

        function renderDomains() {
            const grid = document.getElementById('domains-grid');
            grid.innerHTML = '';

            config.domains.forEach(domain => {
                const card = document.createElement('div');
                card.className = `domain-card ${selectedDomains.has(domain.id) ? 'selected' : ''}`;
                card.onclick = () => toggleDomain(domain.id);
                card.innerHTML = `
                    <div class="domain-icon">${domain.icon}</div>
                    <div class="domain-title">${domain.name}</div>
                    <div class="domain-description">${domain.description}</div>
                `;
                grid.appendChild(card);
            });

            updateSelectedDomainsCount();
        }

        function toggleDomain(id) {
            if (selectedDomains.has(id)) {
                selectedDomains.delete(id);
                // Remove all use cases from this domain
                const domainUseCases = config.useCases.filter(uc => uc.domainId === id);
                domainUseCases.forEach(uc => selectedUseCases.delete(uc.id));
            } else {
                selectedDomains.add(id);
            }
            renderDomains();
        }

        function updateSelectedDomainsCount() {
            const count = selectedDomains.size;
            document.getElementById('selected-domains-count').textContent = `${count} domain${count !== 1 ? 's' : ''} selected`;
            document.getElementById('next-btn-step1').disabled = count === 0;
        }

        // Vertical Selection
        // Step 2: Select Use Cases (grouped by domain)
        function goToStep2() {
            document.getElementById('step-1').classList.add('hidden');
            document.getElementById('step-2').classList.remove('hidden');
            renderUseCasesByDomain();
            updateProgressBar(50);
        }

        function backToStep1() {
            document.getElementById('step-2').classList.add('hidden');
            document.getElementById('step-1').classList.remove('hidden');
            updateProgressBar(25);
        }

        function renderUseCasesByDomain() {
            const container = document.getElementById('use-cases-by-domain');
            container.innerHTML = '';

            selectedDomains.forEach(domainId => {
                const domain = config.domains.find(d => d.id === domainId);
                const domainUseCases = config.useCases.filter(uc => uc.domainId === domainId);

                if (domainUseCases.length === 0) return;

                const section = document.createElement('div');
                section.className = 'domain-section';
                section.innerHTML = `<h3 class="domain-section-title">${domain.icon} ${domain.name}</h3>`;

                const grid = document.createElement('div');
                grid.className = 'use-cases-grid';

                domainUseCases.forEach(useCase => {
                    const card = document.createElement('div');
                    card.className = `use-case-card ${selectedUseCases.has(useCase.id) ? 'selected' : ''}`;
                    card.onclick = () => toggleUseCase(useCase.id);
                    
                    card.innerHTML = `
                        <div class="use-case-title">${useCase.name}</div>
                        <div class="use-case-category">${useCase.category}</div>
                    `;
                    grid.appendChild(card);
                });

                section.appendChild(grid);
                container.appendChild(section);
            });

            updateSelectedUseCasesCount();
        }

        function toggleUseCase(id) {
            if (selectedUseCases.has(id)) {
                selectedUseCases.delete(id);
            } else {
                selectedUseCases.add(id);
            }
            renderUseCasesByDomain();
        }

        function updateSelectedUseCasesCount() {
            const count = selectedUseCases.size;
            document.getElementById('selected-usecases-count').textContent = `${count} use case${count !== 1 ? 's' : ''} selected`;
            document.getElementById('next-btn-step2').disabled = count === 0;
        }

        // Step 3: Answer Questions (grouped by domain)
        function goToStep3() {
            document.getElementById('step-2').classList.add('hidden');
            document.getElementById('step-3').classList.remove('hidden');
            renderQuestions();
            updateProgressBar(75);
        }

        function backToStep2() {
            document.getElementById('step-3').classList.add('hidden');
            document.getElementById('step-2').classList.remove('hidden');
            updateProgressBar(50);
        }

        function renderQuestions() {
            const container = document.getElementById('questions-container');
            container.innerHTML = '';

            // Group by domain for better organization
            selectedDomains.forEach(domainId => {
                const domain = config.domains.find(d => d.id === domainId);
                const domainUseCases = Array.from(selectedUseCases).filter(ucId => {
                    const uc = config.useCases.find(u => u.id === ucId);
                    return uc && uc.domainId === domainId;
                });

                if (domainUseCases.length === 0) return;

                // Create a card wrapper for the domain
                const domainCard = document.createElement('div');
                domainCard.className = 'card';
                domainCard.style.marginBottom = '20px';

                const domainSection = document.createElement('div');
                domainSection.className = 'question-section';
                domainSection.innerHTML = `<h3 class="section-title">${domain.icon} ${domain.name}</h3>`;

                domainUseCases.forEach(useCaseId => {
                    const useCase = config.useCases.find(uc => uc.id === useCaseId);
                    const mappings = config.mappings.filter(m => m.useCaseId === useCaseId);

                    if (mappings.length === 0) return;

                    const useCaseTitle = document.createElement('div');
                    useCaseTitle.className = 'subsection-title';
                    useCaseTitle.textContent = useCase.name;
                    domainSection.appendChild(useCaseTitle);

                    mappings.forEach(mapping => {
                        const question = config.questions.find(q => q.id === mapping.questionId);
                        if (question) {
                            const group = document.createElement('div');
                            group.className = 'input-group';

                            const savedValue = userResponses[`${useCaseId}-${question.id}`];
                            const displayValue = savedValue !== undefined ? savedValue : '';

                            group.innerHTML = `
                                <label class="input-label">${question.text}</label>
                                <input 
                                    type="${question.inputType}" 
                                    class="input-field"
                                    value="${displayValue}"
                                    placeholder="${question.defaultValue}"
                                    ${question.inputType === 'number' ? 'min="0"' : ''}
                                    onchange="saveResponse(${useCaseId}, ${question.id}, this.value)"
                                >
                            `;
                            domainSection.appendChild(group);
                        }
                    });
                });

                domainCard.appendChild(domainSection);
                container.appendChild(domainCard);
            });

            // Add annual license cost in its own card
            const licenseCard = document.createElement('div');
            licenseCard.className = 'card';
            licenseCard.style.marginBottom = '20px';
            
            const licenseSection = document.createElement('div');
            licenseSection.className = 'question-section';
            licenseSection.innerHTML = `
                <h3 class="section-title">üí∞ Annual License Costs</h3>
                <div class="input-group">
                    <label class="input-label">What is your current annual license cost across all selected domains? (Optional)</label>
                    <input 
                        type="number" 
                        class="input-field"
                        value="${annualLicenseCost || ''}"
                        placeholder="$ (Optional)"
                        min="0"
                        onchange="annualLicenseCost = parseFloat(this.value) || 0"
                    >
                    <small>Enter your current annual license fees (leave blank if not applicable)</small>
                </div>
            `;
            licenseCard.appendChild(licenseSection);
            container.appendChild(licenseCard);
        }

        function saveResponse(useCaseId, questionId, value) {
            const numValue = parseFloat(value);
            // Ensure no negative values are saved
            userResponses[`${useCaseId}-${questionId}`] = isNaN(numValue) ? 0 : Math.max(0, numValue);
        }

        function calculateTCO() {
            document.getElementById('step-3').classList.add('hidden');
            document.getElementById('processing-screen').style.display = 'flex';
            updateProgressBar(100);

            setTimeout(() => {
                let totalMonthlyCost = 0;
                const domainBreakdowns = {};

                // Initialize domain breakdowns
                selectedDomains.forEach(domainId => {
                    const domain = config.domains.find(d => d.id === domainId);
                    domainBreakdowns[domainId] = {
                        name: domain.name,
                        icon: domain.icon,
                        total: 0,
                        useCases: []
                    };
                });

                // Calculate costs
                selectedUseCases.forEach(useCaseId => {
                    const useCase = config.useCases.find(uc => uc.id === useCaseId);
                    const mappings = config.mappings.filter(m => m.useCaseId === useCaseId);

                    const variables = {};
                    const inputs = []; // Store question-value pairs for display
                    
                    mappings.forEach(mapping => {
                        const value = userResponses[`${useCaseId}-${mapping.questionId}`] || 0;
                        const question = config.questions.find(q => q.id === mapping.questionId);
                        variables[mapping.variableName] = value;
                        
                        // Store for display
                        inputs.push({
                            question: question.text,
                            value: value,
                            variableName: mapping.variableName
                        });
                    });

                    // Convert minutes to hours if needed
                    if (variables.timePerReset !== undefined) {
                        variables.timePerReset = variables.timePerReset / 60;
                    }

                    try {
                        let formulaWithValues = useCase.formula;
                        const sortedVarNames = Object.keys(variables).sort((a, b) => b.length - a.length);
                        
                        sortedVarNames.forEach(varName => {
                            const regex = new RegExp('\\b' + varName + '\\b', 'g');
                            formulaWithValues = formulaWithValues.replace(regex, variables[varName]);
                        });

                        const cost = eval(formulaWithValues) || 0;
                        totalMonthlyCost += cost;
                        
                        domainBreakdowns[useCase.domainId].total += cost;
                        domainBreakdowns[useCase.domainId].useCases.push({
                            name: useCase.name,
                            cost: cost,
                            formula: useCase.formula,
                            inputs: inputs
                        });
                    } catch (e) {
                        console.error('Error calculating', useCase.name, e);
                    }
                });

                displayResults(totalMonthlyCost, domainBreakdowns);
                
                document.getElementById('processing-screen').style.display = 'none';
                document.getElementById('results-screen').classList.remove('hidden');
            }, 1500);
        }

        function displayResults(monthlyTotal, domainBreakdowns) {
            const annualTotal = (monthlyTotal * 12) + annualLicenseCost;
            const threeYearTotal = annualTotal * 3;
            const fiveYearTotal = annualTotal * 5;

            document.getElementById('monthly-total').textContent = formatCurrency(monthlyTotal);
            document.getElementById('annual-total').textContent = formatCurrency(annualTotal);
            document.getElementById('three-year-total').textContent = formatCurrency(threeYearTotal);
            document.getElementById('five-year-total').textContent = formatCurrency(fiveYearTotal);

            // Display annual license cost as subtext under Annual TCO if it exists
            if (annualLicenseCost > 0) {
                document.getElementById('license-cost-inline').textContent = formatCurrency(annualLicenseCost);
                document.getElementById('license-cost-subtext').style.display = 'block';
            } else {
                document.getElementById('license-cost-subtext').style.display = 'none';
            }

            const container = document.getElementById('breakdown-container');
            container.innerHTML = '';

            Object.values(domainBreakdowns).forEach(domain => {
                if (domain.useCases.length === 0) return;

                const section = document.createElement('div');
                section.className = 'domain-breakdown';
                
                let useCasesHTML = domain.useCases.map(uc => {
                    // Format inputs
                    let inputsHTML = '';
                    if (uc.inputs && uc.inputs.length > 0) {
                        inputsHTML = '<div style="margin-top: 10px; padding: 12px; background: #f9f9f9; border-radius: 8px; font-size: 0.85rem;">';
                        uc.inputs.forEach(input => {
                            inputsHTML += `<div style="margin-bottom: 4px; color: var(--text-color);">‚Ä¢ ${input.question}: <strong>${input.value}</strong></div>`;
                        });
                        inputsHTML += '</div>';
                    }
                    
                    return `
                        <div class="list-item" style="margin-bottom: 10px; flex-direction: column; align-items: flex-start;">
                            <div style="width: 100%; display: flex; justify-content: space-between; align-items: center; margin-bottom: ${uc.inputs && uc.inputs.length > 0 ? '0' : '0'};">
                                <div class="list-item-content">
                                    <div class="list-item-title">${uc.name}</div>
                                </div>
                                <div style="font-size: 1.2rem; font-weight: 600; color: var(--primary-color);">
                                    ${formatCurrency(uc.cost)}/month
                                </div>
                            </div>
                            ${inputsHTML}
                        </div>
                    `;
                }).join('');

                section.innerHTML = `
                    <div class="domain-breakdown-title">${domain.icon} ${domain.name}</div>
                    <div class="domain-breakdown-total">Total: ${formatCurrency(domain.total)}/month</div>
                    ${useCasesHTML}
                `;
                
                container.appendChild(section);
            });
        }

        function formatCurrency(value) {
            return new Intl.NumberFormat('en-US', {
                style: 'currency',
                currency: 'USD',
                minimumFractionDigits: 0,
                maximumFractionDigits: 0
            }).format(value);
        }

        function updateProgressBar(percent) {
            document.getElementById('progress-bar').style.width = percent + '%';
        }

        function editResponses() {
            document.getElementById('results-screen').classList.add('hidden');
            document.getElementById('step-3').classList.remove('hidden');
            updateProgressBar(75);
        }

        function startOver() {
            resetCalculatorState();
        }

        function exportResults() {
            // Get values
            const monthlyTotal = document.getElementById('monthly-total').textContent;
            const annualTotal = document.getElementById('annual-total').textContent;
            const threeYearTotal = document.getElementById('three-year-total').textContent;
            const fiveYearTotal = document.getElementById('five-year-total').textContent;
            const showLicenseCost = annualLicenseCost > 0;
            const licenseCost = showLicenseCost ? formatCurrency(annualLicenseCost) : '';

            // Get logo
            const logoImg = document.getElementById('logo-img');
            const logoSrc = logoImg ? logoImg.src : '';

            // Build breakdown HTML by domain with boxed formatting
            const breakdownContainer = document.getElementById('breakdown-container');
            const domainSections = breakdownContainer.querySelectorAll('.domain-breakdown');
            
            let breakdownHTML = '';
            domainSections.forEach((section, sectionIndex) => {
                const domainTitle = section.querySelector('.domain-breakdown-title');
                const domainTotal = section.querySelector('.domain-breakdown-total');
                
                // Start domain box
                if (domainTitle) {
                    const cleanTitle = domainTitle.textContent.replace(/[\u{1F000}-\u{1F9FF}]/gu, '').trim();
                    
                    breakdownHTML += `
                        <div style="border: 2px solid #241F55; border-radius: 8px; margin-bottom: 30px; overflow: hidden; background: white;">
                            <div style="background: linear-gradient(135deg, #241F55 0%, #A72DBE 100%); color: white; padding: 15px 20px; -webkit-print-color-adjust: exact; print-color-adjust: exact;">
                                <div style="font-weight: 700; font-size: 18px; margin-bottom: 5px;">${cleanTitle}</div>
                                ${domainTotal ? `<div style="font-weight: 600; font-size: 14px; opacity: 0.9;">${domainTotal.textContent}</div>` : ''}
                            </div>
                            <div style="padding: 20px;">
                    `;
                }
                
                const items = section.querySelectorAll('.list-item');
                items.forEach((item, index) => {
                    const nameEl = item.querySelector('.list-item-title');
                    const costDiv = item.querySelector('div[style*="font-size: 1.2rem"]');
                    
                    if (nameEl && costDiv) {
                        const name = nameEl.textContent;
                        const cost = costDiv.textContent;
                        
                        // Add separator between use cases (but not before first one)
                        if (index > 0) {
                            breakdownHTML += `<div style="border-top: 1px solid #e7e5e4; margin: 15px 0;"></div>`;
                        }
                        
                        // Use case header with name and cost
                        breakdownHTML += `
                            <div style="display: flex; justify-content: space-between; align-items: baseline; margin-bottom: 10px;">
                                <div style="font-weight: 600; color: #241F55; font-size: 15px;">${name}</div>
                                <div style="font-weight: 700; color: #A72DBE; font-size: 16px; white-space: nowrap; margin-left: 20px;">${cost}</div>
                            </div>
                        `;
                        
                        // Add input details if they exist
                        const inputsDiv = item.querySelector('div[style*="background: #f9f9f9"]');
                        if (inputsDiv) {
                            const inputs = inputsDiv.querySelectorAll('div[style*="margin-bottom: 4px"]');
                            if (inputs.length > 0) {
                                breakdownHTML += `<div style="margin-left: 15px; margin-top: 8px;">`;
                                inputs.forEach(input => {
                                    // Clean up the input text - remove bullet and "?: " formatting
                                    let cleanInput = input.textContent.replace('‚Ä¢', '').trim();
                                    // Split on ?: to get question and answer
                                    const parts = cleanInput.split('?:');
                                    if (parts.length === 2) {
                                        const question = parts[0].trim();
                                        const answer = parts[1].trim();
                                        breakdownHTML += `<div style="font-size: 13px; color: #666; margin-bottom: 5px; line-height: 1.4;"><span style="color: #444;">${question}:</span> <span style="font-weight: 600; color: #241F55;">${answer}</span></div>`;
                                    } else {
                                        breakdownHTML += `<div style="font-size: 13px; color: #666; margin-bottom: 5px;">${cleanInput}</div>`;
                                    }
                                });
                                breakdownHTML += `</div>`;
                            }
                        }
                    }
                });
                
                // Close domain box
                breakdownHTML += `
                            </div>
                        </div>
                `;
            });

            const reportHTML = `
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>IDMWorks TCO Assessment Report</title>
    <style>
        @media print { 
            body { margin: 0; } 
            .no-print { display: none; }
            @page { margin: 20mm; }
            /* Force color printing for backgrounds */
            * {
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
                color-adjust: exact !important;
            }
        }
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            line-height: 1.6; 
            color: #444; 
            max-width: 800px; 
            margin: 0 auto; 
            padding: 40px 20px; 
        }
        .header { 
            background: linear-gradient(135deg, #241F55 0%, #A72DBE 100%); 
            color: white; 
            padding: 40px; 
            margin: -40px -20px 40px -20px; 
            text-align: center;
            -webkit-print-color-adjust: exact;
            print-color-adjust: exact;
        }
        .header img {
            max-width: 180px;
            margin-bottom: 15px;
        }
        .header h1 { 
            margin: 0 0 10px 0; 
            font-size: 32px; 
            font-weight: 700; 
        }
        .header p { 
            margin: 0; 
            font-size: 14px; 
            opacity: 0.9; 
            text-transform: uppercase; 
            letter-spacing: 2px; 
        }
        .summary { 
            background: #f5f5f4; 
            border-left: 4px solid #00C2EF; 
            padding: 30px; 
            margin: 30px 0;
            -webkit-print-color-adjust: exact;
            print-color-adjust: exact;
        }
        .summary h2 { 
            margin: 0 0 20px 0; 
            color: #A72DBE; 
            font-size: 24px; 
        }
        .summary-item { 
            display: flex; 
            justify-content: space-between; 
            padding: 15px 0; 
            border-bottom: 1px solid #d6d3d1; 
        }
        .summary-item:last-child {
            border-bottom: none;
        }
        .summary-label { 
            font-weight: 500; 
            color: #6C6A6F; 
        }
        .summary-value { 
            font-size: 24px; 
            font-weight: 700; 
            color: #241F55; 
        }
        table { 
            width: 100%; 
            border-collapse: collapse; 
            background: white; 
            box-shadow: 0 2px 8px rgba(0,0,0,0.1); 
        }
        th { 
            background: #241F55; 
            color: white; 
            padding: 15px; 
            text-align: left; 
            font-weight: 600; 
            text-transform: uppercase; 
            font-size: 12px;
            -webkit-print-color-adjust: exact;
            print-color-adjust: exact;
        }
        .footer { 
            margin-top: 60px; 
            padding-top: 20px; 
            border-top: 2px solid #00C2EF; 
            text-align: center; 
            color: #78716c; 
            font-size: 14px; 
        }
        .print-button { 
            background: #241F55; 
            color: white; 
            border: none; 
            padding: 12px 30px; 
            font-size: 16px; 
            border-radius: 6px; 
            cursor: pointer; 
            margin: 20px 0; 
        }
        .print-button:hover { 
            background: #A72DBE; 
        }
    </style>
</head>
<body>
    <div class="header">
        ${logoSrc ? `<img src="${logoSrc}" alt="IDMWorks">` : ''}
        <h1>Total Cost of Ownership Assessment</h1>
        <p>IDMWorks Advisory Report</p>
    </div>
    <button class="print-button no-print" onclick="window.print()">Print / Save as PDF</button>
    <div class="summary">
        <h2>Cost Summary</h2>
        <div class="summary-item">
            <span class="summary-label">Monthly Total Cost of Ownership:</span>
            <span class="summary-value">${monthlyTotal}</span>
        </div>
        ${showLicenseCost ? `
        <div class="summary-item">
            <span class="summary-label">Annual License Costs:</span>
            <span class="summary-value">${licenseCost}</span>
        </div>` : ''}
        <div class="summary-item">
            <span class="summary-label">Annual TCO:</span>
            <span class="summary-value">${annualTotal}</span>
        </div>
        <div class="summary-item">
            <span class="summary-label">3-Year TCO Investment:</span>
            <span class="summary-value">${threeYearTotal}</span>
        </div>
        <div class="summary-item">
            <span class="summary-label">5-Year TCO Investment:</span>
            <span class="summary-value">${fiveYearTotal}</span>
        </div>
    </div>
    <div style="margin: 40px 0;">
        <h2 style="color: #A72DBE; font-size: 24px; margin-bottom: 20px;">Cost Breakdown by Domain</h2>
        ${breakdownHTML}
    </div>
    <div class="footer">
        <p>Generated by IDMWorks TCO Calculator on ${new Date().toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}</p>
    </div>
</body>
</html>
            `;

            const reportWindow = window.open('', '_blank');
            reportWindow.document.write(reportHTML);
            reportWindow.document.close();
        }

        // Configure Panel Functions
        // Config Panel Functions
        function renderConfigPanel() {
            renderDomainManagement();
            renderQuestionLibrary();
        }

        function renderDomainManagement() {
            const container = document.getElementById('domain-management');
            container.innerHTML = '';

            if (config.domains.length === 0) {
                container.innerHTML = '<div class="empty-state"><div class="empty-state-icon">üîê</div><div class="empty-state-text">No domains yet</div><p>Click "+ Add Domain" to get started.</p></div>';
                return;
            }

            config.domains.forEach(domain => {
                const domainUseCases = config.useCases.filter(uc => uc.domainId === domain.id);

                const section = document.createElement('div');
                section.className = 'domain-config-section';

                let useCasesHTML = '';
                
                if (domainUseCases.length === 0) {
                    useCasesHTML = `
                        <div class="add-question-prompt">
                            <p>No use cases in this domain yet.</p>
                            <button class="btn btn-outline" onclick="showAddUseCaseForm(${domain.id})">+ Add Use Case</button>
                        </div>
                    `;
                } else {
                    domainUseCases.forEach(useCase => {
                        const mappings = config.mappings.filter(m => m.useCaseId === useCase.id);
                        
                        let questionsHTML = '';
                        if (mappings.length === 0) {
                            questionsHTML = `
                                <div class="add-question-prompt">
                                    <p>No questions assigned yet.</p>
                                    <button class="btn btn-outline" onclick="showAddQuestionToUseCase(${useCase.id})">+ Add Question</button>
                                </div>
                            `;
                        } else {
                            questionsHTML = '<div class="nested-questions">';
                            mappings.forEach(mapping => {
                                const question = config.questions.find(q => q.id === mapping.questionId);
                                if (question) {
                                    questionsHTML += `
                                        <div class="nested-question-item">
                                            <div class="nested-question-content">
                                                <div class="nested-question-text">${question.text}</div>
                                                <div class="nested-question-meta">Variable: <strong>${mapping.variableName}</strong> | Type: ${question.inputType} | Default: ${question.defaultValue}</div>
                                            </div>
                                            <div class="nested-question-actions">
                                                <button class="btn btn-outline" onclick="editQuestionMapping(${useCase.id}, ${mapping.questionId})">Edit</button>
                                                <button class="btn btn-danger" onclick="deleteMapping(${useCase.id}, ${mapping.questionId})">Remove</button>
                                            </div>
                                        </div>
                                    `;
                                }
                            });
                            questionsHTML += `<button class="btn btn-outline" onclick="showAddQuestionToUseCase(${useCase.id})" style="margin-top: 10px;">+ Add Another Question</button></div>`;
                        }

                        useCasesHTML += `
                            <div class="use-case-section">
                                <div class="use-case-section-header">
                                    <div class="use-case-section-info">
                                        <div class="use-case-section-title">${useCase.name}</div>
                                        <div class="use-case-section-meta">Category: ${useCase.category}</div>
                                        <div class="use-case-formula">Formula: ${useCase.formula}</div>
                                    </div>
                                    <div class="use-case-section-actions">
                                        <button class="btn btn-outline" onclick="editUseCase(${useCase.id})">Edit</button>
                                        <button class="btn btn-danger" onclick="deleteUseCase(${useCase.id})">Delete</button>
                                    </div>
                                </div>
                                ${questionsHTML}
                            </div>
                        `;
                    });
                    useCasesHTML += `<button class="btn btn-outline" onclick="showAddUseCaseForm(${domain.id})" style="margin-top: 10px;">+ Add Another Use Case</button>`;
                }

                section.innerHTML = `
                    <div class="domain-config-header">
                        <div class="domain-config-title">${domain.icon} ${domain.name}</div>
                        <div style="display: flex; gap: 10px;">
                            <button class="btn btn-outline" onclick="editDomain(${domain.id})">Edit Domain</button>
                            <button class="btn btn-danger" onclick="deleteDomain(${domain.id})">Delete Domain</button>
                        </div>
                    </div>
                    ${useCasesHTML}
                `;

                container.appendChild(section);
            });
        }

        function renderQuestionLibrary() {
            const container = document.getElementById('question-library');
            container.innerHTML = '';

            if (config.questions.length === 0) {
                container.innerHTML = '<div class="empty-state"><div class="empty-state-icon">‚ùì</div><div class="empty-state-text">No questions yet</div></div>';
                return;
            }

            config.questions.forEach(question => {
                const usageCount = config.mappings.filter(m => m.questionId === question.id).length;
                const div = document.createElement('div');
                div.className = 'list-item';
                div.innerHTML = `
                    <div class="list-item-content">
                        <div class="list-item-title">${question.text}</div>
                        <div class="list-item-meta">Type: ${question.inputType} | Default: ${question.defaultValue} | Used in ${usageCount} use case${usageCount !== 1 ? 's' : ''}</div>
                    </div>
                    <div class="list-item-actions">
                        <button class="btn btn-outline" onclick="editQuestion(${question.id})">Edit</button>
                        <button class="btn btn-danger" onclick="deleteQuestion(${question.id})">Delete</button>
                    </div>
                `;
                container.appendChild(div);
            });
        }

        // Modal Functions
        // Modal Functions - Domain Management
        function showAddDomainForm() {
            document.getElementById('modal-body').innerHTML = `
                <h2 class="modal-title">Add Domain</h2>
                <form onsubmit="saveDomain(event)">
                    <div class="form-group">
                        <label>Domain Name</label>
                        <input type="text" name="name" placeholder="e.g., IGA, CIAM, PAM" required>
                    </div>
                    <div class="form-group">
                        <label>Icon (Emoji)</label>
                        <input type="text" name="icon" placeholder="e.g., üîê" required maxlength="2">
                    </div>
                    <div class="form-group">
                        <label>Description</label>
                        <input type="text" name="description" placeholder="e.g., Identity Governance & Administration" required>
                    </div>
                    <div class="btn-group">
                        <button type="submit" class="btn btn-primary">Save Domain</button>
                        <button type="button" class="btn btn-outline" onclick="closeModal()">Cancel</button>
                    </div>
                </form>
            `;
            document.getElementById('modal-overlay').style.display = 'flex';
        }

        function saveDomain(event) {
            event.preventDefault();
            const formData = new FormData(event.target);
            const newId = config.domains.length > 0 ? Math.max(...config.domains.map(d => d.id)) + 1 : 1;

            config.domains.push({
                id: newId,
                name: formData.get('name'),
                icon: formData.get('icon'),
                description: formData.get('description')
            });

            // Config is now embedded - changes will be saved when you export HTML
            closeModalDirect();
            renderConfigPanel();
        }

        function editDomain(id) {
            const domain = config.domains.find(d => d.id === id);
            document.getElementById('modal-body').innerHTML = `
                <h2 class="modal-title">Edit Domain</h2>
                <form onsubmit="updateDomain(event, ${id})">
                    <div class="form-group">
                        <label>Domain Name</label>
                        <input type="text" name="name" value="${domain.name}" required>
                    </div>
                    <div class="form-group">
                        <label>Icon (Emoji)</label>
                        <input type="text" name="icon" value="${domain.icon}" required maxlength="2">
                    </div>
                    <div class="form-group">
                        <label>Description</label>
                        <input type="text" name="description" value="${domain.description}" required>
                    </div>
                    <div class="btn-group">
                        <button type="submit" class="btn btn-primary">Update</button>
                        <button type="button" class="btn btn-outline" onclick="closeModal()">Cancel</button>
                    </div>
                </form>
            `;
            document.getElementById('modal-overlay').style.display = 'flex';
        }

        function updateDomain(event, id) {
            event.preventDefault();
            const formData = new FormData(event.target);
            const domain = config.domains.find(d => d.id === id);
            
            domain.name = formData.get('name');
            domain.icon = formData.get('icon');
            domain.description = formData.get('description');

            // Config is now embedded - changes will be saved when you export HTML
            closeModalDirect();
            renderConfigPanel();
        }

        function deleteDomain(id) {
            if (!confirm('Delete this domain and all its use cases?')) return;
            config.domains = config.domains.filter(d => d.id !== id);
            config.useCases = config.useCases.filter(uc => uc.domainId !== id);
            // Also clean up orphaned mappings
            const remainingUseCaseIds = config.useCases.map(uc => uc.id);
            config.mappings = config.mappings.filter(m => remainingUseCaseIds.includes(m.useCaseId));
            // Config is now embedded - changes will be saved when you export HTML
            renderConfigPanel();
        }

        // Use Case Management
        function showAddUseCaseForm(domainId) {
            const domain = config.domains.find(d => d.id === domainId);
            document.getElementById('modal-body').innerHTML = `
                <h2 class="modal-title">Add Use Case to ${domain.name}</h2>
                <form onsubmit="saveUseCase(event)">
                    <input type="hidden" name="domainId" value="${domainId}">
                    <div class="form-group">
                        <label>Use Case Name</label>
                        <input type="text" name="name" required>
                    </div>
                    <div class="form-group">
                        <label>Category</label>
                        <input type="text" name="category" placeholder="e.g., Joiner/Mover/Leaver" required>
                    </div>
                    <div class="form-group">
                        <label>Formula</label>
                        <input type="text" name="formula" placeholder="e.g., numUsers * staffCount * laborRate * hours" required>
                        <small>Use variable names that you'll assign to questions</small>
                    </div>
                    <div class="btn-group">
                        <button type="submit" class="btn btn-primary">Save Use Case</button>
                        <button type="button" class="btn btn-outline" onclick="closeModal()">Cancel</button>
                    </div>
                </form>
            `;
            document.getElementById('modal-overlay').style.display = 'flex';
        }

        function saveUseCase(event) {
            event.preventDefault();
            console.log('saveUseCase called');
            const formData = new FormData(event.target);
            const domainId = parseInt(formData.get('domainId'));
            console.log('Domain ID:', domainId);
            const newId = config.useCases.length > 0 ? Math.max(...config.useCases.map(uc => uc.id)) + 1 : 1;

            const newUseCase = {
                id: newId,
                domainId: domainId,
                name: formData.get('name'),
                category: formData.get('category'),
                formula: formData.get('formula')
            };
            
            console.log('New use case:', newUseCase);
            config.useCases.push(newUseCase);

            // Config is now embedded - changes will be saved when you export HTML
            closeModalDirect();
            renderConfigPanel();
        }

        function editUseCase(id) {
            const useCase = config.useCases.find(uc => uc.id === id);
            document.getElementById('modal-body').innerHTML = `
                <h2 class="modal-title">Edit Use Case</h2>
                <form onsubmit="updateUseCase(event, ${id})">
                    <div class="form-group">
                        <label>Use Case Name</label>
                        <input type="text" name="name" value="${useCase.name}" required>
                    </div>
                    <div class="form-group">
                        <label>Category</label>
                        <input type="text" name="category" value="${useCase.category}" required>
                    </div>
                    <div class="form-group">
                        <label>Formula</label>
                        <input type="text" name="formula" value="${useCase.formula}" required>
                    </div>
                    <div class="btn-group">
                        <button type="submit" class="btn btn-primary">Update</button>
                        <button type="button" class="btn btn-outline" onclick="closeModal()">Cancel</button>
                    </div>
                </form>
            `;
            document.getElementById('modal-overlay').style.display = 'flex';
        }

        function updateUseCase(event, id) {
            event.preventDefault();
            const formData = new FormData(event.target);
            const useCase = config.useCases.find(uc => uc.id === id);
            
            useCase.name = formData.get('name');
            useCase.category = formData.get('category');
            useCase.formula = formData.get('formula');

            // Config is now embedded - changes will be saved when you export HTML
            closeModalDirect();
            renderConfigPanel();
        }

        function deleteUseCase(id) {
            if (!confirm('Delete this use case and all its question mappings?')) return;
            config.useCases = config.useCases.filter(uc => uc.id !== id);
            config.mappings = config.mappings.filter(m => m.useCaseId !== id);
            // Config is now embedded - changes will be saved when you export HTML
            renderConfigPanel();
        }

        function showAddQuestionForm() {
            document.getElementById('modal-body').innerHTML = `
                <h2 class="modal-title">Add Question</h2>
                <form onsubmit="saveQuestion(event)">
                    <div class="form-group">
                        <label>Question Text</label>
                        <textarea name="text" required></textarea>
                    </div>
                    <div class="form-group">
                        <label>Input Type</label>
                        <select name="inputType" required>
                            <option value="number">Number</option>
                            <option value="text">Text</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Default Value</label>
                        <input type="number" name="defaultValue" value="0" required>
                    </div>
                    <div class="btn-group">
                        <button type="submit" class="btn btn-primary">Save Question</button>
                        <button type="button" class="btn btn-outline" onclick="closeModal()">Cancel</button>
                    </div>
                </form>
            `;
            document.getElementById('modal-overlay').style.display = 'flex';
        }

        function saveQuestion(event) {
            event.preventDefault();
            const formData = new FormData(event.target);
            const newId = config.questions.length > 0 ? Math.max(...config.questions.map(q => q.id)) + 1 : 1;

            config.questions.push({
                id: newId,
                text: formData.get('text'),
                inputType: formData.get('inputType'),
                defaultValue: parseFloat(formData.get('defaultValue')) || 0
            });

            // Config is now embedded - changes will be saved when you export HTML
            closeModalDirect();
            renderConfigPanel();
        }

        function editQuestion(id) {
            const question = config.questions.find(q => q.id === id);
            document.getElementById('modal-body').innerHTML = `
                <h2 class="modal-title">Edit Question</h2>
                <form onsubmit="updateQuestion(event, ${id})">
                    <div class="form-group">
                        <label>Question Text</label>
                        <textarea name="text" required>${question.text}</textarea>
                    </div>
                    <div class="form-group">
                        <label>Input Type</label>
                        <select name="inputType" required>
                            <option value="number" ${question.inputType === 'number' ? 'selected' : ''}>Number</option>
                            <option value="text" ${question.inputType === 'text' ? 'selected' : ''}>Text</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Default Value</label>
                        <input type="number" name="defaultValue" value="${question.defaultValue}" required>
                    </div>
                    <div class="btn-group">
                        <button type="submit" class="btn btn-primary">Update</button>
                        <button type="button" class="btn btn-outline" onclick="closeModal()">Cancel</button>
                    </div>
                </form>
            `;
            document.getElementById('modal-overlay').style.display = 'flex';
        }

        function updateQuestion(event, id) {
            event.preventDefault();
            const formData = new FormData(event.target);
            const question = config.questions.find(q => q.id === id);

            question.text = formData.get('text');
            question.inputType = formData.get('inputType');
            question.defaultValue = parseFloat(formData.get('defaultValue')) || 0;

            // Config is now embedded - changes will be saved when you export HTML
            closeModalDirect();
            renderConfigPanel();
        }

        function deleteQuestion(id) {
            if (!confirm('Delete this question? It will be removed from all use cases.')) return;
            config.questions = config.questions.filter(q => q.id !== id);
            config.mappings = config.mappings.filter(m => m.questionId !== id);
            // Config is now embedded - changes will be saved when you export HTML
            renderConfigPanel();
        }

        function showAddQuestionToUseCase(useCaseId) {
            const useCase = config.useCases.find(uc => uc.id === useCaseId);
            const availableQuestions = config.questions.filter(q =>
                !config.mappings.some(m => m.useCaseId === useCaseId && m.questionId === q.id)
            );

            if (availableQuestions.length === 0) {
                alert('All questions are already mapped. Create a new question first.');
                return;
            }

            document.getElementById('modal-body').innerHTML = `
                <h2 class="modal-title">Add Question to "${useCase.name}"</h2>
                <form onsubmit="saveMappingToUseCase(event, ${useCaseId})">
                    <div class="form-group">
                        <label>Select Question</label>
                        <select name="questionId" required>
                            <option value="">Choose a question...</option>
                            ${availableQuestions.map(q => `<option value="${q.id}">${q.text}</option>`).join('')}
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Variable Name</label>
                        <input type="text" name="variableName" placeholder="e.g., numUsers, staffCount" required>
                        <small>Formula: ${useCase.formula}</small>
                    </div>
                    <div class="btn-group">
                        <button type="submit" class="btn btn-primary">Add Question</button>
                        <button type="button" class="btn btn-outline" onclick="closeModal()">Cancel</button>
                    </div>
                </form>
            `;
            document.getElementById('modal-overlay').style.display = 'flex';
        }

        function saveMappingToUseCase(event, useCaseId) {
            event.preventDefault();
            const formData = new FormData(event.target);

            config.mappings.push({
                useCaseId: useCaseId,
                questionId: parseInt(formData.get('questionId')),
                variableName: formData.get('variableName')
            });

            // Config is now embedded - changes will be saved when you export HTML
            closeModalDirect();
            renderConfigPanel();
        }

        function editQuestionMapping(useCaseId, questionId) {
            const mapping = config.mappings.find(m => m.useCaseId === useCaseId && m.questionId === questionId);
            const question = config.questions.find(q => q.id === questionId);
            const useCase = config.useCases.find(uc => uc.id === useCaseId);

            document.getElementById('modal-body').innerHTML = `
                <h2 class="modal-title">Edit Question Mapping</h2>
                <form onsubmit="updateQuestionMapping(event, ${useCaseId}, ${questionId})">
                    <div class="form-group">
                        <label>Question</label>
                        <div style="padding: 12px; background: #f5f5f5; border-radius: 8px;">${question.text}</div>
                    </div>
                    <div class="form-group">
                        <label>Variable Name</label>
                        <input type="text" name="variableName" value="${mapping.variableName}" required>
                        <small>Formula: ${useCase.formula}</small>
                    </div>
                    <div class="btn-group">
                        <button type="submit" class="btn btn-primary">Update</button>
                        <button type="button" class="btn btn-outline" onclick="closeModal()">Cancel</button>
                    </div>
                </form>
            `;
            document.getElementById('modal-overlay').style.display = 'flex';
        }

        function updateQuestionMapping(event, useCaseId, questionId) {
            event.preventDefault();
            const formData = new FormData(event.target);
            const mapping = config.mappings.find(m => m.useCaseId === useCaseId && m.questionId === questionId);
            mapping.variableName = formData.get('variableName');

            // Config is now embedded - changes will be saved when you export HTML
            closeModalDirect();
            renderConfigPanel();
        }

        function deleteMapping(useCaseId, questionId) {
            if (!confirm('Remove this question from the use case?')) return;
            config.mappings = config.mappings.filter(m => !(m.useCaseId === useCaseId && m.questionId === questionId));
            // Config is now embedded - changes will be saved when you export HTML
            renderConfigPanel();
        }

        function exportConfiguration() {
            const dataStr = JSON.stringify(config, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            const timestamp = new Date().toISOString().split('T')[0];
            link.download = `idmworks-tco-config-${timestamp}.json`;
            link.click();
            URL.revokeObjectURL(url);
            
            alert('‚úÖ Configuration exported as JSON!\n\nThis file contains just your configuration data. You can share it with others or use it as a backup.');
        }

        function exportUpdatedHTML() {
            // Save current state
            const currentTab = document.getElementById('configurePanel').classList.contains('hidden') ? 'calculate' : 'configure';
            
            // Reset calculator to clean initial state before export
            resetCalculatorState();
            
            // Switch to Calculate tab for export
            if (currentTab === 'configure') {
                document.getElementById('calculatePanel').classList.remove('hidden');
                document.getElementById('configurePanel').classList.add('hidden');
            }
            
            // Small delay to ensure DOM updates
            setTimeout(() => {
                // Get the current HTML document
                const htmlContent = document.documentElement.outerHTML;
                
                // Find the config object in the HTML and replace it with current config
                const configStart = htmlContent.indexOf('// EMBEDDED CONFIGURATION DATA');
                const configEnd = htmlContent.indexOf('// User Data', configStart);
                
                if (configStart === -1 || configEnd === -1) {
                    alert('Error: Could not find config section in HTML');
                    // Restore previous state
                    if (currentTab === 'configure') switchMode('configure');
                    return;
                }
                
                // Build the new config section
                const newConfigSection = `// EMBEDDED CONFIGURATION DATA
        // All domains, use cases, questions, and mappings are stored here
        // To update: use the Configure panel, then export a new HTML file
        let config = ${JSON.stringify(config, null, 12)};

        `;
                
                // Replace the old config section with the new one
                const updatedHTML = htmlContent.substring(0, configStart) + 
                                  newConfigSection + 
                                  htmlContent.substring(configEnd);
                
                // Create a blob and download
                const blob = new Blob([updatedHTML], { type: 'text/html' });
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                const timestamp = new Date().toISOString().split('T')[0];
                link.download = `idmworks-tco-calculator-v5-updated-${timestamp}.html`;
                link.click();
                URL.revokeObjectURL(url);
                
                alert('‚úÖ Updated HTML file exported!\n\nYour configuration changes are now saved in the downloaded file.\n\nüìù Next step: Replace your current HTML file with the downloaded version.');
                
                // Restore previous state
                if (currentTab === 'configure') {
                    switchMode('configure');
                }
            }, 100);
        }

        function importConfiguration(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const importedConfig = JSON.parse(e.target.result);
                    
                    // Validate the imported config has required properties
                    if (!importedConfig.domains || !importedConfig.useCases || 
                        !importedConfig.questions || !importedConfig.mappings) {
                        throw new Error('Invalid configuration file - missing required properties');
                    }
                    
                    config = importedConfig;
                    
                    // Reset calculator state to avoid issues when switching back to Calculate tab
                    resetCalculatorState();
                    
                    // Update config panel
                    renderConfigPanel();
                    
                    alert('‚úÖ Configuration imported successfully!\n\n‚ö†Ô∏è Important: Your changes are only temporary right now.\n\nüëâ Click "Export Updated HTML File" to save these changes permanently.');
                } catch (error) {
                    alert('‚ùå Error importing configuration:\n\n' + error.message);
                }
            };
            reader.readAsText(file);
            
            // Reset the file input so the same file can be imported again if needed
            event.target.value = '';
        }

        function closeModal(event) {
            if (!event || event.target.classList.contains('modal-overlay')) {
                document.getElementById('modal-overlay').style.display = 'none';
            }
        }

        function closeModalDirect() {
            document.getElementById('modal-overlay').style.display = 'none';
        }

        // Initialize
        init();
        
        // ===== EXCEL EXPORT FUNCTIONS =====
        
        async function exportExcelWorkbook() {
            try {
                const workbook = new ExcelJS.Workbook();
                
                // Create Welcome sheet
                createWelcomeSheet(workbook);
                
                // Create a sheet for each domain that has use cases
                config.domains.forEach(domain => {
                    const domainUseCases = config.useCases.filter(uc => uc.domainId === domain.id);
                    if (domainUseCases.length > 0) {
                        createDomainSheet(workbook, domain, domainUseCases);
                    }
                });
                
                // Generate and download
                const buffer = await workbook.xlsx.writeBuffer();
                const blob = new Blob([buffer], { type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' });
                saveAs(blob, `IDMWorks_TCO_Workbook_${new Date().toISOString().split('T')[0]}.xlsx`);
                
                alert('‚úÖ Excel workbook generated successfully!');
                
            } catch (error) {
                alert('Error generating Excel: ' + error.message);
                console.error(error);
            }
        }
        
        function createWelcomeSheet(workbook) {
            const sheet = workbook.addWorksheet('Welcome');
            sheet.views = [{ showGridLines: false }];
            
            sheet.getColumn(1).width = 2.5;
            sheet.getColumn(2).width = 2.5;
            sheet.getColumn(3).width = 80;
            sheet.getColumn(4).width = 2.5;
            
            let row = 3;
            
            fillBorderRow(sheet, row, 2, 4);
            row++;
            
            fillBorderCell(sheet, row, 2);
            fillBorderCell(sheet, row, 4);
            row++;
            
            sheet.getCell(`C${row}`).value = 'IDMWorks Total Cost of Ownership Assessment';
            sheet.getCell(`C${row}`).font = { size: 22, bold: true, color: { argb: 'FFFFFFFF' } };
            sheet.getCell(`C${row}`).fill = { type: 'pattern', pattern: 'solid', fgColor: { argb: 'FFA72DBE' } };
            sheet.getCell(`C${row}`).alignment = { horizontal: 'center', vertical: 'center' };
            sheet.getRow(row).height = 35;
            fillBorderCell(sheet, row, 2);
            fillBorderCell(sheet, row, 4);
            row++;
            
            fillBorderCell(sheet, row, 2);
            fillBorderCell(sheet, row, 4);
            row++;
            
            sheet.getCell(`C${row}`).value = 'üëã Welcome!';
            sheet.getCell(`C${row}`).font = { size: 16, bold: true, color: { argb: 'FF241F55' } };
            fillBorderCell(sheet, row, 2);
            fillBorderCell(sheet, row, 4);
            row++;
            
            fillBorderCell(sheet, row, 2);
            fillBorderCell(sheet, row, 4);
            row++;
            
            sheet.getCell(`C${row}`).value = 'This workbook will help you calculate the Total Cost of Ownership for your Identity and Access Management program.';
            sheet.getCell(`C${row}`).font = { size: 12 };
            sheet.getCell(`C${row}`).alignment = { wrapText: true };
            fillBorderCell(sheet, row, 2);
            fillBorderCell(sheet, row, 4);
            row++;
            
            fillBorderCell(sheet, row, 2);
            fillBorderCell(sheet, row, 4);
            row++;
            
            sheet.getCell(`C${row}`).value = 'üìã How to Use This Workbook:';
            sheet.getCell(`C${row}`).font = { size: 14, bold: true, color: { argb: 'FF241F55' } };
            sheet.getCell(`C${row}`).fill = { type: 'pattern', pattern: 'solid', fgColor: { argb: 'FFDCE6F1' } };
            fillBorderCell(sheet, row, 2);
            fillBorderCell(sheet, row, 4);
            row++;
            
            fillBorderCell(sheet, row, 2);
            fillBorderCell(sheet, row, 4);
            row++;
            
            const steps = [
                '1. Navigate to each domain tab (IGA, CIAM, PAM, Access Management)',
                '2. Enter your answers in the LIGHT BLUE highlighted cells',
                '3. The formulas will automatically calculate your TCO',
                '4. Review the summary at the top of each sheet'
            ];
            
            steps.forEach(step => {
                sheet.getCell(`C${row}`).value = step;
                sheet.getCell(`C${row}`).font = { size: 11 };
                fillBorderCell(sheet, row, 2);
                fillBorderCell(sheet, row, 4);
                row++;
            });
            
            fillBorderCell(sheet, row, 2);
            fillBorderCell(sheet, row, 4);
            row++;
            
            sheet.getCell(`C${row}`).value = 'üìù Instructions:';
            sheet.getCell(`C${row}`).font = { size: 14, bold: true, color: { argb: 'FF241F55' } };
            sheet.getCell(`C${row}`).fill = { type: 'pattern', pattern: 'solid', fgColor: { argb: 'FFDCE6F1' } };
            fillBorderCell(sheet, row, 2);
            fillBorderCell(sheet, row, 4);
            row++;
            
            fillBorderCell(sheet, row, 2);
            fillBorderCell(sheet, row, 4);
            row++;
            
            const instructions = [
                '‚Ä¢ Each domain tab contains use cases relevant to that area',
                '‚Ä¢ Answer all questions for the use cases that apply to your organization',
                '‚Ä¢ Leave questions blank if they don\'t apply',
                '‚Ä¢ All costs are calculated on a monthly basis'
            ];
            
            instructions.forEach(instruction => {
                sheet.getCell(`C${row}`).value = instruction;
                sheet.getCell(`C${row}`).font = { size: 11 };
                fillBorderCell(sheet, row, 2);
                fillBorderCell(sheet, row, 4);
                row++;
            });
            
            fillBorderCell(sheet, row, 2);
            fillBorderCell(sheet, row, 4);
            row++;
            
            sheet.getCell(`C${row}`).value = 'üî¢ Formula Structure:';
            sheet.getCell(`C${row}`).font = { size: 14, bold: true, color: { argb: 'FF241F55' } };
            sheet.getCell(`C${row}`).fill = { type: 'pattern', pattern: 'solid', fgColor: { argb: 'FFDCE6F1' } };
            fillBorderCell(sheet, row, 2);
            fillBorderCell(sheet, row, 4);
            row++;
            
            fillBorderCell(sheet, row, 2);
            fillBorderCell(sheet, row, 4);
            row++;
            
            sheet.getCell(`C${row}`).value = 'Most use cases follow this pattern:';
            sheet.getCell(`C${row}`).font = { size: 11 };
            fillBorderCell(sheet, row, 2);
            fillBorderCell(sheet, row, 4);
            row++;
            
            sheet.getCell(`C${row}`).value = 'Monthly Cost = Volume √ó Staff Count √ó Hourly Rate √ó Hours per Transaction';
            sheet.getCell(`C${row}`).font = { size: 11, italic: true, color: { argb: 'FF0661AB' } };
            sheet.getCell(`C${row}`).fill = { type: 'pattern', pattern: 'solid', fgColor: { argb: 'FFF0F0F0' } };
            sheet.getCell(`C${row}`).alignment = { horizontal: 'center' };
            fillBorderCell(sheet, row, 2);
            fillBorderCell(sheet, row, 4);
            row++;
            
            fillBorderCell(sheet, row, 2);
            fillBorderCell(sheet, row, 4);
            row++;
            
            sheet.getCell(`C${row}`).value = '‚ùì Need Help?';
            sheet.getCell(`C${row}`).font = { size: 14, bold: true, color: { argb: 'FF241F55' } };
            sheet.getCell(`C${row}`).fill = { type: 'pattern', pattern: 'solid', fgColor: { argb: 'FFDCE6F1' } };
            fillBorderCell(sheet, row, 2);
            fillBorderCell(sheet, row, 4);
            row++;
            
            fillBorderCell(sheet, row, 2);
            fillBorderCell(sheet, row, 4);
            row++;
            
            sheet.getCell(`C${row}`).value = 'Contact IDMWorks for assistance with your TCO assessment.';
            sheet.getCell(`C${row}`).font = { size: 11 };
            fillBorderCell(sheet, row, 2);
            fillBorderCell(sheet, row, 4);
            row++;
            
            fillBorderCell(sheet, row, 2);
            fillBorderCell(sheet, row, 4);
            row++;
            
            fillBorderRow(sheet, row, 2, 4);
        }
        
        function createDomainSheet(workbook, domain, useCases) {
            const sheet = workbook.addWorksheet(domain.name);
            sheet.views = [{ showGridLines: false }];
            
            sheet.getColumn(1).width = 2.5;
            sheet.getColumn(2).width = 2.5;
            sheet.getColumn(3).width = 6.5;
            sheet.getColumn(4).width = 80;
            sheet.getColumn(5).width = 9;
            sheet.getColumn(6).width = 12;
            sheet.getColumn(7).width = 12;
            for (let i = 8; i <= 17; i++) {
                sheet.getColumn(i).width = 3;
            }
            
            let currentRow = 3;
            
            const summaryStartRow = currentRow;
            fillBorderRow(sheet, currentRow, 2, 17);
            currentRow++;
            
            sheet.mergeCells(`D${currentRow}:P${currentRow}`);
            const titleCell = sheet.getCell(`D${currentRow}`);
            titleCell.value = `Total Cost of Ownership (TCO) - ${domain.name}`;
            titleCell.font = { size: 18, bold: true, color: { argb: 'FFFFFFFF' } };
            titleCell.fill = { type: 'pattern', pattern: 'solid', fgColor: { argb: 'FF00B0F0' } };
            titleCell.alignment = { horizontal: 'center', vertical: 'center' };
            titleCell.border = { top: {style: 'thin'}, bottom: {style: 'thin'}, left: {style: 'thin'}, right: {style: 'thin'} };
            fillBorderCell(sheet, currentRow, 2);
            fillBorderCell(sheet, currentRow, 17);
            sheet.getRow(currentRow).height = 29;
            currentRow++;
            
            fillBorderCell(sheet, currentRow, 2);
            fillBorderCell(sheet, currentRow, 17);
            currentRow++;
            
            const monthlySumRow = currentRow;
            sheet.mergeCells(`D${currentRow}:F${currentRow}`);
            sheet.getCell(`D${currentRow}`).value = { formula: '' };
            sheet.getCell(`D${currentRow}`).fill = { type: 'pattern', pattern: 'solid', fgColor: { argb: 'FFFFFFFF' } };
            sheet.getCell(`D${currentRow}`).border = getAllBorders();
            sheet.getCell(`D${currentRow}`).numFmt = '$#,##0';
            sheet.getCell(`D${currentRow}`).alignment = { horizontal: 'right' };
            sheet.getCell(`G${currentRow}`).value = '‚Üê Monthly TCO';
            fillBorderCell(sheet, currentRow, 2);
            fillBorderCell(sheet, currentRow, 17);
            currentRow++;
            
            fillBorderCell(sheet, currentRow, 2);
            fillBorderCell(sheet, currentRow, 17);
            currentRow++;
            
            const licenseCostRow = currentRow;
            sheet.mergeCells(`D${currentRow}:F${currentRow}`);
            sheet.getCell(`D${currentRow}`).value = 0;
            sheet.getCell(`D${currentRow}`).fill = { type: 'pattern', pattern: 'solid', fgColor: { argb: 'FFC5E0B4' } };
            sheet.getCell(`D${currentRow}`).border = getAllBorders();
            sheet.getCell(`D${currentRow}`).numFmt = '$#,##0';
            sheet.getCell(`D${currentRow}`).alignment = { horizontal: 'right' };
            sheet.getCell(`G${currentRow}`).value = '‚Üê Annual License from Current IGA tool';
            fillBorderCell(sheet, currentRow, 2);
            fillBorderCell(sheet, currentRow, 17);
            currentRow++;
            
            fillBorderCell(sheet, currentRow, 2);
            fillBorderCell(sheet, currentRow, 17);
            currentRow++;
            
            const annualTCORow = currentRow;
            sheet.mergeCells(`D${currentRow}:F${currentRow}`);
            sheet.getCell(`D${currentRow}`).value = { formula: `(D${monthlySumRow}*12)+D${licenseCostRow}` };
            sheet.getCell(`D${currentRow}`).fill = { type: 'pattern', pattern: 'solid', fgColor: { argb: 'FF92D050' } };
            sheet.getCell(`D${currentRow}`).border = getAllBorders();
            sheet.getCell(`D${currentRow}`).numFmt = '$#,##0';
            sheet.getCell(`D${currentRow}`).alignment = { horizontal: 'right' };
            sheet.getCell(`G${currentRow}`).value = '‚Üê Yearly TCO';
            fillBorderCell(sheet, currentRow, 2);
            fillBorderCell(sheet, currentRow, 17);
            currentRow++;
            
            const threeYearRow = currentRow;
            sheet.mergeCells(`D${currentRow}:F${currentRow}`);
            sheet.getCell(`D${currentRow}`).value = { formula: `D${annualTCORow}*3` };
            sheet.getCell(`D${currentRow}`).fill = { type: 'pattern', pattern: 'solid', fgColor: { argb: 'FFBDD7EE' } };
            sheet.getCell(`D${currentRow}`).border = getAllBorders();
            sheet.getCell(`D${currentRow}`).numFmt = '$#,##0';
            sheet.getCell(`D${currentRow}`).alignment = { horizontal: 'right' };
            sheet.getCell(`G${currentRow}`).value = '‚Üê 3 year TCO Investment';
            fillBorderCell(sheet, currentRow, 2);
            fillBorderCell(sheet, currentRow, 17);
            currentRow++;
            
            const fiveYearRow = currentRow;
            sheet.mergeCells(`D${currentRow}:F${currentRow}`);
            sheet.getCell(`D${currentRow}`).value = { formula: `D${annualTCORow}*5` };
            sheet.getCell(`D${currentRow}`).fill = { type: 'pattern', pattern: 'solid', fgColor: { argb: 'FF9BC2E6' } };
            sheet.getCell(`D${currentRow}`).border = getAllBorders();
            sheet.getCell(`D${currentRow}`).numFmt = '$#,##0';
            sheet.getCell(`D${currentRow}`).alignment = { horizontal: 'right' };
            sheet.getCell(`G${currentRow}`).value = '‚Üê 5 year TCO Investment';
            fillBorderCell(sheet, currentRow, 2);
            fillBorderCell(sheet, currentRow, 17);
            currentRow++;
            
            fillBorderCell(sheet, currentRow, 2);
            fillBorderCell(sheet, currentRow, 17);
            currentRow++;
            
            fillBorderRow(sheet, currentRow, 2, 17);
            currentRow += 2;
            
            fillBorderRow(sheet, currentRow, 2, 17);
            currentRow++;
            
            sheet.mergeCells(`D${currentRow}:P${currentRow}`);
            sheet.getCell(`D${currentRow}`).value = 'Instructions: Enter your answers for each of the following questions in the Grey cells located in column D.';
            sheet.getCell(`D${currentRow}`).font = { size: 12, italic: true };
            sheet.getCell(`D${currentRow}`).alignment = { horizontal: 'center', vertical: 'center' };
            fillBorderCell(sheet, currentRow, 2);
            fillBorderCell(sheet, currentRow, 17);
            currentRow++;
            
            fillBorderRow(sheet, currentRow, 2, 17);
            currentRow += 2;
            
            const useCaseFormulaRows = [];
            
            useCases.forEach((useCase, ucIndex) => {
                fillBorderRow(sheet, currentRow, 2, 17);
                currentRow++;
                
                fillBorderCell(sheet, currentRow, 2);
                fillBorderCell(sheet, currentRow, 17);
                currentRow++;
                
                const useCaseHeaderRow = currentRow;
                sheet.mergeCells(`D${currentRow}:J${currentRow}`);
                const headerCell = sheet.getCell(`D${currentRow}`);
                headerCell.value = `${getUseCaseIcon(ucIndex)} ${useCase.name}`;
                headerCell.font = { size: 16, bold: true, color: { argb: 'FFFFFFFF' } };
                headerCell.fill = { type: 'pattern', pattern: 'solid', fgColor: { argb: getUseCaseColor(ucIndex) } };
                headerCell.alignment = { horizontal: 'left', vertical: 'center' };
                sheet.getRow(currentRow).height = 30;
                fillBorderCell(sheet, currentRow, 2);
                fillBorderCell(sheet, currentRow, 17);
                currentRow++;
                
                fillBorderCell(sheet, currentRow, 2);
                fillBorderCell(sheet, currentRow, 17);
                currentRow++;
                
                const mappings = config.mappings.filter(m => m.useCaseId === useCase.id);
                const answerCells = [];
                
                mappings.forEach((mapping, qIndex) => {
                    const question = config.questions.find(q => q.id === mapping.questionId);
                    if (question) {
                        sheet.getCell(`C${currentRow}`).value = `${qIndex + 1}-`;
                        sheet.getCell(`C${currentRow}`).font = { size: 12 };
                        sheet.getCell(`D${currentRow}`).value = question.text;
                        sheet.getCell(`D${currentRow}`).font = { size: 12 };
                        sheet.getCell(`D${currentRow}`).alignment = { wrapText: true, vertical: 'top' };
                        fillBorderCell(sheet, currentRow, 2);
                        fillBorderCell(sheet, currentRow, 17);
                        currentRow++;
                        
                        const answerRow = currentRow;
                        sheet.mergeCells(`D${answerRow}:E${answerRow}`);
                        sheet.getCell(`D${answerRow}`).value = 0;
                        sheet.getCell(`D${answerRow}`).fill = { type: 'pattern', pattern: 'solid', fgColor: { argb: 'FFDCE6F1' } };
                        sheet.getCell(`D${answerRow}`).border = getAllBorders();
                        sheet.getCell(`D${answerRow}`).font = { size: 12 };
                        sheet.getCell(`D${answerRow}`).alignment = { horizontal: 'center' };
                        sheet.getCell(`F${answerRow}`).value = `‚Üê ${mapping.variableName}`;
                        sheet.getCell(`F${answerRow}`).font = { size: 11 };
                        answerCells.push({ cell: `D${answerRow}`, variable: mapping.variableName });
                        fillBorderCell(sheet, answerRow, 2);
                        fillBorderCell(sheet, answerRow, 17);
                        currentRow++;
                        
                        fillBorderCell(sheet, currentRow, 2);
                        fillBorderCell(sheet, currentRow, 17);
                        currentRow++;
                    }
                });
                
                const formulaRow = currentRow;
                useCaseFormulaRows.push({ row: formulaRow, answerCells, formula: useCase.formula });
                
                sheet.mergeCells(`D${formulaRow}:E${formulaRow}`);
                sheet.getCell(`D${formulaRow}`).fill = { type: 'pattern', pattern: 'solid', fgColor: { argb: 'FF00B0F0' } };
                sheet.getCell(`D${formulaRow}`).border = getAllBorders();
                sheet.getCell(`D${formulaRow}`).font = { size: 12, bold: true };
                sheet.getCell(`D${formulaRow}`).numFmt = '$#,##0';
                sheet.getCell(`D${formulaRow}`).alignment = { horizontal: 'center' };
                sheet.getCell(`F${formulaRow}`).value = `‚Üê Total Cost of Ownership Formula: (${useCase.formula})`;
                sheet.getCell(`F${formulaRow}`).font = { size: 11 };
                fillBorderCell(sheet, formulaRow, 2);
                fillBorderCell(sheet, formulaRow, 17);
                currentRow++;
                
                fillBorderCell(sheet, currentRow, 2);
                fillBorderCell(sheet, currentRow, 17);
                currentRow++;
                
                fillBorderRow(sheet, currentRow, 2, 17);
                currentRow += 2;
            });
            
            useCaseFormulaRows.forEach(ucInfo => {
                const excelFormula = convertFormulaToExcel(ucInfo.formula, ucInfo.answerCells);
                sheet.getCell(`D${ucInfo.row}`).value = { formula: excelFormula };
            });
            
            const sumFormula = useCaseFormulaRows.map(uc => `D${uc.row}`).join('+');
            sheet.getCell(`D${monthlySumRow}`).value = { formula: sumFormula };
        }
        
        function fillBorderCell(sheet, row, col) {
            const cell = sheet.getCell(row, col);
            cell.fill = { type: 'pattern', pattern: 'solid', fgColor: { argb: 'FF6C6A6F' } };
        }
        
        function fillBorderRow(sheet, row, startCol, endCol) {
            for (let col = startCol; col <= endCol; col++) {
                fillBorderCell(sheet, row, col);
            }
        }
        
        function getAllBorders() {
            return {
                top: { style: 'thin' },
                left: { style: 'thin' },
                bottom: { style: 'thin' },
                right: { style: 'thin' }
            };
        }
        
        function getUseCaseIcon(index) {
            const icons = ['üë§', 'üè¢', 'üîÑ', '‚öôÔ∏è', 'üîê', 'üìä', '‚úÖ', 'üîç', '‚è±Ô∏è', 'üìù'];
            return icons[index % icons.length];
        }
        
        function getUseCaseColor(index) {
            const colors = ['FFA72DBE', 'FF91257A'];
            return colors[index % colors.length];
        }
        
        function convertFormulaToExcel(formula, answerCells) {
            let excelFormula = formula;
            answerCells.forEach(answerInfo => {
                const regex = new RegExp('\\b' + answerInfo.variable + '\\b', 'g');
                excelFormula = excelFormula.replace(regex, answerInfo.cell);
            });
            return excelFormula;
        }
    </script>


</body></html>