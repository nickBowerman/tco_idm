<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IDMWorks - IGA Total Cost of Ownership Calculator</title>
    <style>
        :root {
            --idm-navy: #241F55;
            --idm-gray: #6C6A6F;
            --idm-cyan: #00C2EF;
            --idm-blue: #0661AB;
            --idm-purple: #A72DBE;
            --idm-magenta: #91257A;
            --idm-red: #EC313A;
            --idm-orange: #EF3D2F;
            --idm-yellow: #FFC91E;
            --primary-color: #241F55;
            --secondary-color: #A72DBE;
            --accent-color: #00C2EF;
            --text-color: #444444;
            --bg-color: #f9f9f9;
            --border-radius: 12px;
            --box-shadow: 0 4px 12px rgba(36, 31, 85, 0.15);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header */
        header {
            background: white;
            box-shadow: var(--box-shadow);
            margin-bottom: 30px;
            border-radius: var(--border-radius);
        }

        .header-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 20px 30px;
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .logo {
            max-width: 200px;
            height: auto;
        }

        h1 {
            color: var(--primary-color);
            font-size: 1.8rem;
            font-weight: 600;
        }

        /* Mode Toggle */
        .mode-toggle {
            display: flex;
            gap: 0.5rem;
            background: var(--bg-color);
            padding: 0.5rem;
            border-radius: 8px;
        }

        .mode-btn {
            padding: 0.75rem 1.5rem;
            border: none;
            background: transparent;
            color: var(--text-color);
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            border-radius: 6px;
            transition: all 0.2s ease;
        }

        .mode-btn.active {
            background: var(--primary-color);
            color: white;
        }

        .mode-btn:hover:not(.active) {
            background: white;
        }

        /* Card */
        .card {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 30px;
            margin-bottom: 30px;
        }

        /* Welcome Screen */
        #welcome-screen {
            text-align: center;
        }

        .welcome-header {
            font-size: 2.5rem;
            margin-bottom: 20px;
            color: var(--primary-color);
            font-weight: 700;
        }

        .welcome-subheader {
            font-size: 1.5rem;
            margin-bottom: 30px;
            color: var(--secondary-color);
            font-style: italic;
        }

        .info-section {
            text-align: left;
            margin-bottom: 30px;
            padding: 25px;
            background: #f5f5f5;
            border-radius: var(--border-radius);
            border-left: 4px solid var(--accent-color);
        }

        .info-section h3 {
            color: var(--primary-color);
            margin-bottom: 15px;
            font-size: 1.3rem;
        }

        .formula {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
            border-left: 3px solid var(--secondary-color);
        }

        .start-button {
            background: linear-gradient(135deg, var(--secondary-color), var(--accent-color));
            color: white;
            font-size: 1.2rem;
            padding: 15px 50px;
            border-radius: var(--border-radius);
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 20px;
        }

        .start-button:hover {
            transform: translateY(-3px);
            box-shadow: var(--box-shadow);
        }

        /* Progress Bar */
        .progress-container {
            width: 100%;
            height: 10px;
            background: #f0f0f0;
            border-radius: 5px;
            margin-bottom: 30px;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--secondary-color), var(--accent-color));
            width: 0;
            transition: width 0.3s ease;
        }

        /* Domain Selection */
        .domains-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .domain-card {
            background: white;
            border: 3px solid #ddd;
            border-radius: var(--border-radius);
            padding: 30px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            text-align: center;
        }

        .domain-card:hover {
            border-color: var(--accent-color);
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(167, 45, 190, 0.2);
        }

        .domain-card.selected {
            background: linear-gradient(135deg, rgba(167, 45, 190, 0.15), rgba(0, 194, 239, 0.15));
            border-color: var(--secondary-color);
            border-width: 3px;
        }

        .domain-card.selected::before {
            content: "‚úì";
            position: absolute;
            top: 15px;
            right: 15px;
            background: var(--secondary-color);
            color: white;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.2rem;
        }

        .domain-icon {
            font-size: 3rem;
            margin-bottom: 15px;
        }

        .domain-title {
            font-size: 1.4rem;
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 10px;
        }

        .domain-description {
            font-size: 0.95rem;
            color: var(--idm-gray);
            line-height: 1.5;
        }

        /* Vertical Selector */
        .vertical-selector-section {
            margin-top: 30px;
            padding-top: 30px;
            border-top: 2px solid #e0e0e0;
        }

        .vertical-selector-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 10px;
        }

        .vertical-selector-description {
            color: var(--idm-gray);
            margin-bottom: 20px;
            font-size: 0.95rem;
        }

        .vertical-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
        }

        .vertical-btn {
            padding: 12px 24px;
            border: 2px solid #ddd;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.95rem;
            font-weight: 500;
            color: var(--text-color);
        }

        .vertical-btn:hover {
            border-color: var(--accent-color);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 194, 239, 0.2);
        }

        .vertical-btn.selected {
            background: linear-gradient(135deg, rgba(167, 45, 190, 0.15), rgba(0, 194, 239, 0.15));
            border-color: var(--secondary-color);
            color: var(--primary-color);
            font-weight: 600;
        }

        .vertical-btn.selected::before {
            content: "‚úì ";
            font-weight: bold;
        }

        /* Vertical Tabs in Config */
        .vertical-tabs-container {
            margin-bottom: 20px;
        }

        .vertical-tabs {
            display: flex;
            gap: 10px;
            border-bottom: 2px solid #e0e0e0;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .vertical-tab {
            padding: 12px 20px;
            background: transparent;
            border: none;
            border-bottom: 3px solid transparent;
            cursor: pointer;
            font-size: 0.95rem;
            font-weight: 500;
            color: var(--idm-gray);
            transition: all 0.2s ease;
        }

        .vertical-tab:hover {
            color: var(--primary-color);
            border-bottom-color: var(--accent-color);
        }

        .vertical-tab.active {
            color: var(--primary-color);
            border-bottom-color: var(--secondary-color);
            font-weight: 600;
        }

        .vertical-tab-content {
            display: none;
        }

        .vertical-tab-content.active {
            display: block;
        }

        .vertical-badge-config {
            display: inline-block;
            background: var(--accent-color);
            color: white;
            padding: 3px 10px;
            border-radius: 4px;
            font-size: 0.8rem;
            margin-left: 10px;
            font-weight: 500;
        }

        /* Use Case Selection */
        .use-cases-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .use-case-card {
            background: white;
            border: 2px solid #ddd;
            border-radius: var(--border-radius);
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .use-case-card:hover {
            border-color: var(--accent-color);
            transform: translateY(-2px);
            box-shadow: var(--box-shadow);
        }

        .use-case-card.selected {
            background: linear-gradient(135deg, rgba(167, 45, 190, 0.1), rgba(0, 194, 239, 0.1));
            border-color: var(--secondary-color);
            border-width: 3px;
        }

        .use-case-card.selected::before {
            content: "‚úì";
            position: absolute;
            top: 10px;
            right: 10px;
            background: var(--secondary-color);
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .use-case-title {
            font-weight: 600;
            color: var(--primary-color);
            font-size: 1.1rem;
        }

        .use-case-category {
            font-size: 0.85rem;
            color: var(--idm-gray);
            margin-top: 5px;
        }

        .selected-count {
            text-align: center;
            font-size: 1.1rem;
            color: var(--secondary-color);
            margin-bottom: 20px;
            font-weight: 500;
        }

        /* Domain sections for organizing use cases */
        .domain-section {
            margin-bottom: 40px;
            padding: 25px;
            background: #f5f5f5;
            border-radius: var(--border-radius);
            border-left: 4px solid var(--secondary-color);
        }

        .domain-section-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--secondary-color);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* Questions */
        .question-section {
            margin-bottom: 40px;
        }

        .section-title {
            font-size: 1.4rem;
            font-weight: 600;
            margin-bottom: 20px;
            color: var(--secondary-color);
            border-bottom: 2px solid var(--accent-color);
            padding-bottom: 10px;
        }

        .subsection-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--primary-color);
            margin: 30px 0 15px 0;
            padding-left: 15px;
            border-left: 3px solid var(--accent-color);
        }

        .input-group {
            margin-bottom: 25px;
        }

        .input-label {
            display: block;
            font-weight: 500;
            color: var(--primary-color);
            margin-bottom: 8px;
        }

        .input-field {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .input-field:focus {
            outline: none;
            border-color: var(--accent-color);
        }

        /* Hide number spinners */
        input[type="number"]::-webkit-inner-spin-button,
        input[type="number"]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        
        input[type="number"] {
            -moz-appearance: textfield;
        }

        /* Buttons */
        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--secondary-color), var(--accent-color));
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: var(--box-shadow);
        }

        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background: var(--idm-gray);
            color: white;
        }

        .btn-secondary:hover {
            background: var(--primary-color);
        }

        .btn-outline {
            background: transparent;
            border: 2px solid var(--primary-color);
            color: var(--primary-color);
        }

        .btn-outline:hover {
            background: var(--primary-color);
            color: white;
        }

        .btn-danger {
            background: var(--idm-red);
            color: white;
        }

        .btn-danger:hover {
            background: #c71f1f;
        }

        .btn-group {
            display: flex;
            gap: 15px;
            justify-content: space-between;
            margin-top: 30px;
        }

        /* Processing Screen */
        #processing-screen {
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 400px;
        }

        .spinner {
            width: 60px;
            height: 60px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid var(--secondary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .processing-text {
            margin-top: 20px;
            font-size: 1.2rem;
            color: var(--primary-color);
        }

        /* Results */
        .results-summary {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 40px;
            border-radius: var(--border-radius);
            margin-bottom: 30px;
            text-align: center;
        }

        .results-title {
            font-size: 1.2rem;
            opacity: 0.9;
            margin-bottom: 10px;
        }

        .results-value {
            font-size: 3.5rem;
            font-weight: 700;
            margin-bottom: 30px;
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .result-item {
            background: rgba(255,255,255,0.15);
            padding: 20px;
            border-radius: 8px;
            backdrop-filter: blur(10px);
        }

        .result-label {
            font-size: 0.9rem;
            opacity: 0.9;
            margin-bottom: 5px;
        }

        .result-value {
            font-size: 1.8rem;
            font-weight: 600;
        }

        /* Config Panel Styles */
        .domain-config-section {
            background: var(--bg-color);
            border: 2px solid #ddd;
            border-radius: var(--border-radius);
            padding: 25px;
            margin-bottom: 25px;
        }

        .domain-config-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #ddd;
        }

        .domain-config-title {
            font-size: 1.4rem;
            font-weight: 600;
            color: var(--primary-color);
        }

        .use-case-section {
            background: white;
            border: 1px solid #ddd;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .use-case-section-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #ddd;
        }

        .use-case-section-info {
            flex: 1;
        }

        .use-case-section-title {
            font-size: 1.15rem;
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 5px;
        }

        .use-case-section-meta {
            font-size: 0.85rem;
            color: var(--idm-gray);
            margin-bottom: 10px;
        }

        .use-case-formula {
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            background: var(--bg-color);
            padding: 10px;
            border-radius: 6px;
            border: 1px solid #ddd;
        }

        .use-case-section-actions {
            display: flex;
            gap: 10px;
        }

        .nested-questions {
            margin-top: 15px;
        }

        .nested-question-item {
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }

        .nested-question-content {
            flex: 1;
            margin-right: 15px;
        }

        .nested-question-text {
            font-size: 1rem;
            color: var(--text-color);
            margin-bottom: 5px;
        }

        .nested-question-meta {
            font-size: 0.85rem;
            color: var(--idm-gray);
        }

        .nested-question-actions {
            display: flex;
            gap: 10px;
            flex-shrink: 0;
        }

        .add-question-prompt {
            text-align: center;
            padding: 30px;
            background: white;
            border: 2px dashed #ddd;
            border-radius: 8px;
            color: var(--idm-gray);
            margin-top: 15px;
        }

        /* Domain breakdown in results */
        .domain-breakdown {
            margin-bottom: 30px;
            padding: 25px;
            background: #f5f5f5;
            border-radius: var(--border-radius);
            border-left: 4px solid var(--secondary-color);
        }

        .domain-breakdown-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--secondary-color);
            margin-bottom: 15px;
        }

        .domain-breakdown-total {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 15px;
        }

        .list-item {
            background: var(--bg-color);
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .list-item-content {
            flex: 1;
        }

        .list-item-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 5px;
        }

        .list-item-meta {
            font-size: 0.85rem;
            color: var(--idm-gray);
        }

        .list-item-actions {
            display: flex;
            gap: 10px;
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal-content {
            background: white;
            border-radius: var(--border-radius);
            max-width: 800px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            padding: 30px;
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 25px;
        }

        /* Form Elements */
        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            font-weight: 500;
            color: var(--primary-color);
            margin-bottom: 8px;
        }

        input[type="text"],
        textarea,
        select {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        textarea {
            resize: vertical;
            min-height: 100px;
        }

        input:focus,
        textarea:focus,
        select:focus {
            outline: none;
            border-color: var(--accent-color);
        }

        small {
            display: block;
            margin-top: 5px;
            color: var(--idm-gray);
            font-size: 0.85rem;
        }

        /* Empty States */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--idm-gray);
        }

        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: 15px;
            opacity: 0.3;
        }

        .empty-state-text {
            font-size: 1.2rem;
            margin-bottom: 10px;
        }

        /* Utility */
        .hidden {
            display: none !important;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 20px;
            }

            .mode-toggle {
                width: 100%;
            }

            .mode-btn {
                flex: 1;
            }

            .use-cases-grid {
                grid-template-columns: 1fr;
            }

            .btn-group {
                flex-direction: column;
            }

            .results-value {
                font-size: 2.5rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header>
            <div class="header-content">
                <div class="logo-section">
                    <img src="data:image/png;base64,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" alt="IDMWorks" class="logo" id="logo-img">
                    <h1>IGA Total Cost of Ownership Calculator</h1>
                </div>
                <div class="mode-toggle">
                    <button class="mode-btn active" onclick="switchMode('calculate')">Calculate TCO</button>
                    <button class="mode-btn" onclick="switchMode('configure')">Configure</button>
                </div>
            </div>
        </header>

        <!-- Calculate Panel -->
        <div id="calculatePanel">
            <!-- Welcome Screen -->
            <div id="welcome-screen" class="card">
                <h2 class="welcome-header">Welcome to the TCO Calculator</h2>
                <p class="welcome-subheader">Discover Your True Identity & Access Management Costs</p>

                <div class="info-section">
                    <h3>What This Calculator Does</h3>
                    <p>This tool helps you quantify the <strong>total cost of ownership</strong> across multiple identity and access management domains: IGA, CIAM, PAM, and Access Management. Many organizations focus solely on software licensing costs, but the real expense lies in the <strong>people, processes, and time</strong> required to manage identities, access, and compliance.</p>
                    
                    <p style="margin-top: 15px;">By answering questions about your processes, you'll get a comprehensive view of:</p>
                    <ul style="margin-left: 20px; margin-top: 10px;">
                        <li>Monthly operational costs by domain</li>
                        <li>Annual TCO including license fees</li>
                        <li>3-year and 5-year investment projections</li>
                    </ul>
                </div>

                <div class="info-section">
                    <h3>How It Works</h3>
                    <p><strong>Step 1:</strong> Select the identity management domains relevant to your organization</p>
                    <p><strong>Step 2:</strong> Choose specific use cases within each domain</p>
                    <p><strong>Step 3:</strong> Answer questions about volumes, staff involvement, and time spent</p>
                    <p><strong>Step 4:</strong> Review your total cost of ownership breakdown</p>
                    
                    <div class="formula">
                        <div class="formula-label">Standard Cost Formula:</div>
                        Monthly Cost = Volume √ó Staff Count √ó Hourly Rate √ó Hours per Transaction
                    </div>
                </div>

                <button class="start-button" onclick="startCalculator()">Start Assessment ‚Üí</button>
            </div>

            <!-- Calculator Steps -->
            <div id="calculator-container" class="hidden">
                <div class="progress-container">
                    <div class="progress-bar" id="progress-bar"></div>
                </div>

                <!-- Step 1: Select Domains -->
                <div id="step-1" class="card">
                    <h2 class="section-title">Step 1: Select Your Domains</h2>
                    <p style="margin-bottom: 25px; color: var(--idm-gray);">
                        Choose the identity and access management domains you want to assess. You can select multiple domains.
                    </p>
                    <div class="selected-count" id="selected-domains-count">0 domains selected</div>
                    <div class="domains-grid" id="domains-grid">
                        <!-- Domains populated here -->
                    </div>
                    
                    <!-- Vertical Selector -->
                    <div class="vertical-selector-section">
                        <h3 class="vertical-selector-title">Industry Vertical (Optional)</h3>
                        <p class="vertical-selector-description">
                            Select your industry to see vertical-specific use cases, or leave unselected to see universal use cases only.
                        </p>
                        <div class="vertical-buttons" id="vertical-buttons">
                            <button class="vertical-btn" onclick="selectVertical('universal')">All Industries</button>
                            <button class="vertical-btn" onclick="selectVertical('healthcare')">Healthcare</button>
                            <button class="vertical-btn" onclick="selectVertical('higher-education')">Higher Education</button>
                            <button class="vertical-btn" onclick="selectVertical('finance-insurance')">Finance | Insurance</button>
                            <button class="vertical-btn" onclick="selectVertical('manufacturing')">Manufacturing</button>
                        </div>
                    </div>
                    
                    <div class="btn-group">
                        <button class="btn btn-secondary" onclick="backToWelcome()">‚Üê Back</button>
                        <button class="btn btn-primary" id="next-btn-step1" onclick="goToStep2()" disabled>Next: Select Use Cases ‚Üí</button>
                    </div>
                </div>

                <!-- Step 2: Use Case Selection -->
                <div id="step-2" class="card hidden">
                    <h2 class="section-title">Step 2: Select Use Cases</h2>
                    <p style="margin-bottom: 25px; color: var(--idm-gray);">
                        Choose the specific processes you want to cost out within each selected domain.
                    </p>
                    <div class="selected-count" id="selected-usecases-count">0 use cases selected</div>
                    <div id="use-cases-by-domain">
                        <!-- Use cases grouped by domain populated here -->
                    </div>
                    <div class="btn-group">
                        <button class="btn btn-secondary" onclick="backToStep1()">‚Üê Back</button>
                        <button class="btn btn-primary" id="next-btn-step2" onclick="goToStep3()" disabled>Next: Answer Questions ‚Üí</button>
                    </div>
                </div>

                <!-- Step 3: Questions -->
                <div id="step-3" class="card hidden">
                    <h2 class="section-title">Step 3: Answer Questions</h2>
                    <p style="margin-bottom: 25px; color: var(--idm-gray);">
                        Provide information about each selected use case. Enter your best estimates.
                    </p>
                    <div id="questions-container">
                        <!-- Questions populated here -->
                    </div>
                    <div class="btn-group">
                        <button class="btn btn-secondary" onclick="backToStep2()">‚Üê Back</button>
                        <button class="btn btn-primary" id="calculate-btn" onclick="calculateTCO()">Calculate TCO ‚Üí</button>
                    </div>
                </div>
            </div>

            <!-- Processing Screen -->
            <div id="processing-screen" class="card">
                <div class="spinner"></div>
                <p class="processing-text">Calculating your Total Cost of Ownership...</p>
            </div>

            <!-- Results Screen -->
            <div id="results-screen" class="hidden">
                <div class="results-summary">
                    <div class="results-title">Monthly Total Cost of Ownership</div>
                    <div class="results-value" id="monthly-total">$0</div>
                    <div class="results-grid">
                        <div class="result-item">
                            <div class="result-label">Annual TCO</div>
                            <div class="result-value" id="annual-total">$0</div>
                            <div class="result-subtext" id="license-cost-subtext" style="display: none; font-size: 0.85rem; color: rgba(255,255,255,0.8); margin-top: 5px;">(incl. <span id="license-cost-inline">$0</span> IGA license costs)</div>
                        </div>
                        <div class="result-item">
                            <div class="result-label">3-Year TCO</div>
                            <div class="result-value" id="three-year-total">$0</div>
                        </div>
                        <div class="result-item">
                            <div class="result-label">5-Year TCO</div>
                            <div class="result-value" id="five-year-total">$0</div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h2 class="section-title">Cost Breakdown by Domain</h2>
                    <div id="breakdown-container">
                        <!-- Breakdown populated here -->
                    </div>
                </div>

                <div class="btn-group">
                    <button class="btn btn-primary" onclick="exportResults()">Export Report</button>
                    <button class="btn btn-secondary" onclick="editResponses()">‚Üê Edit Responses</button>
                    <button class="btn btn-outline" onclick="startOver()">Start Over</button>
                </div>
            </div>
        </div>

        <!-- Configure Panel -->
        <div id="configurePanel" class="hidden">
            <div class="card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h2 class="section-title" style="margin: 0; border: none; padding: 0;">Manage Domains & Use Cases</h2>
                    <button class="btn btn-primary" onclick="showAddDomainForm()">+ Add Domain</button>
                </div>
                <p style="margin-bottom: 25px; color: var(--idm-gray);">
                    Configure domains, add use cases, assign questions, and define cost formulas.
                </p>
                <div id="domain-management">
                    <!-- Domain sections populated here -->
                </div>
            </div>

            <div class="card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h2 class="section-title" style="margin: 0; border: none; padding: 0;">Questions Library</h2>
                    <button class="btn btn-primary" onclick="showAddQuestionForm()">+ Add Question</button>
                </div>
                <p style="margin-bottom: 25px; color: var(--idm-gray);">
                    Create reusable questions that can be assigned to any use case across all domains.
                </p>
                <div id="question-library">
                    <!-- Questions populated here -->
                </div>
            </div>

            <div class="card">
                <h2 class="section-title">Import / Export Configuration</h2>
                <div class="btn-group">
                    <button class="btn btn-primary" onclick="exportConfiguration()">Export Configuration (JSON)</button>
                    <button class="btn btn-outline" onclick="document.getElementById('import-file').click()">Import Configuration</button>
                    <input type="file" id="import-file" accept=".json" style="display: none;" onchange="importConfiguration(event)">
                </div>
            </div>
        </div>
    </div>

    <!-- Modal -->
    <div class="modal-overlay" id="modal-overlay" onclick="closeModal(event)">
        <div class="modal-content" onclick="event.stopPropagation()">
            <div id="modal-body"></div>
        </div>
    </div>

    <script>
        // Configuration Data
        let config = {
            domains: [],
            useCases: [],
            questions: [],
            mappings: []
        };

        // User Data
        let selectedDomains = new Set();
        let selectedUseCases = new Set();
        let selectedVertical = 'universal'; // Default to universal (all industries)
        let userResponses = {};
        let annualLicenseCost = 0;

        // Initialize
        function init() {
            loadConfigFromStorage();
            if (config.domains.length === 0) {
                initializeSampleData();
            }
            
            // Backward compatibility: ensure all use cases have a vertical property
            config.useCases.forEach(uc => {
                if (!uc.vertical) {
                    uc.vertical = 'universal';
                }
            });
            
            // Save if we added vertical properties
            if (config.useCases.some(uc => !uc.hasOwnProperty('vertical'))) {
                saveConfigToStorage();
            }
        }

        // Sample Data
        function initializeSampleData() {
            // Define domains first
            config.domains = [
                { id: 1, name: "IGA", icon: "üîê", description: "Identity Governance & Administration" },
                { id: 2, name: "CIAM", icon: "üë§", description: "Customer Identity & Access Management" },
                { id: 3, name: "PAM", icon: "üîë", description: "Privileged Access Management" },
                { id: 4, name: "Access Management", icon: "üö™", description: "General Access Control" }
            ];

            // Use cases now have domainId and vertical properties
            config.useCases = [
                { id: 1, domainId: 1, name: "New Hire Onboarding", category: "Joiner/Mover/Leaver", vertical: "universal", formula: "numUsers * staffCount * laborRate * hours" },
                { id: 2, domainId: 1, name: "Offboarding/Terminations", category: "Joiner/Mover/Leaver", vertical: "universal", formula: "numUsers * staffCount * laborRate * hours" },
                { id: 3, domainId: 1, name: "Duplicate User Creation", category: "Data Quality", vertical: "universal", formula: "numDuplicates * staffCount * laborRate * hours" },
                { id: 4, domainId: 1, name: "Access Request Fulfillment Delays", category: "Access Management", vertical: "universal", formula: "delayHours * numUsers * laborRate" },
                { id: 5, domainId: 1, name: "Access Reviews", category: "Governance", vertical: "universal", formula: "numCampaigns * reviewers * laborRate * hoursPerReview" },
                { id: 6, domainId: 4, name: "Password Resets", category: "Operations", vertical: "universal", formula: "numResets * laborRate * timePerReset" }
            ];

            config.questions = [
                { id: 1, text: "How many employees, contractors, and/or suppliers are onboarded per month?", inputType: "number", defaultValue: 0 },
                { id: 2, text: "How many people on the Security team are involved when a new user is onboarded?", inputType: "number", defaultValue: 0 },
                { id: 3, text: "What is the average fully burdened hourly labor rate for each Security team member?", inputType: "number", defaultValue: 60 },
                { id: 4, text: "How many hours (on average) does each Security team member spend onboarding a User?", inputType: "number", defaultValue: 0 },
                { id: 5, text: "How many employees, contractors, and/or suppliers are off-boarded per month?", inputType: "number", defaultValue: 0 },
                { id: 6, text: "How many people are involved when a user is off-boarded?", inputType: "number", defaultValue: 0 },
                { id: 7, text: "What is the average fully burdened hourly labor rate for staff involved in offboarding?", inputType: "number", defaultValue: 50 },
                { id: 8, text: "How many hours does it take to off-board a user?", inputType: "number", defaultValue: 0 },
                { id: 9, text: "How many duplicate user accounts are researched and removed per month?", inputType: "number", defaultValue: 0 },
                { id: 10, text: "How many staff members are involved in researching and removing duplicates?", inputType: "number", defaultValue: 0 },
                { id: 11, text: "What is the average hourly labor rate for duplicate resolution staff?", inputType: "number", defaultValue: 50 },
                { id: 12, text: "How many hours does it take to research and remove a duplicate account?", inputType: "number", defaultValue: 0 },
                { id: 13, text: "What is the average amount of time (hours) a new user cannot perform their job due to access delays?", inputType: "number", defaultValue: 0 },
                { id: 14, text: "How many new users per month experience access delays?", inputType: "number", defaultValue: 0 },
                { id: 15, text: "What is the average fully burdened hourly labor rate per employee?", inputType: "number", defaultValue: 50 },
                { id: 16, text: "How many manual access certification campaigns are conducted per month?", inputType: "number", defaultValue: 0 },
                { id: 17, text: "How many reviewers participate in each campaign?", inputType: "number", defaultValue: 0 },
                { id: 18, text: "What is the average hourly labor rate for reviewers?", inputType: "number", defaultValue: 75 },
                { id: 19, text: "How many hours does each reviewer spend per campaign?", inputType: "number", defaultValue: 0 },
                { id: 20, text: "How many password resets are processed per month?", inputType: "number", defaultValue: 0 },
                { id: 21, text: "What is the service desk hourly labor rate?", inputType: "number", defaultValue: 40 },
                { id: 22, text: "How many minutes does each password reset take?", inputType: "number", defaultValue: 0 }
            ];

            config.mappings = [
                { useCaseId: 1, questionId: 1, variableName: "numUsers" },
                { useCaseId: 1, questionId: 2, variableName: "staffCount" },
                { useCaseId: 1, questionId: 3, variableName: "laborRate" },
                { useCaseId: 1, questionId: 4, variableName: "hours" },
                { useCaseId: 2, questionId: 5, variableName: "numUsers" },
                { useCaseId: 2, questionId: 6, variableName: "staffCount" },
                { useCaseId: 2, questionId: 7, variableName: "laborRate" },
                { useCaseId: 2, questionId: 8, variableName: "hours" },
                { useCaseId: 3, questionId: 9, variableName: "numDuplicates" },
                { useCaseId: 3, questionId: 10, variableName: "staffCount" },
                { useCaseId: 3, questionId: 11, variableName: "laborRate" },
                { useCaseId: 3, questionId: 12, variableName: "hours" },
                { useCaseId: 4, questionId: 13, variableName: "delayHours" },
                { useCaseId: 4, questionId: 14, variableName: "numUsers" },
                { useCaseId: 4, questionId: 15, variableName: "laborRate" },
                { useCaseId: 5, questionId: 16, variableName: "numCampaigns" },
                { useCaseId: 5, questionId: 17, variableName: "reviewers" },
                { useCaseId: 5, questionId: 18, variableName: "laborRate" },
                { useCaseId: 5, questionId: 19, variableName: "hoursPerReview" },
                { useCaseId: 6, questionId: 20, variableName: "numResets" },
                { useCaseId: 6, questionId: 21, variableName: "laborRate" },
                { useCaseId: 6, questionId: 22, variableName: "timePerReset" }
            ];

            saveConfigToStorage();
        }

        // Storage Functions
        function saveConfigToStorage() {
            localStorage.setItem('idmworks-tco-config-v4', JSON.stringify(config));
        }

        function loadConfigFromStorage() {
            const stored = localStorage.getItem('idmworks-tco-config-v4');
            if (stored) {
                config = JSON.parse(stored);
            }
        }

        // Mode Switching
        function switchMode(mode) {
            document.querySelectorAll('.mode-btn').forEach(btn => btn.classList.remove('active'));
            
            if (mode === 'calculate') {
                document.querySelector('.mode-btn:first-child').classList.add('active');
                document.getElementById('calculatePanel').classList.remove('hidden');
                document.getElementById('configurePanel').classList.add('hidden');
            } else {
                document.querySelector('.mode-btn:last-child').classList.add('active');
                document.getElementById('calculatePanel').classList.add('hidden');
                document.getElementById('configurePanel').classList.remove('hidden');
                renderConfigPanel();
            }
        }

        // Calculate Flow
        // Calculate Flow - Step 1: Select Domains
        function startCalculator() {
            document.getElementById('welcome-screen').classList.add('hidden');
            document.getElementById('calculator-container').classList.remove('hidden');
            renderDomains();
            
            // Set default vertical selection
            selectedVertical = 'universal';
            document.querySelectorAll('.vertical-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            document.querySelector('.vertical-btn').classList.add('selected');
            
            updateProgressBar(25);
        }

        function backToWelcome() {
            document.getElementById('calculator-container').classList.add('hidden');
            document.getElementById('welcome-screen').classList.remove('hidden');
            selectedDomains.clear();
            selectedUseCases.clear();
            selectedVertical = 'universal';
            updateProgressBar(0);
        }

        function renderDomains() {
            const grid = document.getElementById('domains-grid');
            grid.innerHTML = '';

            config.domains.forEach(domain => {
                const card = document.createElement('div');
                card.className = `domain-card ${selectedDomains.has(domain.id) ? 'selected' : ''}`;
                card.onclick = () => toggleDomain(domain.id);
                card.innerHTML = `
                    <div class="domain-icon">${domain.icon}</div>
                    <div class="domain-title">${domain.name}</div>
                    <div class="domain-description">${domain.description}</div>
                `;
                grid.appendChild(card);
            });

            updateSelectedDomainsCount();
        }

        function toggleDomain(id) {
            if (selectedDomains.has(id)) {
                selectedDomains.delete(id);
                // Remove all use cases from this domain
                const domainUseCases = config.useCases.filter(uc => uc.domainId === id);
                domainUseCases.forEach(uc => selectedUseCases.delete(uc.id));
            } else {
                selectedDomains.add(id);
            }
            renderDomains();
        }

        function updateSelectedDomainsCount() {
            const count = selectedDomains.size;
            document.getElementById('selected-domains-count').textContent = `${count} domain${count !== 1 ? 's' : ''} selected`;
            document.getElementById('next-btn-step1').disabled = count === 0;
        }

        // Vertical Selection
        function selectVertical(vertical) {
            selectedVertical = vertical;
            
            // Update button states
            document.querySelectorAll('.vertical-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            event.target.classList.add('selected');
            
            // If we're already on step 2, re-render use cases with new filter
            if (!document.getElementById('step-2').classList.contains('hidden')) {
                renderUseCasesByDomain();
            }
        }

        function formatVerticalName(vertical) {
            const names = {
                'universal': 'Universal',
                'healthcare': 'Healthcare',
                'higher-education': 'Higher Ed',
                'finance-insurance': 'Finance',
                'manufacturing': 'Manufacturing'
            };
            return names[vertical] || vertical;
        }

        // Step 2: Select Use Cases (grouped by domain)
        function goToStep2() {
            document.getElementById('step-1').classList.add('hidden');
            document.getElementById('step-2').classList.remove('hidden');
            renderUseCasesByDomain();
            updateProgressBar(50);
        }

        function backToStep1() {
            document.getElementById('step-2').classList.add('hidden');
            document.getElementById('step-1').classList.remove('hidden');
            updateProgressBar(25);
        }

        function renderUseCasesByDomain() {
            const container = document.getElementById('use-cases-by-domain');
            container.innerHTML = '';

            selectedDomains.forEach(domainId => {
                const domain = config.domains.find(d => d.id === domainId);
                // Filter use cases by domain AND vertical (default to 'universal' if not set)
                const domainUseCases = config.useCases.filter(uc => {
                    const matchesDomain = uc.domainId === domainId;
                    const useCaseVertical = uc.vertical || 'universal';
                    const matchesVertical = useCaseVertical === 'universal' || useCaseVertical === selectedVertical;
                    return matchesDomain && matchesVertical;
                });

                if (domainUseCases.length === 0) return;

                const section = document.createElement('div');
                section.className = 'domain-section';
                section.innerHTML = `<h3 class="domain-section-title">${domain.icon} ${domain.name}</h3>`;

                const grid = document.createElement('div');
                grid.className = 'use-cases-grid';

                domainUseCases.forEach(useCase => {
                    const card = document.createElement('div');
                    card.className = `use-case-card ${selectedUseCases.has(useCase.id) ? 'selected' : ''}`;
                    card.onclick = () => toggleUseCase(useCase.id);
                    
                    // Add a badge for vertical-specific use cases
                    const useCaseVertical = useCase.vertical || 'universal';
                    const verticalBadge = useCaseVertical !== 'universal' 
                        ? `<span style="display: inline-block; background: var(--accent-color); color: white; padding: 3px 8px; border-radius: 4px; font-size: 0.75rem; margin-left: 8px;">${formatVerticalName(useCaseVertical)}</span>`
                        : '';
                    
                    card.innerHTML = `
                        <div class="use-case-title">${useCase.name}${verticalBadge}</div>
                        <div class="use-case-category">${useCase.category}</div>
                    `;
                    grid.appendChild(card);
                });

                section.appendChild(grid);
                container.appendChild(section);
            });

            updateSelectedUseCasesCount();
        }

        function toggleUseCase(id) {
            if (selectedUseCases.has(id)) {
                selectedUseCases.delete(id);
            } else {
                selectedUseCases.add(id);
            }
            renderUseCasesByDomain();
        }

        function updateSelectedUseCasesCount() {
            const count = selectedUseCases.size;
            document.getElementById('selected-usecases-count').textContent = `${count} use case${count !== 1 ? 's' : ''} selected`;
            document.getElementById('next-btn-step2').disabled = count === 0;
        }

        // Step 3: Answer Questions (grouped by domain)
        function goToStep3() {
            document.getElementById('step-2').classList.add('hidden');
            document.getElementById('step-3').classList.remove('hidden');
            renderQuestions();
            updateProgressBar(75);
        }

        function backToStep2() {
            document.getElementById('step-3').classList.add('hidden');
            document.getElementById('step-2').classList.remove('hidden');
            updateProgressBar(50);
        }

        function renderQuestions() {
            const container = document.getElementById('questions-container');
            container.innerHTML = '';

            // Group by domain for better organization
            selectedDomains.forEach(domainId => {
                const domain = config.domains.find(d => d.id === domainId);
                const domainUseCases = Array.from(selectedUseCases).filter(ucId => {
                    const uc = config.useCases.find(u => u.id === ucId);
                    return uc && uc.domainId === domainId;
                });

                if (domainUseCases.length === 0) return;

                // Create a card wrapper for the domain
                const domainCard = document.createElement('div');
                domainCard.className = 'card';
                domainCard.style.marginBottom = '20px';

                const domainSection = document.createElement('div');
                domainSection.className = 'question-section';
                domainSection.innerHTML = `<h3 class="section-title">${domain.icon} ${domain.name}</h3>`;

                domainUseCases.forEach(useCaseId => {
                    const useCase = config.useCases.find(uc => uc.id === useCaseId);
                    const mappings = config.mappings.filter(m => m.useCaseId === useCaseId);

                    if (mappings.length === 0) return;

                    const useCaseTitle = document.createElement('div');
                    useCaseTitle.className = 'subsection-title';
                    useCaseTitle.textContent = useCase.name;
                    domainSection.appendChild(useCaseTitle);

                    mappings.forEach(mapping => {
                        const question = config.questions.find(q => q.id === mapping.questionId);
                        if (question) {
                            const group = document.createElement('div');
                            group.className = 'input-group';

                            const savedValue = userResponses[`${useCaseId}-${question.id}`];
                            const displayValue = savedValue !== undefined ? savedValue : '';

                            group.innerHTML = `
                                <label class="input-label">${question.text}</label>
                                <input 
                                    type="${question.inputType}" 
                                    class="input-field"
                                    value="${displayValue}"
                                    placeholder="${question.defaultValue}"
                                    ${question.inputType === 'number' ? 'min="0"' : ''}
                                    onchange="saveResponse(${useCaseId}, ${question.id}, this.value)"
                                >
                            `;
                            domainSection.appendChild(group);
                        }
                    });
                });

                domainCard.appendChild(domainSection);
                container.appendChild(domainCard);
            });

            // Add annual license cost in its own card
            const licenseCard = document.createElement('div');
            licenseCard.className = 'card';
            licenseCard.style.marginBottom = '20px';
            
            const licenseSection = document.createElement('div');
            licenseSection.className = 'question-section';
            licenseSection.innerHTML = `
                <h3 class="section-title">üí∞ Annual License Costs</h3>
                <div class="input-group">
                    <label class="input-label">What is your current annual license cost across all selected domains? (Optional)</label>
                    <input 
                        type="number" 
                        class="input-field"
                        value="${annualLicenseCost || ''}"
                        placeholder="$ (Optional)"
                        min="0"
                        onchange="annualLicenseCost = parseFloat(this.value) || 0"
                    >
                    <small>Enter your current annual license fees (leave blank if not applicable)</small>
                </div>
            `;
            licenseCard.appendChild(licenseSection);
            container.appendChild(licenseCard);
        }

        function saveResponse(useCaseId, questionId, value) {
            const numValue = parseFloat(value);
            // Ensure no negative values are saved
            userResponses[`${useCaseId}-${questionId}`] = isNaN(numValue) ? 0 : Math.max(0, numValue);
        }

        function calculateTCO() {
            document.getElementById('step-3').classList.add('hidden');
            document.getElementById('processing-screen').style.display = 'flex';
            updateProgressBar(100);

            setTimeout(() => {
                let totalMonthlyCost = 0;
                const domainBreakdowns = {};

                // Initialize domain breakdowns
                selectedDomains.forEach(domainId => {
                    const domain = config.domains.find(d => d.id === domainId);
                    domainBreakdowns[domainId] = {
                        name: domain.name,
                        icon: domain.icon,
                        total: 0,
                        useCases: []
                    };
                });

                // Calculate costs
                selectedUseCases.forEach(useCaseId => {
                    const useCase = config.useCases.find(uc => uc.id === useCaseId);
                    const mappings = config.mappings.filter(m => m.useCaseId === useCaseId);

                    const variables = {};
                    const inputs = []; // Store question-value pairs for display
                    
                    mappings.forEach(mapping => {
                        const value = userResponses[`${useCaseId}-${mapping.questionId}`] || 0;
                        const question = config.questions.find(q => q.id === mapping.questionId);
                        variables[mapping.variableName] = value;
                        
                        // Store for display
                        inputs.push({
                            question: question.text,
                            value: value,
                            variableName: mapping.variableName
                        });
                    });

                    // Convert minutes to hours if needed
                    if (variables.timePerReset !== undefined) {
                        variables.timePerReset = variables.timePerReset / 60;
                    }

                    try {
                        let formulaWithValues = useCase.formula;
                        const sortedVarNames = Object.keys(variables).sort((a, b) => b.length - a.length);
                        
                        sortedVarNames.forEach(varName => {
                            const regex = new RegExp('\\b' + varName + '\\b', 'g');
                            formulaWithValues = formulaWithValues.replace(regex, variables[varName]);
                        });

                        const cost = eval(formulaWithValues) || 0;
                        totalMonthlyCost += cost;
                        
                        domainBreakdowns[useCase.domainId].total += cost;
                        domainBreakdowns[useCase.domainId].useCases.push({
                            name: useCase.name,
                            cost: cost,
                            formula: useCase.formula,
                            inputs: inputs
                        });
                    } catch (e) {
                        console.error('Error calculating', useCase.name, e);
                    }
                });

                displayResults(totalMonthlyCost, domainBreakdowns);
                
                document.getElementById('processing-screen').style.display = 'none';
                document.getElementById('results-screen').classList.remove('hidden');
            }, 1500);
        }

        function displayResults(monthlyTotal, domainBreakdowns) {
            const annualTotal = (monthlyTotal * 12) + annualLicenseCost;
            const threeYearTotal = annualTotal * 3;
            const fiveYearTotal = annualTotal * 5;

            document.getElementById('monthly-total').textContent = formatCurrency(monthlyTotal);
            document.getElementById('annual-total').textContent = formatCurrency(annualTotal);
            document.getElementById('three-year-total').textContent = formatCurrency(threeYearTotal);
            document.getElementById('five-year-total').textContent = formatCurrency(fiveYearTotal);

            // Display annual license cost as subtext under Annual TCO if it exists
            if (annualLicenseCost > 0) {
                document.getElementById('license-cost-inline').textContent = formatCurrency(annualLicenseCost);
                document.getElementById('license-cost-subtext').style.display = 'block';
            } else {
                document.getElementById('license-cost-subtext').style.display = 'none';
            }

            const container = document.getElementById('breakdown-container');
            container.innerHTML = '';

            Object.values(domainBreakdowns).forEach(domain => {
                if (domain.useCases.length === 0) return;

                const section = document.createElement('div');
                section.className = 'domain-breakdown';
                
                let useCasesHTML = domain.useCases.map(uc => {
                    // Format inputs
                    let inputsHTML = '';
                    if (uc.inputs && uc.inputs.length > 0) {
                        inputsHTML = '<div style="margin-top: 10px; padding: 12px; background: #f9f9f9; border-radius: 8px; font-size: 0.85rem;">';
                        uc.inputs.forEach(input => {
                            inputsHTML += `<div style="margin-bottom: 4px; color: var(--text-color);">‚Ä¢ ${input.question}: <strong>${input.value}</strong></div>`;
                        });
                        inputsHTML += '</div>';
                    }
                    
                    return `
                        <div class="list-item" style="margin-bottom: 10px; flex-direction: column; align-items: flex-start;">
                            <div style="width: 100%; display: flex; justify-content: space-between; align-items: center; margin-bottom: ${uc.inputs && uc.inputs.length > 0 ? '0' : '0'};">
                                <div class="list-item-content">
                                    <div class="list-item-title">${uc.name}</div>
                                </div>
                                <div style="font-size: 1.2rem; font-weight: 600; color: var(--primary-color);">
                                    ${formatCurrency(uc.cost)}/month
                                </div>
                            </div>
                            ${inputsHTML}
                        </div>
                    `;
                }).join('');

                section.innerHTML = `
                    <div class="domain-breakdown-title">${domain.icon} ${domain.name}</div>
                    <div class="domain-breakdown-total">Total: ${formatCurrency(domain.total)}/month</div>
                    ${useCasesHTML}
                `;
                
                container.appendChild(section);
            });
        }

        function formatCurrency(value) {
            return new Intl.NumberFormat('en-US', {
                style: 'currency',
                currency: 'USD',
                minimumFractionDigits: 0,
                maximumFractionDigits: 0
            }).format(value);
        }

        function updateProgressBar(percent) {
            document.getElementById('progress-bar').style.width = percent + '%';
        }

        function editResponses() {
            document.getElementById('results-screen').classList.add('hidden');
            document.getElementById('step-3').classList.remove('hidden');
            updateProgressBar(75);
        }

        function startOver() {
            selectedDomains.clear();
            selectedUseCases.clear();
            userResponses = {};
            annualLicenseCost = 0;
            document.getElementById('results-screen').classList.add('hidden');
            document.getElementById('calculator-container').classList.add('hidden');
            document.getElementById('welcome-screen').classList.remove('hidden');
            updateProgressBar(0);
        }

        function exportResults() {
            // Get values
            const monthlyTotal = document.getElementById('monthly-total').textContent;
            const annualTotal = document.getElementById('annual-total').textContent;
            const threeYearTotal = document.getElementById('three-year-total').textContent;
            const fiveYearTotal = document.getElementById('five-year-total').textContent;
            const showLicenseCost = annualLicenseCost > 0;
            const licenseCost = showLicenseCost ? formatCurrency(annualLicenseCost) : '';

            // Get logo
            const logoImg = document.getElementById('logo-img');
            const logoSrc = logoImg ? logoImg.src : '';

            // Build breakdown HTML by domain
            const breakdownContainer = document.getElementById('breakdown-container');
            const domainSections = breakdownContainer.querySelectorAll('.domain-breakdown');
            
            let breakdownHTML = '';
            domainSections.forEach((section) => {
                const domainTitle = section.querySelector('.domain-breakdown-title');
                const domainTotal = section.querySelector('.domain-breakdown-total');
                
                if (domainTitle) {
                    breakdownHTML += `<tr style="background: #f5f5f4;"><td colspan="2" style="padding: 15px; font-weight: 700; color: #A72DBE; font-size: 16px;">${domainTitle.textContent}</td></tr>`;
                    if (domainTotal) {
                        breakdownHTML += `<tr style="background: #f5f5f4;"><td colspan="2" style="padding: 0 15px 15px 15px; font-weight: 600; color: #241F55;">${domainTotal.textContent}</td></tr>`;
                    }
                }
                
                const items = section.querySelectorAll('.list-item');
                items.forEach((item, index) => {
                    const nameEl = item.querySelector('.list-item-title');
                    const costDiv = item.querySelector('div[style*="font-size: 1.2rem"]');
                    
                    if (nameEl && costDiv) {
                        const name = nameEl.textContent;
                        const cost = costDiv.textContent;
                        
                        breakdownHTML += `<tr><td style="padding: 12px 12px 8px 30px; border-bottom: 1px solid #e7e5e4; color: #444;">${name}</td>
                            <td style="padding: 12px 12px 8px 12px; border-bottom: 1px solid #e7e5e4; text-align: right; font-weight: 600; color: #241F55;">${cost}</td></tr>`;
                        
                        // Add input details if they exist
                        const inputsDiv = item.querySelector('div[style*="background: #f9f9f9"]');
                        if (inputsDiv) {
                            const inputs = inputsDiv.querySelectorAll('div[style*="margin-bottom: 4px"]');
                            if (inputs.length > 0) {
                                let inputsHTML = '<div style="font-size: 12px; color: #666; padding: 0 0 8px 0;">';
                                inputs.forEach(input => {
                                    inputsHTML += `<div style="margin-bottom: 3px;">${input.textContent}</div>`;
                                });
                                inputsHTML += '</div>';
                                breakdownHTML += `<tr><td colspan="2" style="padding: 0 12px 12px 40px; border-bottom: 1px solid #e7e5e4;">${inputsHTML}</td></tr>`;
                            }
                        }
                    }
                });
            });

            const reportHTML = `
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>IDMWorks TCO Assessment Report</title>
    <style>
        @media print { 
            body { margin: 0; } 
            .no-print { display: none; }
            @page { margin: 20mm; }
        }
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            line-height: 1.6; 
            color: #444; 
            max-width: 800px; 
            margin: 0 auto; 
            padding: 40px 20px; 
        }
        .header { 
            background: linear-gradient(135deg, #241F55 0%, #A72DBE 100%); 
            color: white; 
            padding: 40px; 
            margin: -40px -20px 40px -20px; 
            text-align: center; 
        }
        .header img {
            max-width: 180px;
            margin-bottom: 15px;
        }
        .header h1 { 
            margin: 0 0 10px 0; 
            font-size: 32px; 
            font-weight: 700; 
        }
        .header p { 
            margin: 0; 
            font-size: 14px; 
            opacity: 0.9; 
            text-transform: uppercase; 
            letter-spacing: 2px; 
        }
        .summary { 
            background: #f5f5f4; 
            border-left: 4px solid #00C2EF; 
            padding: 30px; 
            margin: 30px 0; 
        }
        .summary h2 { 
            margin: 0 0 20px 0; 
            color: #A72DBE; 
            font-size: 24px; 
        }
        .summary-item { 
            display: flex; 
            justify-content: space-between; 
            padding: 15px 0; 
            border-bottom: 1px solid #d6d3d1; 
        }
        .summary-item:last-child {
            border-bottom: none;
        }
        .summary-label { 
            font-weight: 500; 
            color: #6C6A6F; 
        }
        .summary-value { 
            font-size: 24px; 
            font-weight: 700; 
            color: #241F55; 
        }
        table { 
            width: 100%; 
            border-collapse: collapse; 
            background: white; 
            box-shadow: 0 2px 8px rgba(0,0,0,0.1); 
        }
        th { 
            background: #241F55; 
            color: white; 
            padding: 15px; 
            text-align: left; 
            font-weight: 600; 
            text-transform: uppercase; 
            font-size: 12px; 
        }
        .footer { 
            margin-top: 60px; 
            padding-top: 20px; 
            border-top: 2px solid #00C2EF; 
            text-align: center; 
            color: #78716c; 
            font-size: 14px; 
        }
        .print-button { 
            background: #241F55; 
            color: white; 
            border: none; 
            padding: 12px 30px; 
            font-size: 16px; 
            border-radius: 6px; 
            cursor: pointer; 
            margin: 20px 0; 
        }
        .print-button:hover { 
            background: #A72DBE; 
        }
    </style>
</head>
<body>
    <div class="header">
        ${logoSrc ? `<img src="${logoSrc}" alt="IDMWorks">` : ''}
        <h1>Total Cost of Ownership Assessment</h1>
        <p>IDMWorks Advisory Report</p>
    </div>
    <button class="print-button no-print" onclick="window.print()">Print / Save as PDF</button>
    <div class="summary">
        <h2>Cost Summary</h2>
        <div class="summary-item">
            <span class="summary-label">Monthly Total Cost of Ownership:</span>
            <span class="summary-value">${monthlyTotal}</span>
        </div>
        ${showLicenseCost ? `
        <div class="summary-item">
            <span class="summary-label">Annual License Costs:</span>
            <span class="summary-value">${licenseCost}</span>
        </div>` : ''}
        <div class="summary-item">
            <span class="summary-label">Annual TCO:</span>
            <span class="summary-value">${annualTotal}</span>
        </div>
        <div class="summary-item">
            <span class="summary-label">3-Year TCO Investment:</span>
            <span class="summary-value">${threeYearTotal}</span>
        </div>
        <div class="summary-item">
            <span class="summary-label">5-Year TCO Investment:</span>
            <span class="summary-value">${fiveYearTotal}</span>
        </div>
    </div>
    <div style="margin: 40px 0;">
        <h2 style="color: #A72DBE; font-size: 24px; margin-bottom: 20px;">Cost Breakdown by Domain</h2>
        <table>
            <thead>
                <tr>
                    <th>Use Case</th>
                    <th style="text-align: right;">Monthly Cost</th>
                </tr>
            </thead>
            <tbody>
                ${breakdownHTML}
            </tbody>
        </table>
    </div>
    <div class="footer">
        <p>Generated by IDMWorks TCO Calculator on ${new Date().toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}</p>
    </div>
</body>
</html>
            `;

            const reportWindow = window.open('', '_blank');
            reportWindow.document.write(reportHTML);
            reportWindow.document.close();
        }

        // Configure Panel Functions
        // Config Panel Functions
        function renderConfigPanel() {
            renderDomainManagement();
            renderQuestionLibrary();
        }

        function renderDomainManagement() {
            const container = document.getElementById('domain-management');
            container.innerHTML = '';

            if (config.domains.length === 0) {
                container.innerHTML = '<div class="empty-state"><div class="empty-state-icon">üîê</div><div class="empty-state-text">No domains yet</div><p>Click "+ Add Domain" to get started.</p></div>';
                return;
            }

            config.domains.forEach(domain => {
                const domainUseCases = config.useCases.filter(uc => uc.domainId === domain.id);

                const section = document.createElement('div');
                section.className = 'domain-config-section';

                // Group use cases by vertical
                const verticals = ['universal', 'healthcare', 'higher-education', 'finance-insurance', 'manufacturing'];
                const verticalLabels = {
                    'universal': 'Universal Use Cases',
                    'healthcare': 'Healthcare',
                    'higher-education': 'Higher Education',
                    'finance-insurance': 'Finance | Insurance',
                    'manufacturing': 'Manufacturing'
                };

                let verticalTabsHTML = '<div class="vertical-tabs-container"><div class="vertical-tabs">';
                verticals.forEach((vertical, index) => {
                    const count = domainUseCases.filter(uc => (uc.vertical || 'universal') === vertical).length;
                    verticalTabsHTML += `
                        <button class="vertical-tab ${index === 0 ? 'active' : ''}" 
                                onclick="switchVerticalTab(event, 'domain-${domain.id}-${vertical}')">
                            ${verticalLabels[vertical]} ${count > 0 ? `(${count})` : ''}
                        </button>
                    `;
                });
                verticalTabsHTML += '</div>';

                // Create content for each vertical
                verticals.forEach((vertical, index) => {
                    const verticalUseCases = domainUseCases.filter(uc => (uc.vertical || 'universal') === vertical);
                    
                    verticalTabsHTML += `<div class="vertical-tab-content ${index === 0 ? 'active' : ''}" id="domain-${domain.id}-${vertical}">`;
                    
                    if (verticalUseCases.length === 0) {
                        verticalTabsHTML += `
                            <div class="add-question-prompt">
                                <p>No ${vertical === 'universal' ? 'universal' : verticalLabels[vertical]} use cases yet.</p>
                                <button class="btn btn-outline" onclick="showAddUseCaseForm(${domain.id}, '${vertical}')">+ Add Use Case</button>
                            </div>
                        `;
                    } else {
                        verticalUseCases.forEach(useCase => {
                            const mappings = config.mappings.filter(m => m.useCaseId === useCase.id);
                            
                            let questionsHTML = '';
                            if (mappings.length === 0) {
                                questionsHTML = `
                                    <div class="add-question-prompt">
                                        <p>No questions assigned yet.</p>
                                        <button class="btn btn-outline" onclick="showAddQuestionToUseCase(${useCase.id})">+ Add Question</button>
                                    </div>
                                `;
                            } else {
                                questionsHTML = '<div class="nested-questions">';
                                mappings.forEach(mapping => {
                                    const question = config.questions.find(q => q.id === mapping.questionId);
                                    if (question) {
                                        questionsHTML += `
                                            <div class="nested-question-item">
                                                <div class="nested-question-content">
                                                    <div class="nested-question-text">${question.text}</div>
                                                    <div class="nested-question-meta">Variable: <strong>${mapping.variableName}</strong> | Type: ${question.inputType} | Default: ${question.defaultValue}</div>
                                                </div>
                                                <div class="nested-question-actions">
                                                    <button class="btn btn-outline" onclick="editQuestionMapping(${useCase.id}, ${mapping.questionId})">Edit</button>
                                                    <button class="btn btn-danger" onclick="deleteMapping(${useCase.id}, ${mapping.questionId})">Remove</button>
                                                </div>
                                            </div>
                                        `;
                                    }
                                });
                                questionsHTML += `<button class="btn btn-outline" onclick="showAddQuestionToUseCase(${useCase.id})" style="margin-top: 10px;">+ Add Another Question</button></div>`;
                            }

                            const useCaseVertical = useCase.vertical || 'universal';
                            const verticalBadge = useCaseVertical !== 'universal' 
                                ? `<span class="vertical-badge-config">${formatVerticalName(useCaseVertical)}</span>`
                                : '';

                            verticalTabsHTML += `
                                <div class="use-case-section">
                                    <div class="use-case-section-header">
                                        <div class="use-case-section-info">
                                            <div class="use-case-section-title">${useCase.name}${verticalBadge}</div>
                                            <div class="use-case-section-meta">Category: ${useCase.category}</div>
                                            <div class="use-case-formula">Formula: ${useCase.formula}</div>
                                        </div>
                                        <div class="use-case-section-actions">
                                            <button class="btn btn-outline" onclick="editUseCase(${useCase.id})">Edit</button>
                                            <button class="btn btn-danger" onclick="deleteUseCase(${useCase.id})">Delete</button>
                                        </div>
                                    </div>
                                    ${questionsHTML}
                                </div>
                            `;
                        });
                        verticalTabsHTML += `<button class="btn btn-outline" onclick="showAddUseCaseForm(${domain.id}, '${vertical}')" style="margin-top: 10px;">+ Add Another Use Case</button>`;
                    }
                    
                    verticalTabsHTML += '</div>';
                });

                verticalTabsHTML += '</div>';

                section.innerHTML = `
                    <div class="domain-config-header">
                        <div class="domain-config-title">${domain.icon} ${domain.name}</div>
                        <div style="display: flex; gap: 10px;">
                            <button class="btn btn-outline" onclick="editDomain(${domain.id})">Edit Domain</button>
                            <button class="btn btn-danger" onclick="deleteDomain(${domain.id})">Delete Domain</button>
                        </div>
                    </div>
                    ${verticalTabsHTML}
                `;

                container.appendChild(section);
            });
        }

        function renderQuestionLibrary() {
            const container = document.getElementById('question-library');
            container.innerHTML = '';

            if (config.questions.length === 0) {
                container.innerHTML = '<div class="empty-state"><div class="empty-state-icon">‚ùì</div><div class="empty-state-text">No questions yet</div></div>';
                return;
            }

            config.questions.forEach(question => {
                const usageCount = config.mappings.filter(m => m.questionId === question.id).length;
                const div = document.createElement('div');
                div.className = 'list-item';
                div.innerHTML = `
                    <div class="list-item-content">
                        <div class="list-item-title">${question.text}</div>
                        <div class="list-item-meta">Type: ${question.inputType} | Default: ${question.defaultValue} | Used in ${usageCount} use case${usageCount !== 1 ? 's' : ''}</div>
                    </div>
                    <div class="list-item-actions">
                        <button class="btn btn-outline" onclick="editQuestion(${question.id})">Edit</button>
                        <button class="btn btn-danger" onclick="deleteQuestion(${question.id})">Delete</button>
                    </div>
                `;
                container.appendChild(div);
            });
        }

        function switchVerticalTab(event, tabId) {
            // Get the parent container (domain section)
            const container = event.target.closest('.domain-config-section');
            
            // Update tab buttons
            container.querySelectorAll('.vertical-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Update tab content
            container.querySelectorAll('.vertical-tab-content').forEach(content => {
                content.classList.remove('active');
            });
            container.querySelector(`#${tabId}`).classList.add('active');
        }

        // Modal Functions
        // Modal Functions - Domain Management
        function showAddDomainForm() {
            document.getElementById('modal-body').innerHTML = `
                <h2 class="modal-title">Add Domain</h2>
                <form onsubmit="saveDomain(event)">
                    <div class="form-group">
                        <label>Domain Name</label>
                        <input type="text" name="name" placeholder="e.g., IGA, CIAM, PAM" required>
                    </div>
                    <div class="form-group">
                        <label>Icon (Emoji)</label>
                        <input type="text" name="icon" placeholder="e.g., üîê" required maxlength="2">
                    </div>
                    <div class="form-group">
                        <label>Description</label>
                        <input type="text" name="description" placeholder="e.g., Identity Governance & Administration" required>
                    </div>
                    <div class="btn-group">
                        <button type="submit" class="btn btn-primary">Save Domain</button>
                        <button type="button" class="btn btn-outline" onclick="closeModal()">Cancel</button>
                    </div>
                </form>
            `;
            document.getElementById('modal-overlay').style.display = 'flex';
        }

        function saveDomain(event) {
            event.preventDefault();
            const formData = new FormData(event.target);
            const newId = config.domains.length > 0 ? Math.max(...config.domains.map(d => d.id)) + 1 : 1;

            config.domains.push({
                id: newId,
                name: formData.get('name'),
                icon: formData.get('icon'),
                description: formData.get('description')
            });

            saveConfigToStorage();
            closeModalDirect();
            renderConfigPanel();
        }

        function editDomain(id) {
            const domain = config.domains.find(d => d.id === id);
            document.getElementById('modal-body').innerHTML = `
                <h2 class="modal-title">Edit Domain</h2>
                <form onsubmit="updateDomain(event, ${id})">
                    <div class="form-group">
                        <label>Domain Name</label>
                        <input type="text" name="name" value="${domain.name}" required>
                    </div>
                    <div class="form-group">
                        <label>Icon (Emoji)</label>
                        <input type="text" name="icon" value="${domain.icon}" required maxlength="2">
                    </div>
                    <div class="form-group">
                        <label>Description</label>
                        <input type="text" name="description" value="${domain.description}" required>
                    </div>
                    <div class="btn-group">
                        <button type="submit" class="btn btn-primary">Update</button>
                        <button type="button" class="btn btn-outline" onclick="closeModal()">Cancel</button>
                    </div>
                </form>
            `;
            document.getElementById('modal-overlay').style.display = 'flex';
        }

        function updateDomain(event, id) {
            event.preventDefault();
            const formData = new FormData(event.target);
            const domain = config.domains.find(d => d.id === id);
            
            domain.name = formData.get('name');
            domain.icon = formData.get('icon');
            domain.description = formData.get('description');

            saveConfigToStorage();
            closeModalDirect();
            renderConfigPanel();
        }

        function deleteDomain(id) {
            if (!confirm('Delete this domain and all its use cases?')) return;
            config.domains = config.domains.filter(d => d.id !== id);
            config.useCases = config.useCases.filter(uc => uc.domainId !== id);
            // Also clean up orphaned mappings
            const remainingUseCaseIds = config.useCases.map(uc => uc.id);
            config.mappings = config.mappings.filter(m => remainingUseCaseIds.includes(m.useCaseId));
            saveConfigToStorage();
            renderConfigPanel();
        }

        // Use Case Management
        function showAddUseCaseForm(domainId, defaultVertical = 'universal') {
            const domain = config.domains.find(d => d.id === domainId);
            document.getElementById('modal-body').innerHTML = `
                <h2 class="modal-title">Add Use Case to ${domain.name}</h2>
                <form onsubmit="saveUseCase(event)">
                    <input type="hidden" name="domainId" value="${domainId}">
                    <div class="form-group">
                        <label>Use Case Name</label>
                        <input type="text" name="name" required>
                    </div>
                    <div class="form-group">
                        <label>Category</label>
                        <input type="text" name="category" placeholder="e.g., Joiner/Mover/Leaver" required>
                    </div>
                    <div class="form-group">
                        <label>Industry Vertical</label>
                        <select name="vertical" required>
                            <option value="universal" ${defaultVertical === 'universal' ? 'selected' : ''}>Universal (All Industries)</option>
                            <option value="healthcare" ${defaultVertical === 'healthcare' ? 'selected' : ''}>Healthcare</option>
                            <option value="higher-education" ${defaultVertical === 'higher-education' ? 'selected' : ''}>Higher Education</option>
                            <option value="finance-insurance" ${defaultVertical === 'finance-insurance' ? 'selected' : ''}>Finance | Insurance</option>
                            <option value="manufacturing" ${defaultVertical === 'manufacturing' ? 'selected' : ''}>Manufacturing</option>
                        </select>
                        <small>Universal use cases appear for all industries; vertical-specific use cases only appear when that vertical is selected</small>
                    </div>
                    <div class="form-group">
                        <label>Formula</label>
                        <input type="text" name="formula" placeholder="e.g., numUsers * staffCount * laborRate * hours" required>
                        <small>Use variable names that you'll assign to questions</small>
                    </div>
                    <div class="btn-group">
                        <button type="submit" class="btn btn-primary">Save Use Case</button>
                        <button type="button" class="btn btn-outline" onclick="closeModal()">Cancel</button>
                    </div>
                </form>
            `;
            document.getElementById('modal-overlay').style.display = 'flex';
        }

        function saveUseCase(event) {
            event.preventDefault();
            console.log('saveUseCase called');
            const formData = new FormData(event.target);
            const domainId = parseInt(formData.get('domainId'));
            console.log('Domain ID:', domainId);
            const newId = config.useCases.length > 0 ? Math.max(...config.useCases.map(uc => uc.id)) + 1 : 1;

            const newUseCase = {
                id: newId,
                domainId: domainId,
                name: formData.get('name'),
                category: formData.get('category'),
                vertical: formData.get('vertical') || 'universal',
                formula: formData.get('formula')
            };
            
            console.log('New use case:', newUseCase);
            config.useCases.push(newUseCase);

            saveConfigToStorage();
            closeModalDirect();
            renderConfigPanel();
        }

        function editUseCase(id) {
            const useCase = config.useCases.find(uc => uc.id === id);
            const currentVertical = useCase.vertical || 'universal';
            document.getElementById('modal-body').innerHTML = `
                <h2 class="modal-title">Edit Use Case</h2>
                <form onsubmit="updateUseCase(event, ${id})">
                    <div class="form-group">
                        <label>Use Case Name</label>
                        <input type="text" name="name" value="${useCase.name}" required>
                    </div>
                    <div class="form-group">
                        <label>Category</label>
                        <input type="text" name="category" value="${useCase.category}" required>
                    </div>
                    <div class="form-group">
                        <label>Industry Vertical</label>
                        <select name="vertical" required>
                            <option value="universal" ${currentVertical === 'universal' ? 'selected' : ''}>Universal (All Industries)</option>
                            <option value="healthcare" ${currentVertical === 'healthcare' ? 'selected' : ''}>Healthcare</option>
                            <option value="higher-education" ${currentVertical === 'higher-education' ? 'selected' : ''}>Higher Education</option>
                            <option value="finance-insurance" ${currentVertical === 'finance-insurance' ? 'selected' : ''}>Finance | Insurance</option>
                            <option value="manufacturing" ${currentVertical === 'manufacturing' ? 'selected' : ''}>Manufacturing</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Formula</label>
                        <input type="text" name="formula" value="${useCase.formula}" required>
                    </div>
                    <div class="btn-group">
                        <button type="submit" class="btn btn-primary">Update</button>
                        <button type="button" class="btn btn-outline" onclick="closeModal()">Cancel</button>
                    </div>
                </form>
            `;
            document.getElementById('modal-overlay').style.display = 'flex';
        }

        function updateUseCase(event, id) {
            event.preventDefault();
            const formData = new FormData(event.target);
            const useCase = config.useCases.find(uc => uc.id === id);
            
            useCase.name = formData.get('name');
            useCase.category = formData.get('category');
            useCase.vertical = formData.get('vertical') || 'universal';
            useCase.formula = formData.get('formula');

            saveConfigToStorage();
            closeModalDirect();
            renderConfigPanel();
        }

        function deleteUseCase(id) {
            if (!confirm('Delete this use case and all its question mappings?')) return;
            config.useCases = config.useCases.filter(uc => uc.id !== id);
            config.mappings = config.mappings.filter(m => m.useCaseId !== id);
            saveConfigToStorage();
            renderConfigPanel();
        }

        function showAddQuestionForm() {
            document.getElementById('modal-body').innerHTML = `
                <h2 class="modal-title">Add Question</h2>
                <form onsubmit="saveQuestion(event)">
                    <div class="form-group">
                        <label>Question Text</label>
                        <textarea name="text" required></textarea>
                    </div>
                    <div class="form-group">
                        <label>Input Type</label>
                        <select name="inputType" required>
                            <option value="number">Number</option>
                            <option value="text">Text</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Default Value</label>
                        <input type="number" name="defaultValue" value="0" required>
                    </div>
                    <div class="btn-group">
                        <button type="submit" class="btn btn-primary">Save Question</button>
                        <button type="button" class="btn btn-outline" onclick="closeModal()">Cancel</button>
                    </div>
                </form>
            `;
            document.getElementById('modal-overlay').style.display = 'flex';
        }

        function saveQuestion(event) {
            event.preventDefault();
            const formData = new FormData(event.target);
            const newId = config.questions.length > 0 ? Math.max(...config.questions.map(q => q.id)) + 1 : 1;

            config.questions.push({
                id: newId,
                text: formData.get('text'),
                inputType: formData.get('inputType'),
                defaultValue: parseFloat(formData.get('defaultValue')) || 0
            });

            saveConfigToStorage();
            closeModalDirect();
            renderConfigPanel();
        }

        function editQuestion(id) {
            const question = config.questions.find(q => q.id === id);
            document.getElementById('modal-body').innerHTML = `
                <h2 class="modal-title">Edit Question</h2>
                <form onsubmit="updateQuestion(event, ${id})">
                    <div class="form-group">
                        <label>Question Text</label>
                        <textarea name="text" required>${question.text}</textarea>
                    </div>
                    <div class="form-group">
                        <label>Input Type</label>
                        <select name="inputType" required>
                            <option value="number" ${question.inputType === 'number' ? 'selected' : ''}>Number</option>
                            <option value="text" ${question.inputType === 'text' ? 'selected' : ''}>Text</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Default Value</label>
                        <input type="number" name="defaultValue" value="${question.defaultValue}" required>
                    </div>
                    <div class="btn-group">
                        <button type="submit" class="btn btn-primary">Update</button>
                        <button type="button" class="btn btn-outline" onclick="closeModal()">Cancel</button>
                    </div>
                </form>
            `;
            document.getElementById('modal-overlay').style.display = 'flex';
        }

        function updateQuestion(event, id) {
            event.preventDefault();
            const formData = new FormData(event.target);
            const question = config.questions.find(q => q.id === id);

            question.text = formData.get('text');
            question.inputType = formData.get('inputType');
            question.defaultValue = parseFloat(formData.get('defaultValue')) || 0;

            saveConfigToStorage();
            closeModalDirect();
            renderConfigPanel();
        }

        function deleteQuestion(id) {
            if (!confirm('Delete this question? It will be removed from all use cases.')) return;
            config.questions = config.questions.filter(q => q.id !== id);
            config.mappings = config.mappings.filter(m => m.questionId !== id);
            saveConfigToStorage();
            renderConfigPanel();
        }

        function showAddQuestionToUseCase(useCaseId) {
            const useCase = config.useCases.find(uc => uc.id === useCaseId);
            const availableQuestions = config.questions.filter(q =>
                !config.mappings.some(m => m.useCaseId === useCaseId && m.questionId === q.id)
            );

            if (availableQuestions.length === 0) {
                alert('All questions are already mapped. Create a new question first.');
                return;
            }

            document.getElementById('modal-body').innerHTML = `
                <h2 class="modal-title">Add Question to "${useCase.name}"</h2>
                <form onsubmit="saveMappingToUseCase(event, ${useCaseId})">
                    <div class="form-group">
                        <label>Select Question</label>
                        <select name="questionId" required>
                            <option value="">Choose a question...</option>
                            ${availableQuestions.map(q => `<option value="${q.id}">${q.text}</option>`).join('')}
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Variable Name</label>
                        <input type="text" name="variableName" placeholder="e.g., numUsers, staffCount" required>
                        <small>Formula: ${useCase.formula}</small>
                    </div>
                    <div class="btn-group">
                        <button type="submit" class="btn btn-primary">Add Question</button>
                        <button type="button" class="btn btn-outline" onclick="closeModal()">Cancel</button>
                    </div>
                </form>
            `;
            document.getElementById('modal-overlay').style.display = 'flex';
        }

        function saveMappingToUseCase(event, useCaseId) {
            event.preventDefault();
            const formData = new FormData(event.target);

            config.mappings.push({
                useCaseId: useCaseId,
                questionId: parseInt(formData.get('questionId')),
                variableName: formData.get('variableName')
            });

            saveConfigToStorage();
            closeModalDirect();
            renderConfigPanel();
        }

        function editQuestionMapping(useCaseId, questionId) {
            const mapping = config.mappings.find(m => m.useCaseId === useCaseId && m.questionId === questionId);
            const question = config.questions.find(q => q.id === questionId);
            const useCase = config.useCases.find(uc => uc.id === useCaseId);

            document.getElementById('modal-body').innerHTML = `
                <h2 class="modal-title">Edit Question Mapping</h2>
                <form onsubmit="updateQuestionMapping(event, ${useCaseId}, ${questionId})">
                    <div class="form-group">
                        <label>Question</label>
                        <div style="padding: 12px; background: #f5f5f5; border-radius: 8px;">${question.text}</div>
                    </div>
                    <div class="form-group">
                        <label>Variable Name</label>
                        <input type="text" name="variableName" value="${mapping.variableName}" required>
                        <small>Formula: ${useCase.formula}</small>
                    </div>
                    <div class="btn-group">
                        <button type="submit" class="btn btn-primary">Update</button>
                        <button type="button" class="btn btn-outline" onclick="closeModal()">Cancel</button>
                    </div>
                </form>
            `;
            document.getElementById('modal-overlay').style.display = 'flex';
        }

        function updateQuestionMapping(event, useCaseId, questionId) {
            event.preventDefault();
            const formData = new FormData(event.target);
            const mapping = config.mappings.find(m => m.useCaseId === useCaseId && m.questionId === questionId);
            mapping.variableName = formData.get('variableName');

            saveConfigToStorage();
            closeModalDirect();
            renderConfigPanel();
        }

        function deleteMapping(useCaseId, questionId) {
            if (!confirm('Remove this question from the use case?')) return;
            config.mappings = config.mappings.filter(m => !(m.useCaseId === useCaseId && m.questionId === questionId));
            saveConfigToStorage();
            renderConfigPanel();
        }

        function exportConfiguration() {
            const dataStr = JSON.stringify(config, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'idmworks-tco-config.json';
            link.click();
            URL.revokeObjectURL(url);
        }

        function importConfiguration(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    config = JSON.parse(e.target.result);
                    saveConfigToStorage();
                    renderConfigPanel();
                    alert('Configuration imported successfully!');
                } catch (error) {
                    alert('Error importing: ' + error.message);
                }
            };
            reader.readAsText(file);
        }

        function closeModal(event) {
            if (!event || event.target.classList.contains('modal-overlay')) {
                document.getElementById('modal-overlay').style.display = 'none';
            }
        }

        function closeModalDirect() {
            document.getElementById('modal-overlay').style.display = 'none';
        }

        // Initialize
        init();
    </script>
</body>
</html>
